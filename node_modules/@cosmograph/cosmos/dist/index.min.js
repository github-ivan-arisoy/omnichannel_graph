!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).Cosmos={})}(this,(function(e){"use strict";var t="http://www.w3.org/1999/xhtml",n={svg:"http://www.w3.org/2000/svg",xhtml:t,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function r(e){var t=e+="",r=t.indexOf(":");return r>=0&&"xmlns"!==(t=e.slice(0,r))&&(e=e.slice(r+1)),n.hasOwnProperty(t)?{space:n[t],local:e}:e}function i(e){return function(){var n=this.ownerDocument,r=this.namespaceURI;return r===t&&n.documentElement.namespaceURI===t?n.createElement(e):n.createElementNS(r,e)}}function o(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function a(e){var t=r(e);return(t.local?o:i)(t)}function s(){}function u(e){return null==e?s:function(){return this.querySelector(e)}}function c(){return[]}function l(e){return null==e?c:function(){return this.querySelectorAll(e)}}function f(e){return function(){return null==(t=e.apply(this,arguments))?[]:Array.isArray(t)?t:Array.from(t);var t}}function h(e){return function(){return this.matches(e)}}function d(e){return function(t){return t.matches(e)}}var p=Array.prototype.find;function m(){return this.firstElementChild}var v=Array.prototype.filter;function g(){return Array.from(this.children)}function y(e){return new Array(e.length)}function b(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function x(e,t,n,r,i,o){for(var a,s=0,u=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],r[s]=a):n[s]=new b(e,o[s]);for(;s<u;++s)(a=t[s])&&(i[s]=a)}function w(e,t,n,r,i,o,a){var s,u,c,l=new Map,f=t.length,h=o.length,d=new Array(f);for(s=0;s<f;++s)(u=t[s])&&(d[s]=c=a.call(u,u.__data__,s,t)+"",l.has(c)?i[s]=u:l.set(c,u));for(s=0;s<h;++s)c=a.call(e,o[s],s,o)+"",(u=l.get(c))?(r[s]=u,u.__data__=o[s],l.delete(c)):n[s]=new b(e,o[s]);for(s=0;s<f;++s)(u=t[s])&&l.get(d[s])===u&&(i[s]=u)}function S(e){return e.__data__}function _(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function A(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function k(e){return function(){this.removeAttribute(e)}}function z(e){return function(){this.removeAttributeNS(e.space,e.local)}}function T(e,t){return function(){this.setAttribute(e,t)}}function M(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function C(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function I(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function P(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function F(e){return function(){this.style.removeProperty(e)}}function E(e,t,n){return function(){this.style.setProperty(e,t,n)}}function D(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function N(e,t){return e.style.getPropertyValue(t)||P(e).getComputedStyle(e,null).getPropertyValue(t)}function O(e){return function(){delete this[e]}}function L(e,t){return function(){this[e]=t}}function j(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function B(e){return e.trim().split(/^|\s+/)}function R(e){return e.classList||new V(e)}function V(e){this._node=e,this._names=B(e.getAttribute("class")||"")}function q(e,t){for(var n=R(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function G(e,t){for(var n=R(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function U(e){return function(){q(this,e)}}function H(e){return function(){G(this,e)}}function Y(e,t){return function(){(t.apply(this,arguments)?q:G)(this,e)}}function W(){this.textContent=""}function $(e){return function(){this.textContent=e}}function Z(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function X(){this.innerHTML=""}function Q(e){return function(){this.innerHTML=e}}function J(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function K(){this.nextSibling&&this.parentNode.appendChild(this)}function ee(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function te(){return null}function ne(){var e=this.parentNode;e&&e.removeChild(this)}function re(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function ie(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function oe(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,o=t.length;r<o;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function ae(e,t,n){return function(){var r,i=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=t);this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function se(e,t,n){var r=P(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function ue(e,t){return function(){return se(this,e,t)}}function ce(e,t){return function(){return se(this,e,t.apply(this,arguments))}}b.prototype={constructor:b,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},V.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var le=[null];function fe(e,t){this._groups=e,this._parents=t}function he(){return new fe([[document.documentElement]],le)}function de(e){return"string"==typeof e?new fe([[document.querySelector(e)]],[document.documentElement]):new fe([[e]],le)}fe.prototype=he.prototype={constructor:fe,select:function(e){"function"!=typeof e&&(e=u(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=t[i],c=s.length,l=r[i]=new Array(c),f=0;f<c;++f)(o=s[f])&&(a=e.call(o,o.__data__,f,s))&&("__data__"in o&&(a.__data__=o.__data__),l[f]=a);return new fe(r,this._parents)},selectAll:function(e){e="function"==typeof e?f(e):l(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var a,s=t[o],u=s.length,c=0;c<u;++c)(a=s[c])&&(r.push(e.call(a,a.__data__,c,s)),i.push(a));return new fe(r,i)},selectChild:function(e){return this.select(null==e?m:function(e){return function(){return p.call(this.children,e)}}("function"==typeof e?e:d(e)))},selectChildren:function(e){return this.selectAll(null==e?g:function(e){return function(){return v.call(this.children,e)}}("function"==typeof e?e:d(e)))},filter:function(e){"function"!=typeof e&&(e=h(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,a=t[i],s=a.length,u=r[i]=[],c=0;c<s;++c)(o=a[c])&&e.call(o,o.__data__,c,a)&&u.push(o);return new fe(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,S);var n,r=t?w:x,i=this._parents,o=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var a=o.length,s=new Array(a),u=new Array(a),c=new Array(a),l=0;l<a;++l){var f=i[l],h=o[l],d=h.length,p=_(e.call(f,f&&f.__data__,l,i)),m=p.length,v=u[l]=new Array(m),g=s[l]=new Array(m);r(f,h,v,g,c[l]=new Array(d),p,t);for(var y,b,A=0,k=0;A<m;++A)if(y=v[A]){for(A>=k&&(k=A+1);!(b=g[k])&&++k<m;);y._next=b||null}}return(s=new fe(s,i))._enter=u,s._exit=c,s},enter:function(){return new fe(this._enter||this._groups.map(y),this._parents)},exit:function(){return new fe(this._exit||this._groups.map(y),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,o=this.exit();return"function"==typeof e?(r=e(r))&&(r=r.selection()):r=r.append(e+""),null!=t&&(i=t(i))&&(i=i.selection()),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(e){for(var t=e.selection?e.selection():e,n=this._groups,r=t._groups,i=n.length,o=r.length,a=Math.min(i,o),s=new Array(i),u=0;u<a;++u)for(var c,l=n[u],f=r[u],h=l.length,d=s[u]=new Array(h),p=0;p<h;++p)(c=l[p]||f[p])&&(d[p]=c);for(;u<i;++u)s[u]=n[u];return new fe(s,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=A);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,c=i[o]=new Array(u),l=0;l<u;++l)(a=s[l])&&(c[l]=a);c.sort(t)}return new fe(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,o=t[n],a=0,s=o.length;a<s;++a)(i=o[a])&&e.call(i,i.__data__,a,o);return this},attr:function(e,t){var n=r(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((null==t?n.local?z:k:"function"==typeof t?n.local?I:C:n.local?M:T)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?F:"function"==typeof t?D:E)(e,t,null==n?"":n)):N(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?O:"function"==typeof t?j:L)(e,t)):this.node()[e]},classed:function(e,t){var n=B(e+"");if(arguments.length<2){for(var r=R(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?Y:t?U:H)(n,t))},text:function(e){return arguments.length?this.each(null==e?W:("function"==typeof e?Z:$)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?X:("function"==typeof e?J:Q)(e)):this.node().innerHTML},raise:function(){return this.each(K)},lower:function(){return this.each(ee)},append:function(e){var t="function"==typeof e?e:a(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:a(e),r=null==t?te:"function"==typeof t?t:u(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(ne)},clone:function(e){return this.select(e?ie:re)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,o=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),a=o.length;if(!(arguments.length<2)){for(s=t?ae:oe,r=0;r<a;++r)this.each(s(o[r],t,n));return this}var s=this.node().__on;if(s)for(var u,c=0,l=s.length;c<l;++c)for(r=0,u=s[c];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?ce:ue)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};var pe=0;function me(){this._="@"+(++pe).toString(36)}function ve(e,t){if(e=function(e){let t;for(;t=e.sourceEvent;)e=t;return e}(e),void 0===t&&(t=e.currentTarget),t){var n=t.ownerSVGElement||t;if(n.createSVGPoint){var r=n.createSVGPoint();return r.x=e.clientX,r.y=e.clientY,[(r=r.matrixTransform(t.getScreenCTM().inverse())).x,r.y]}if(t.getBoundingClientRect){var i=t.getBoundingClientRect();return[e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop]}}return[e.pageX,e.pageY]}me.prototype={constructor:me,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var ge={value:()=>{}};function ye(){for(var e,t=0,n=arguments.length,r={};t<n;++t){if(!(e=arguments[t]+"")||e in r||/[\s.]/.test(e))throw new Error("illegal type: "+e);r[e]=[]}return new be(r)}function be(e){this._=e}function xe(e,t){for(var n,r=0,i=e.length;r<i;++r)if((n=e[r]).name===t)return n.value}function we(e,t,n){for(var r=0,i=e.length;r<i;++r)if(e[r].name===t){e[r]=ge,e=e.slice(0,r).concat(e.slice(r+1));break}return null!=n&&e.push({name:t,value:n}),e}be.prototype=ye.prototype={constructor:be,on:function(e,t){var n,r,i=this._,o=(r=i,(e+"").trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");if(n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),e&&!r.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:t}}))),a=-1,s=o.length;if(!(arguments.length<2)){if(null!=t&&"function"!=typeof t)throw new Error("invalid callback: "+t);for(;++a<s;)if(n=(e=o[a]).type)i[n]=we(i[n],e.name,t);else if(null==t)for(n in i)i[n]=we(i[n],e.name,null);return this}for(;++a<s;)if((n=(e=o[a]).type)&&(n=xe(i[n],e.name)))return n},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new be(e)},call:function(e,t){if((n=arguments.length-2)>0)for(var n,r,i=new Array(n),o=0;o<n;++o)i[o]=arguments[o+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(o=0,n=(r=this._[e]).length;o<n;++o)r[o].value.apply(t,i)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var r=this._[e],i=0,o=r.length;i<o;++i)r[i].value.apply(t,n)}};var Se,_e,Ae=0,ke=0,ze=0,Te=1e3,Me=0,Ce=0,Ie=0,Pe="object"==typeof performance&&performance.now?performance:Date,Fe="object"==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Ee(){return Ce||(Fe(De),Ce=Pe.now()+Ie)}function De(){Ce=0}function Ne(){this._call=this._time=this._next=null}function Oe(e,t,n){var r=new Ne;return r.restart(e,t,n),r}function Le(){Ce=(Me=Pe.now())+Ie,Ae=ke=0;try{!function(){Ee(),++Ae;for(var e,t=Se;t;)(e=Ce-t._time)>=0&&t._call.call(null,e),t=t._next;--Ae}()}finally{Ae=0,function(){var e,t,n=Se,r=1/0;for(;n;)n._call?(r>n._time&&(r=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:Se=t);_e=e,Be(r)}(),Ce=0}}function je(){var e=Pe.now(),t=e-Me;t>Te&&(Ie-=t,Me=e)}function Be(e){Ae||(ke&&(ke=clearTimeout(ke)),e-Ce>24?(e<1/0&&(ke=setTimeout(Le,e-Pe.now()-Ie)),ze&&(ze=clearInterval(ze))):(ze||(Me=Pe.now(),ze=setInterval(je,Te)),Ae=1,Fe(Le)))}function Re(e,t,n){var r=new Ne;return t=null==t?0:+t,r.restart((n=>{r.stop(),e(n+t)}),t,n),r}Ne.prototype=Oe.prototype={constructor:Ne,restart:function(e,t,n){if("function"!=typeof e)throw new TypeError("callback is not a function");n=(null==n?Ee():+n)+(null==t?0:+t),this._next||_e===this||(_e?_e._next=this:Se=this,_e=this),this._call=e,this._time=n,Be()},stop:function(){this._call&&(this._call=null,this._time=1/0,Be())}};var Ve=ye("start","end","cancel","interrupt"),qe=[],Ge=0,Ue=1,He=2,Ye=3,We=4,$e=5,Ze=6;function Xe(e,t,n,r,i,o){var a=e.__transition;if(a){if(n in a)return}else e.__transition={};!function(e,t,n){var r,i=e.__transition;function o(e){n.state=Ue,n.timer.restart(a,n.delay,n.time),n.delay<=e&&a(e-n.delay)}function a(o){var c,l,f,h;if(n.state!==Ue)return u();for(c in i)if((h=i[c]).name===n.name){if(h.state===Ye)return Re(a);h.state===We?(h.state=Ze,h.timer.stop(),h.on.call("interrupt",e,e.__data__,h.index,h.group),delete i[c]):+c<t&&(h.state=Ze,h.timer.stop(),h.on.call("cancel",e,e.__data__,h.index,h.group),delete i[c])}if(Re((function(){n.state===Ye&&(n.state=We,n.timer.restart(s,n.delay,n.time),s(o))})),n.state=He,n.on.call("start",e,e.__data__,n.index,n.group),n.state===He){for(n.state=Ye,r=new Array(f=n.tween.length),c=0,l=-1;c<f;++c)(h=n.tween[c].value.call(e,e.__data__,n.index,n.group))&&(r[++l]=h);r.length=l+1}}function s(t){for(var i=t<n.duration?n.ease.call(null,t/n.duration):(n.timer.restart(u),n.state=$e,1),o=-1,a=r.length;++o<a;)r[o].call(e,i);n.state===$e&&(n.on.call("end",e,e.__data__,n.index,n.group),u())}function u(){for(var r in n.state=Ze,n.timer.stop(),delete i[t],i)return;delete e.__transition}i[t]=n,n.timer=Oe(o,0,n.time)}(e,n,{name:t,index:r,group:i,on:Ve,tween:qe,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:Ge})}function Qe(e,t){var n=Ke(e,t);if(n.state>Ge)throw new Error("too late; already scheduled");return n}function Je(e,t){var n=Ke(e,t);if(n.state>Ye)throw new Error("too late; already running");return n}function Ke(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function et(e,t){var n,r,i,o=e.__transition,a=!0;if(o){for(i in t=null==t?null:t+"",o)(n=o[i]).name===t?(r=n.state>He&&n.state<$e,n.state=Ze,n.timer.stop(),n.on.call(r?"interrupt":"cancel",e,e.__data__,n.index,n.group),delete o[i]):a=!1;a&&delete e.__transition}}function tt(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function nt(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function rt(){}var it=.7,ot=1/it,at="\\s*([+-]?\\d+)\\s*",st="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ut="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ct=/^#([0-9a-f]{3,8})$/,lt=new RegExp(`^rgb\\(${at},${at},${at}\\)$`),ft=new RegExp(`^rgb\\(${ut},${ut},${ut}\\)$`),ht=new RegExp(`^rgba\\(${at},${at},${at},${st}\\)$`),dt=new RegExp(`^rgba\\(${ut},${ut},${ut},${st}\\)$`),pt=new RegExp(`^hsl\\(${st},${ut},${ut}\\)$`),mt=new RegExp(`^hsla\\(${st},${ut},${ut},${st}\\)$`),vt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function gt(){return this.rgb().formatHex()}function yt(){return this.rgb().formatRgb()}function bt(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=ct.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?xt(t):3===n?new At(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?wt(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?wt(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=lt.exec(e))?new At(t[1],t[2],t[3],1):(t=ft.exec(e))?new At(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=ht.exec(e))?wt(t[1],t[2],t[3],t[4]):(t=dt.exec(e))?wt(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=pt.exec(e))?It(t[1],t[2]/100,t[3]/100,1):(t=mt.exec(e))?It(t[1],t[2]/100,t[3]/100,t[4]):vt.hasOwnProperty(e)?xt(vt[e]):"transparent"===e?new At(NaN,NaN,NaN,0):null}function xt(e){return new At(e>>16&255,e>>8&255,255&e,1)}function wt(e,t,n,r){return r<=0&&(e=t=n=NaN),new At(e,t,n,r)}function St(e){return e instanceof rt||(e=bt(e)),e?new At((e=e.rgb()).r,e.g,e.b,e.opacity):new At}function _t(e,t,n,r){return 1===arguments.length?St(e):new At(e,t,n,null==r?1:r)}function At(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function kt(){return`#${Ct(this.r)}${Ct(this.g)}${Ct(this.b)}`}function zt(){const e=Tt(this.opacity);return`${1===e?"rgb(":"rgba("}${Mt(this.r)}, ${Mt(this.g)}, ${Mt(this.b)}${1===e?")":`, ${e})`}`}function Tt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Mt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Ct(e){return((e=Mt(e))<16?"0":"")+e.toString(16)}function It(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Ft(e,t,n,r)}function Pt(e){if(e instanceof Ft)return new Ft(e.h,e.s,e.l,e.opacity);if(e instanceof rt||(e=bt(e)),!e)return new Ft;if(e instanceof Ft)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new Ft(a,s,u,e.opacity)}function Ft(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Et(e){return(e=(e||0)%360)<0?e+360:e}function Dt(e){return Math.max(0,Math.min(1,e||0))}function Nt(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}tt(rt,bt,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:gt,formatHex:gt,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Pt(this).formatHsl()},formatRgb:yt,toString:yt}),tt(At,_t,nt(rt,{brighter(e){return e=null==e?ot:Math.pow(ot,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?it:Math.pow(it,e),new At(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new At(Mt(this.r),Mt(this.g),Mt(this.b),Tt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:kt,formatHex:kt,formatHex8:function(){return`#${Ct(this.r)}${Ct(this.g)}${Ct(this.b)}${Ct(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:zt,toString:zt})),tt(Ft,(function(e,t,n,r){return 1===arguments.length?Pt(e):new Ft(e,t,n,null==r?1:r)}),nt(rt,{brighter(e){return e=null==e?ot:Math.pow(ot,e),new Ft(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?it:Math.pow(it,e),new Ft(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new At(Nt(e>=240?e-240:e+120,i,r),Nt(e,i,r),Nt(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Ft(Et(this.h),Dt(this.s),Dt(this.l),Tt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Tt(this.opacity);return`${1===e?"hsl(":"hsla("}${Et(this.h)}, ${100*Dt(this.s)}%, ${100*Dt(this.l)}%${1===e?")":`, ${e})`}`}}));const Ot=Math.PI/180,Lt=180/Math.PI,jt=.96422,Bt=1,Rt=.82521,Vt=4/29,qt=6/29,Gt=3*qt*qt,Ut=qt*qt*qt;function Ht(e){if(e instanceof Yt)return new Yt(e.l,e.a,e.b,e.opacity);if(e instanceof Qt)return Jt(e);e instanceof At||(e=St(e));var t,n,r=Xt(e.r),i=Xt(e.g),o=Xt(e.b),a=Wt((.2225045*r+.7168786*i+.0606169*o)/Bt);return r===i&&i===o?t=n=a:(t=Wt((.4360747*r+.3850649*i+.1430804*o)/jt),n=Wt((.0139322*r+.0971045*i+.7141733*o)/Rt)),new Yt(116*a-16,500*(t-a),200*(a-n),e.opacity)}function Yt(e,t,n,r){this.l=+e,this.a=+t,this.b=+n,this.opacity=+r}function Wt(e){return e>Ut?Math.pow(e,1/3):e/Gt+Vt}function $t(e){return e>qt?e*e*e:Gt*(e-Vt)}function Zt(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Xt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Qt(e,t,n,r){this.h=+e,this.c=+t,this.l=+n,this.opacity=+r}function Jt(e){if(isNaN(e.h))return new Yt(e.l,0,0,e.opacity);var t=e.h*Ot;return new Yt(e.l,Math.cos(t)*e.c,Math.sin(t)*e.c,e.opacity)}tt(Yt,(function(e,t,n,r){return 1===arguments.length?Ht(e):new Yt(e,t,n,null==r?1:r)}),nt(rt,{brighter(e){return new Yt(this.l+18*(null==e?1:e),this.a,this.b,this.opacity)},darker(e){return new Yt(this.l-18*(null==e?1:e),this.a,this.b,this.opacity)},rgb(){var e=(this.l+16)/116,t=isNaN(this.a)?e:e+this.a/500,n=isNaN(this.b)?e:e-this.b/200;return new At(Zt(3.1338561*(t=jt*$t(t))-1.6168667*(e=Bt*$t(e))-.4906146*(n=Rt*$t(n))),Zt(-.9787684*t+1.9161415*e+.033454*n),Zt(.0719453*t-.2289914*e+1.4052427*n),this.opacity)}})),tt(Qt,(function(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof Qt)return new Qt(e.h,e.c,e.l,e.opacity);if(e instanceof Yt||(e=Ht(e)),0===e.a&&0===e.b)return new Qt(NaN,0<e.l&&e.l<100?0:NaN,e.l,e.opacity);var t=Math.atan2(e.b,e.a)*Lt;return new Qt(t<0?t+360:t,Math.sqrt(e.a*e.a+e.b*e.b),e.l,e.opacity)}(e):new Qt(e,t,n,null==r?1:r)}),nt(rt,{brighter(e){return new Qt(this.h,this.c,this.l+18*(null==e?1:e),this.opacity)},darker(e){return new Qt(this.h,this.c,this.l-18*(null==e?1:e),this.opacity)},rgb(){return Jt(this).rgb()}}));var Kt=-.14861,en=1.78277,tn=-.29227,nn=-.90649,rn=1.97294,on=rn*nn,an=rn*en,sn=en*tn-nn*Kt;function un(e,t,n,r){return 1===arguments.length?function(e){if(e instanceof cn)return new cn(e.h,e.s,e.l,e.opacity);e instanceof At||(e=St(e));var t=e.r/255,n=e.g/255,r=e.b/255,i=(sn*r+on*t-an*n)/(sn+on-an),o=r-i,a=(rn*(n-i)-tn*o)/nn,s=Math.sqrt(a*a+o*o)/(rn*i*(1-i)),u=s?Math.atan2(a,o)*Lt-120:NaN;return new cn(u<0?u+360:u,s,i,e.opacity)}(e):new cn(e,t,n,null==r?1:r)}function cn(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}tt(cn,un,nt(rt,{brighter(e){return e=null==e?ot:Math.pow(ot,e),new cn(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?it:Math.pow(it,e),new cn(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=isNaN(this.h)?0:(this.h+120)*Ot,t=+this.l,n=isNaN(this.s)?0:this.s*t*(1-t),r=Math.cos(e),i=Math.sin(e);return new At(255*(t+n*(Kt*r+en*i)),255*(t+n*(tn*r+nn*i)),255*(t+n*(rn*r)),this.opacity)}}));var ln=e=>()=>e;function fn(e,t){return function(n){return e+n*t}}function hn(e){return 1==(e=+e)?dn:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):ln(isNaN(t)?n:t)}}function dn(e,t){var n=t-e;return n?fn(e,n):ln(isNaN(e)?t:e)}var pn=function e(t){var n=hn(t);function r(e,t){var r=n((e=_t(e)).r,(t=_t(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=dn(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function mn(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function vn(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=_n(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function gn(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function yn(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function bn(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=_n(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var xn=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,wn=new RegExp(xn.source,"g");function Sn(e,t){var n,r,i,o=xn.lastIndex=wn.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=xn.exec(e))&&(r=wn.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:yn(n,r)})),o=wn.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function _n(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?ln(t):("number"===i?yn:"string"===i?(n=bt(t))?(t=n,pn):Sn:t instanceof bt?pn:t instanceof Date?gn:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?vn:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?bn:yn:mn))(e,t)}function An(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var kn,zn=180/Math.PI,Tn={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mn(e,t,n,r,i,o){var a,s,u;return(a=Math.sqrt(e*e+t*t))&&(e/=a,t/=a),(u=e*n+t*r)&&(n-=e*u,r-=t*u),(s=Math.sqrt(n*n+r*r))&&(n/=s,r/=s,u/=s),e*r<t*n&&(e=-e,t=-t,u=-u,a=-a),{translateX:i,translateY:o,rotate:Math.atan2(t,e)*zn,skewX:Math.atan(u)*zn,scaleX:a,scaleY:s}}function Cn(e,t,n,r){function i(e){return e.length?e.pop()+" ":""}return function(o,a){var s=[],u=[];return o=e(o),a=e(a),function(e,r,i,o,a,s){if(e!==i||r!==o){var u=a.push("translate(",null,t,null,n);s.push({i:u-4,x:yn(e,i)},{i:u-2,x:yn(r,o)})}else(i||o)&&a.push("translate("+i+t+o+n)}(o.translateX,o.translateY,a.translateX,a.translateY,s,u),function(e,t,n,o){e!==t?(e-t>180?t+=360:t-e>180&&(e+=360),o.push({i:n.push(i(n)+"rotate(",null,r)-2,x:yn(e,t)})):t&&n.push(i(n)+"rotate("+t+r)}(o.rotate,a.rotate,s,u),function(e,t,n,o){e!==t?o.push({i:n.push(i(n)+"skewX(",null,r)-2,x:yn(e,t)}):t&&n.push(i(n)+"skewX("+t+r)}(o.skewX,a.skewX,s,u),function(e,t,n,r,o,a){if(e!==n||t!==r){var s=o.push(i(o)+"scale(",null,",",null,")");a.push({i:s-4,x:yn(e,n)},{i:s-2,x:yn(t,r)})}else 1===n&&1===r||o.push(i(o)+"scale("+n+","+r+")")}(o.scaleX,o.scaleY,a.scaleX,a.scaleY,s,u),o=a=null,function(e){for(var t,n=-1,r=u.length;++n<r;)s[(t=u[n]).i]=t.x(e);return s.join("")}}}var In=Cn((function(e){const t=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?Tn:Mn(t.a,t.b,t.c,t.d,t.e,t.f)}),"px, ","px)","deg)"),Pn=Cn((function(e){return null==e?Tn:(kn||(kn=document.createElementNS("http://www.w3.org/2000/svg","g")),kn.setAttribute("transform",e),(e=kn.transform.baseVal.consolidate())?Mn((e=e.matrix).a,e.b,e.c,e.d,e.e,e.f):Tn)}),", ",")",")");function Fn(e){return((e=Math.exp(e))+1/e)/2}var En=function e(t,n,r){function i(e,i){var o,a,s=e[0],u=e[1],c=e[2],l=i[0],f=i[1],h=i[2],d=l-s,p=f-u,m=d*d+p*p;if(m<1e-12)a=Math.log(h/c)/t,o=function(e){return[s+e*d,u+e*p,c*Math.exp(t*e*a)]};else{var v=Math.sqrt(m),g=(h*h-c*c+r*m)/(2*c*n*v),y=(h*h-c*c-r*m)/(2*h*n*v),b=Math.log(Math.sqrt(g*g+1)-g),x=Math.log(Math.sqrt(y*y+1)-y);a=(x-b)/t,o=function(e){var r,i=e*a,o=Fn(b),l=c/(n*v)*(o*(r=t*i+b,((r=Math.exp(2*r))-1)/(r+1))-function(e){return((e=Math.exp(e))-1/e)/2}(b));return[s+l*d,u+l*p,c*o/Fn(t*i+b)]}}return o.duration=1e3*a*t/Math.SQRT2,o}return i.rho=function(t){var n=Math.max(.001,+t),r=n*n;return e(n,r,r*r)},i}(Math.SQRT2,2,4);function Dn(e){return function t(n){function r(t,r){var i=e((t=un(t)).h,(r=un(r)).h),o=dn(t.s,r.s),a=dn(t.l,r.l),s=dn(t.opacity,r.opacity);return function(e){return t.h=i(e),t.s=o(e),t.l=a(Math.pow(e,n)),t.opacity=s(e),t+""}}return n=+n,r.gamma=t,r}(1)}function Nn(e,t){var n,r;return function(){var i=Je(this,e),o=i.tween;if(o!==n)for(var a=0,s=(r=n=o).length;a<s;++a)if(r[a].name===t){(r=r.slice()).splice(a,1);break}i.tween=r}}function On(e,t,n){var r,i;if("function"!=typeof n)throw new Error;return function(){var o=Je(this,e),a=o.tween;if(a!==r){i=(r=a).slice();for(var s={name:t,value:n},u=0,c=i.length;u<c;++u)if(i[u].name===t){i[u]=s;break}u===c&&i.push(s)}o.tween=i}}function Ln(e,t,n){var r=e._id;return e.each((function(){var e=Je(this,r);(e.value||(e.value={}))[t]=n.apply(this,arguments)})),function(e){return Ke(e,r).value[t]}}function jn(e,t){var n;return("number"==typeof t?yn:t instanceof bt?pn:(n=bt(t))?(t=n,pn):Sn)(e,t)}function Bn(e){return function(){this.removeAttribute(e)}}function Rn(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Vn(e,t,n){var r,i,o=n+"";return function(){var a=this.getAttribute(e);return a===o?null:a===r?i:i=t(r=a,n)}}function qn(e,t,n){var r,i,o=n+"";return function(){var a=this.getAttributeNS(e.space,e.local);return a===o?null:a===r?i:i=t(r=a,n)}}function Gn(e,t,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttribute(e))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=t(r=a,u));this.removeAttribute(e)}}function Un(e,t,n){var r,i,o;return function(){var a,s,u=n(this);if(null!=u)return(a=this.getAttributeNS(e.space,e.local))===(s=u+"")?null:a===r&&s===i?o:(i=s,o=t(r=a,u));this.removeAttributeNS(e.space,e.local)}}function Hn(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}(e,i)),n}return i._value=t,i}function Yn(e,t){var n,r;function i(){var i=t.apply(this,arguments);return i!==r&&(n=(r=i)&&function(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}(e,i)),n}return i._value=t,i}function Wn(e,t){return function(){Qe(this,e).delay=+t.apply(this,arguments)}}function $n(e,t){return t=+t,function(){Qe(this,e).delay=t}}function Zn(e,t){return function(){Je(this,e).duration=+t.apply(this,arguments)}}function Xn(e,t){return t=+t,function(){Je(this,e).duration=t}}Dn((function(e,t){var n=t-e;return n?fn(e,n>180||n<-180?n-360*Math.round(n/360):n):ln(isNaN(e)?t:e)})),Dn(dn);var Qn=he.prototype.constructor;function Jn(e){return function(){this.style.removeProperty(e)}}var Kn=0;function er(e,t,n,r){this._groups=e,this._parents=t,this._name=n,this._id=r}function tr(){return++Kn}var nr=he.prototype;function rr(e){return e*e}function ir(e){return e*(2-e)}function or(e){return((e*=2)<=1?e*e:--e*(2-e)+1)/2}er.prototype={constructor:er,select:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=u(e));for(var r=this._groups,i=r.length,o=new Array(i),a=0;a<i;++a)for(var s,c,l=r[a],f=l.length,h=o[a]=new Array(f),d=0;d<f;++d)(s=l[d])&&(c=e.call(s,s.__data__,d,l))&&("__data__"in s&&(c.__data__=s.__data__),h[d]=c,Xe(h[d],t,n,d,h,Ke(s,n)));return new er(o,this._parents,t,n)},selectAll:function(e){var t=this._name,n=this._id;"function"!=typeof e&&(e=l(e));for(var r=this._groups,i=r.length,o=[],a=[],s=0;s<i;++s)for(var u,c=r[s],f=c.length,h=0;h<f;++h)if(u=c[h]){for(var d,p=e.call(u,u.__data__,h,c),m=Ke(u,n),v=0,g=p.length;v<g;++v)(d=p[v])&&Xe(d,t,n,v,p,m);o.push(p),a.push(u)}return new er(o,a,t,n)},selectChild:nr.selectChild,selectChildren:nr.selectChildren,filter:function(e){"function"!=typeof e&&(e=h(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,a=t[i],s=a.length,u=r[i]=[],c=0;c<s;++c)(o=a[c])&&e.call(o,o.__data__,c,a)&&u.push(o);return new er(r,this._parents,this._name,this._id)},merge:function(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,r=t.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u,c=t[s],l=n[s],f=c.length,h=a[s]=new Array(f),d=0;d<f;++d)(u=c[d]||l[d])&&(h[d]=u);for(;s<r;++s)a[s]=t[s];return new er(a,this._parents,this._name,this._id)},selection:function(){return new Qn(this._groups,this._parents)},transition:function(){for(var e=this._name,t=this._id,n=tr(),r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,c=0;c<u;++c)if(a=s[c]){var l=Ke(a,t);Xe(a,e,n,c,s,{time:l.time+l.delay+l.duration,delay:0,duration:l.duration,ease:l.ease})}return new er(r,this._parents,e,n)},call:nr.call,nodes:nr.nodes,node:nr.node,size:nr.size,empty:nr.empty,each:nr.each,on:function(e,t){var n=this._id;return arguments.length<2?Ke(this.node(),n).on.on(e):this.each(function(e,t,n){var r,i,o=function(e){return(e+"").trim().split(/^|\s+/).every((function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||"start"===e}))}(t)?Qe:Je;return function(){var a=o(this,e),s=a.on;s!==r&&(i=(r=s).copy()).on(t,n),a.on=i}}(n,e,t))},attr:function(e,t){var n=r(e),i="transform"===n?Pn:jn;return this.attrTween(e,"function"==typeof t?(n.local?Un:Gn)(n,i,Ln(this,"attr."+e,t)):null==t?(n.local?Rn:Bn)(n):(n.local?qn:Vn)(n,i,t))},attrTween:function(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(null==t)return this.tween(n,null);if("function"!=typeof t)throw new Error;var i=r(e);return this.tween(n,(i.local?Hn:Yn)(i,t))},style:function(e,t,n){var r="transform"==(e+="")?In:jn;return null==t?this.styleTween(e,function(e,t){var n,r,i;return function(){var o=N(this,e),a=(this.style.removeProperty(e),N(this,e));return o===a?null:o===n&&a===r?i:i=t(n=o,r=a)}}(e,r)).on("end.style."+e,Jn(e)):"function"==typeof t?this.styleTween(e,function(e,t,n){var r,i,o;return function(){var a=N(this,e),s=n(this),u=s+"";return null==s&&(this.style.removeProperty(e),u=s=N(this,e)),a===u?null:a===r&&u===i?o:(i=u,o=t(r=a,s))}}(e,r,Ln(this,"style."+e,t))).each(function(e,t){var n,r,i,o,a="style."+t,s="end."+a;return function(){var u=Je(this,e),c=u.on,l=null==u.value[a]?o||(o=Jn(t)):void 0;c===n&&i===l||(r=(n=c).copy()).on(s,i=l),u.on=r}}(this._id,e)):this.styleTween(e,function(e,t,n){var r,i,o=n+"";return function(){var a=N(this,e);return a===o?null:a===r?i:i=t(r=a,n)}}(e,r,t),n).on("end.style."+e,null)},styleTween:function(e,t,n){var r="style."+(e+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(null==t)return this.tween(r,null);if("function"!=typeof t)throw new Error;return this.tween(r,function(e,t,n){var r,i;function o(){var o=t.apply(this,arguments);return o!==i&&(r=(i=o)&&function(e,t,n){return function(r){this.style.setProperty(e,t.call(this,r),n)}}(e,o,n)),r}return o._value=t,o}(e,t,null==n?"":n))},text:function(e){return this.tween("text","function"==typeof e?function(e){return function(){var t=e(this);this.textContent=null==t?"":t}}(Ln(this,"text",e)):function(e){return function(){this.textContent=e}}(null==e?"":e+""))},textTween:function(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(null==e)return this.tween(t,null);if("function"!=typeof e)throw new Error;return this.tween(t,function(e){var t,n;function r(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&function(e){return function(t){this.textContent=e.call(this,t)}}(r)),t}return r._value=e,r}(e))},remove:function(){return this.on("end.remove",function(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}(this._id))},tween:function(e,t){var n=this._id;if(e+="",arguments.length<2){for(var r,i=Ke(this.node(),n).tween,o=0,a=i.length;o<a;++o)if((r=i[o]).name===e)return r.value;return null}return this.each((null==t?Nn:On)(n,e,t))},delay:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Wn:$n)(t,e)):Ke(this.node(),t).delay},duration:function(e){var t=this._id;return arguments.length?this.each(("function"==typeof e?Zn:Xn)(t,e)):Ke(this.node(),t).duration},ease:function(e){var t=this._id;return arguments.length?this.each(function(e,t){if("function"!=typeof t)throw new Error;return function(){Je(this,e).ease=t}}(t,e)):Ke(this.node(),t).ease},easeVarying:function(e){if("function"!=typeof e)throw new Error;return this.each(function(e,t){return function(){var n=t.apply(this,arguments);if("function"!=typeof n)throw new Error;Je(this,e).ease=n}}(this._id,e))},end:function(){var e,t,n=this,r=n._id,i=n.size();return new Promise((function(o,a){var s={value:a},u={value:function(){0==--i&&o()}};n.each((function(){var n=Je(this,r),i=n.on;i!==e&&((t=(e=i).copy())._.cancel.push(s),t._.interrupt.push(s),t._.end.push(u)),n.on=t})),0===i&&o()}))},[Symbol.iterator]:nr[Symbol.iterator]};function ar(e){return 1.0009775171065494*(Math.pow(2,-10*e)-.0009765625)}!function e(t){function n(e){return Math.pow(e,t)}return t=+t,n.exponent=e,n}(3),function e(t){function n(e){return 1-Math.pow(1-e,t)}return t=+t,n.exponent=e,n}(3),function e(t){function n(e){return((e*=2)<=1?Math.pow(e,t):2-Math.pow(2-e,t))/2}return t=+t,n.exponent=e,n}(3);var sr=1.70158;!function e(t){function n(e){return(e=+e)*e*(t*(e-1)+e)}return t=+t,n.overshoot=e,n}(sr),function e(t){function n(e){return--e*e*((e+1)*t+e)+1}return t=+t,n.overshoot=e,n}(sr),function e(t){function n(e){return((e*=2)<1?e*e*((t+1)*e-t):(e-=2)*e*((t+1)*e+t)+2)/2}return t=+t,n.overshoot=e,n}(sr);var ur=2*Math.PI;!function e(t,n){var r=Math.asin(1/(t=Math.max(1,t)))*(n/=ur);function i(e){return t*ar(- --e)*Math.sin((r-e)/n)}return i.amplitude=function(t){return e(t,n*ur)},i.period=function(n){return e(t,n)},i}(1,.3),function e(t,n){var r=Math.asin(1/(t=Math.max(1,t)))*(n/=ur);function i(e){return 1-t*ar(e=+e)*Math.sin((e+r)/n)}return i.amplitude=function(t){return e(t,n*ur)},i.period=function(n){return e(t,n)},i}(1,.3),function e(t,n){var r=Math.asin(1/(t=Math.max(1,t)))*(n/=ur);function i(e){return((e=2*e-1)<0?t*ar(-e)*Math.sin((r-e)/n):2-t*ar(e)*Math.sin((r+e)/n))/2}return i.amplitude=function(t){return e(t,n*ur)},i.period=function(n){return e(t,n)},i}(1,.3);var cr={time:null,delay:0,duration:250,ease:function(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}};function lr(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}he.prototype.interrupt=function(e){return this.each((function(){et(this,e)}))},he.prototype.transition=function(e){var t,n;e instanceof er?(t=e._id,e=e._name):(t=tr(),(n=cr).time=Ee(),e=null==e?null:e+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var a,s=r[o],u=s.length,c=0;c<u;++c)(a=s[c])&&Xe(a,e,t,c,s,n||lr(a,t));return new er(r,this._parents,e,t)};var fr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},hr={exports:{}};!function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||i(t)}function a(e){return e?": "+e:""}function s(e,t,n){e in t||i("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())}function u(t,n){e(t)||i("invalid parameter type"+a(n)+". must be a typed array")}function c(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function l(e,t,n){c(e,t)||i("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)}function f(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")}function h(e,t,n){t.indexOf(e)<0&&i("invalid value"+a(n)+". must be one of: "+t)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function p(e){Object.keys(e).forEach((function(e){d.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+d)}))}function m(e,t){for(e+="";e.length<t;)e=" "+e;return e}function v(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function g(e,t){this.number=e,this.line=t,this.errors=[]}function y(e,t,n){this.file=e,this.line=t,this.message=n}function b(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function x(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function w(e,t){var n=e.split("\n"),i=1,o=0,a={unknown:new v,0:new v};a.unknown.name=a[0].name=t||b(),a.unknown.lines.push(new g(0,""));for(var s=0;s<n.length;++s){var u=n[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(i=0|l[1],l[2]&&((o=0|l[2])in a||(a[o]=new v)));break;case"define":var f=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);f&&(a[o].name=f[1]?r(f[2]):f[2])}a[o].lines.push(new g(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function S(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new y(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new y("unknown",0,e))}})),t}function _(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function A(e,t,r,i,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=i===e.FRAGMENT_SHADER?"fragment":"vertex";P(r,"string",u+" shader source must be a string",a);var c=w(r,a),l=S(s);_(c,l),Object.keys(c).forEach((function(e){var t=c[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(m(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(m("| ",6)),o(m("^^^",t+3)+n,"font-weight:bold"),o(m("| ",6)),o(i+n,"font-weight:bold")})),o(m("| ",6)+n)}else o(m(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),o.raise("Error compiling "+u+" shader, "+c[0].name)}}function k(e,t,r,i,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=w(r,a),c='Error linking program with vertex shader, "'+w(i,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+c+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(c+n+s),o.raise(c)}}function z(e){e._commandRef=b()}function T(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}z(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function M(e,t){var n=x();i(e+" in command "+(t||b())+("unknown"===n?"":" called from "+n))}function C(e,t,n){e||M(t,n||b())}function I(e,t,n,r){e in t||M("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join(),r||b())}function P(e,t,n,r){c(e,t)||M("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e,r||b())}function F(e){e()}function E(e,t,n){e.texture?h(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):h(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var D=33071,N=9728,O=9984,L=9985,j=9986,B=9987,R=5121,V=5122,q=5123,G=5124,U=5125,H=5126,Y=32819,W=32820,$=33635,Z=34042,X=36193,Q={};function J(e,t){return e===W||e===Y||e===$?2:e===Z?4:Q[e]*t}function K(e){return!(e&e-1||!e)}function ee(e,t,n){var r,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===D&&e.wrapT===D||o(K(i)&&K(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(e.minFilter!==O&&e.minFilter!==j&&e.minFilter!==L&&e.minFilter!==B,"min filter requires mipmap"):(o(K(i)&&K(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===H&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(e.minFilter===N&&e.magFilter===N,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=a>>r;o(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(o(f.width===c&&f.height===l,"invalid shape for mip images"),o(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(J(f.type,s)*c/f.unpackAlignment)*f.unpackAlignment;o(f.data.byteLength===h*l,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||o(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")}function te(e,t,n,r){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(t.wrapS===D&&t.wrapT===D,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];o(c.width===i&&c.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!c.compressed,"can not generate mipmap for compressed textures"),o(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,f=0;f<16;++f){var h=l[f];if(h){var d=i>>f,p=a>>f;o(c.mipmask&1<<f,"missing mipmap data"),o(h.width===d&&h.height===p,"invalid shape for mip images"),o(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?o(h.data.byteLength===d*p*Math.max(J(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}Q[5120]=Q[R]=1,Q[V]=Q[q]=Q[X]=Q[$]=Q[Y]=Q[W]=2,Q[G]=Q[U]=Q[H]=Q[Z]=4;var ne=t(o,{optional:F,raise:i,commandRaise:M,command:C,parameter:s,commandParameter:I,constructor:p,type:l,commandType:P,isTypedArray:u,nni:f,oneOf:h,shaderError:A,linkError:k,callSite:x,saveCommandRef:z,saveDrawInfo:T,framebufferFormat:E,guessCommand:b,texture2D:ee,textureCube:te}),re=0,ie=0,oe=5,ae=6;function se(e,t){this.id=re++,this.type=e,this.data=t}function ue(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ce(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+ue(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return ce(e.substr(0,r.index)).concat(ce(r[1])).concat(ce(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+ue(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(ce(i[a]));return o}function le(e){return"["+ce(e).join("][")+"]"}function fe(e,t){return new se(e,le(t+""))}function he(e){return"function"==typeof e&&!e._reglType||e instanceof se}function de(e,t){return"function"==typeof e?new se(ie,e):"number"==typeof e||"boolean"==typeof e?new se(oe,e):Array.isArray(e)?new se(ae,e.map((function(e,n){return de(e,t+"["+n+"]")}))):e instanceof se?e:void ne(!1,"invalid option type in uniform "+t)}var pe={DynamicVariable:se,define:fe,isDynamic:he,unbox:de,accessor:le},me={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},ve="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function ge(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function ye(e,n,r){var i,o=document.createElement("canvas");function a(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=o.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}o.width=r*t,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function be(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function xe(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function we(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function Se(e){return"string"==typeof e?e.split():(ne(Array.isArray(e),"invalid extension array"),e)}function _e(e){return"string"==typeof e?(ne("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function Ae(e){var t,n,r,i,o=e||{},a={},s=[],u=[],c="undefined"==typeof window?1:window.devicePixelRatio,l=!1,f=function(e){e&&ne.raise(e)},h=function(){};if("string"==typeof o?(ne("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(o),ne(t,"invalid query string for element")):"object"==typeof o?xe(o)?t=o:we(o)?r=(i=o).canvas:(ne.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=_e(o.canvas):"container"in o&&(n=_e(o.container)),"attributes"in o&&(a=o.attributes,ne.type(a,"object","invalid context attributes")),"extensions"in o&&(s=Se(o.extensions)),"optionalExtensions"in o&&(u=Se(o.optionalExtensions)),"onDone"in o&&(ne.type(o.onDone,"function","invalid or missing onDone callback"),f=o.onDone),"profile"in o&&(l=!!o.profile),"pixelRatio"in o&&(c=+o.pixelRatio,ne(c>0,"invalid pixel ratio"))):ne.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!i){if(!r){ne("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=ye(n||document.body,f,c);if(!d)return null;r=d.canvas,h=d.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=be(r,a)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:c,profile:l,onDone:f,onDestroy:h}:(h(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ke(e,t){var n={};function r(t){ne.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function ze(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Te=5120,Me=5121,Ce=5122,Ie=5123,Pe=5124,Fe=5125,Ee=5126;function De(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Ne(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function Oe(){var e=ze(8,(function(){return[]}));function t(t){var n=De(t),r=e[Ne(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Ne(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Te:r=new Int8Array(t(n),0,n);break;case Me:r=new Uint8Array(t(n),0,n);break;case Ce:r=new Int16Array(t(2*n),0,n);break;case Ie:r=new Uint16Array(t(2*n),0,n);break;case Pe:r=new Int32Array(t(4*n),0,n);break;case Fe:r=new Uint32Array(t(4*n),0,n);break;case Ee:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:i}}var Le=Oe();Le.zero=Oe();var je=3408,Be=3410,Re=3411,Ve=3412,qe=3413,Ge=3414,Ue=3415,He=33901,Ye=33902,We=3379,$e=3386,Ze=34921,Xe=36347,Qe=36348,Je=35661,Ke=35660,et=34930,tt=36349,nt=34076,rt=34024,it=7936,ot=7937,at=7938,st=35724,ut=34047,ct=36063,lt=34852,ft=3553,ht=34067,dt=34069,pt=33984,mt=6408,vt=5126,gt=5121,yt=36160,bt=36053,xt=36064,wt=16384,St=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(ut));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(lt),i=e.getParameter(ct));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(ft,a),e.texImage2D(ft,0,mt,1,1,0,mt,vt,null);var s=e.createFramebuffer();if(e.bindFramebuffer(yt,s),e.framebufferTexture2D(yt,xt,ft,a,0),e.bindTexture(ft,null),e.checkFramebufferStatus(yt)!==bt)o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(wt);var u=Le.allocType(vt,4);e.readPixels(0,0,1,1,mt,vt,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),Le.freeType(u)}}var c=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var l=e.createTexture(),f=Le.allocType(gt,36);e.activeTexture(pt),e.bindTexture(ht,l),e.texImage2D(dt,0,mt,3,3,0,mt,gt,f),Le.freeType(f),e.bindTexture(ht,null),e.deleteTexture(l),c=!e.getError()}return{colorBits:[e.getParameter(Be),e.getParameter(Re),e.getParameter(Ve),e.getParameter(qe)],depthBits:e.getParameter(Ge),stencilBits:e.getParameter(Ue),subpixelBits:e.getParameter(je),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(He),lineWidthDims:e.getParameter(Ye),maxViewportDims:e.getParameter($e),maxCombinedTextureUnits:e.getParameter(Je),maxCubeMapSize:e.getParameter(nt),maxRenderbufferSize:e.getParameter(rt),maxTextureUnits:e.getParameter(et),maxTextureSize:e.getParameter(We),maxAttributes:e.getParameter(Ze),maxVertexUniforms:e.getParameter(Xe),maxVertexTextureUnits:e.getParameter(Ke),maxVaryingVectors:e.getParameter(Qe),maxFragmentUniforms:e.getParameter(tt),glsl:e.getParameter(st),renderer:e.getParameter(ot),vendor:e.getParameter(it),version:e.getParameter(at),readFloat:o,npotTextureCube:c}};function _t(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var At=function(e){return Object.keys(e).map((function(t){return e[t]}))},kt={shape:Pt,flatten:It};function zt(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function Tt(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}function Mt(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],c=0;c<n;++c)for(var l=u[c],f=0;f<r;++f)i[a++]=l[f]}function Ct(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],c=t[n+2],l=t[n+3];for(a=0;a<s;++a)Mt(e[a],u,c,l,r,i),i+=o}else for(a=0;a<s;++a)Ct(e[a],t,n+1,r,i),i+=o}function It(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||Le.allocType(n,i);switch(t.length){case 0:break;case 1:zt(e,t[0],a);break;case 2:Tt(e,t[0],t[1],a);break;case 3:Mt(e,t[0],t[1],t[2],a,0);break;default:Ct(e,t,0,a,0)}return a}function Pt(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var Ft={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Et={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Dt={dynamic:35048,stream:35040,static:35044},Nt=kt.flatten,Ot=kt.shape,Lt=35044,jt=35040,Bt=5121,Rt=5126,Vt=[];function qt(e){return 0|Ft[Object.prototype.toString.call(e)]}function Gt(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Ut(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)e[s++]=t[i*u+o*c+a]}function Ht(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=Lt,this.byteLength=0,this.dimension=1,this.dtype=Bt,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){d(this)};var u=[];function c(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),h(n,t,jt,0,1,!1),n}function l(e){u.push(e)}function f(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function h(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||Rt,n.length>0)if(Array.isArray(n[0])){s=Ot(n);for(var c=1,l=1;l<s.length;++l)c*=s[l];t.dimension=c,f(t,u=Nt(n,s,t.dtype),r),a?t.persistentData=u:Le.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=Le.allocType(t.dtype,n.length);Gt(h,n),f(t,h,r),a?t.persistentData=h:Le.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||qt(n[0])||Rt,f(t,u=Nt(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:Le.freeType(u)):ne.raise("invalid buffer data")}else if(e(n))t.dtype=i||qt(n),t.dimension=o,f(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(_t(n)){s=n.shape;var d=n.stride,p=n.offset,m=0,v=0,g=0,y=0;1===s.length?(m=s[0],v=1,g=d[0],y=0):2===s.length?(m=s[0],v=s[1],g=d[0],y=d[1]):ne.raise("invalid shape"),t.dtype=i||qt(n.data)||Rt,t.dimension=v;var b=Le.allocType(t.dtype,m*v);Ut(b,n.data,m,v,g,y,p),f(t,b,r),a?t.persistentData=b:Le.freeType(b)}else n instanceof ArrayBuffer?(t.dtype=Bt,t.dimension=o,f(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):ne.raise("invalid buffer data")}function d(e){n.bufferCount--,i(e);var r=e.buffer;ne(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function p(i,o,u,c){n.bufferCount++;var l=new s(o);function f(n){var i=Lt,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||_t(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(ne.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ne(null===o||Array.isArray(o)||e(o)||_t(o),"invalid data for buffer"),o=n.data),"usage"in n&&(ne.parameter(n.usage,Dt,"invalid buffer usage"),i=Dt[n.usage]),"type"in n&&(ne.parameter(n.type,Et,"invalid buffer type"),s=Et[n.type]),"dimension"in n&&(ne.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(ne.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),l.bind(),o?h(l,o,i,s,u,c):(a&&t.bufferData(l.type,a,i),l.dtype=s||Bt,l.usage=i,l.dimension=u,l.byteLength=a),r.profile&&(l.stats.size=l.byteLength*Vt[l.dtype]),f}function p(e,n){ne(n+e.byteLength<=l.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+l.byteLength),t.bufferSubData(l.type,n,e)}function m(t,n){var r,i=0|(n||0);if(l.bind(),e(t)||t instanceof ArrayBuffer)p(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=Le.allocType(l.dtype,t.length);Gt(o,t),p(o,i),Le.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=Ot(t);var a=Nt(t,r,l.dtype);p(a,i),Le.freeType(a)}else ne.raise("invalid buffer data")}else if(_t(t)){r=t.shape;var s=t.stride,u=0,c=0,h=0,d=0;1===r.length?(u=r[0],c=1,h=s[0],d=0):2===r.length?(u=r[0],c=r[1],h=s[0],d=s[1]):ne.raise("invalid shape");var m=Array.isArray(t.data)?l.dtype:qt(t.data),v=Le.allocType(m,u*c);Ut(v,t.data,u,c,h,d,t.offset),p(v,i),Le.freeType(v)}else ne.raise("invalid data for buffer subdata");return f}return a[l.id]=l,u||f(i),f._reglType="buffer",f._buffer=l,f.subdata=m,r.profile&&(f.stats=l.stats),f.destroy=function(){d(l)},f}function m(){At(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:p,createStream:c,destroyStream:l,clear:function(){At(a).forEach(d),u.forEach(d)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:m,_initBuffer:h}}Vt[5120]=1,Vt[5122]=2,Vt[5124]=4,Vt[5121]=1,Vt[5123]=2,Vt[5125]=4,Vt[5126]=4;var Yt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wt=0,$t=1,Zt=4,Xt=5120,Qt=5121,Jt=5122,Kt=5123,en=5124,tn=5125,nn=34963,rn=35040,on=35044;function an(t,n,r,i){var o={},a=0,s={uint8:Qt,uint16:Kt};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=Zt,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=tn),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(e){var t=c.pop();return t||(t=new u(r.create(null,nn,!0,!1)._buffer)),h(t,e,rn,-1,-1,0,0),t}function f(e){c.push(e)}function h(i,o,a,s,u,c,l){var f;if(i.buffer.bind(),o){var h=l;l||e(o)&&(!_t(o)||e(o.data))||(h=n.oes_element_index_uint?tn:Kt),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(nn,c,a),i.buffer.dtype=f||Qt,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(f=l,!l){switch(i.buffer.dtype){case Qt:case Xt:f=Qt;break;case Kt:case Jt:f=Kt;break;case tn:case en:f=tn;break;default:ne.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,ne(f!==tn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=u;d<0&&(d=i.buffer.byteLength,f===Kt?d>>=1:f===tn&&(d>>=2)),i.vertCount=d;var p=s;if(s<0){p=Zt;var m=i.buffer.dimension;1===m&&(p=Wt),2===m&&(p=$t),3===m&&(p=Zt)}i.primType=p}function d(e){i.elementsCount--,ne(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}function p(t,n){var o=r.create(null,nn,!0),a=new u(o._buffer);function c(t){if(t)if("number"==typeof t)o(t),a.primType=Zt,a.vertCount=0|t,a.type=Qt;else{var n=null,r=on,i=-1,u=-1,l=0,f=0;Array.isArray(t)||e(t)||_t(t)?n=t:(ne.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,ne(Array.isArray(n)||e(n)||_t(n),"invalid data for element buffer")),"usage"in t&&(ne.parameter(t.usage,Dt,"invalid element buffer usage"),r=Dt[t.usage]),"primitive"in t&&(ne.parameter(t.primitive,Yt,"invalid element buffer primitive"),i=Yt[t.primitive]),"count"in t&&(ne("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(ne.parameter(t.type,s,"invalid buffer type"),f=s[t.type]),"length"in t?l=0|t.length:(l=u,f===Kt||f===Jt?l*=2:f!==tn&&f!==en||(l*=4))),h(a,n,r,i,u,l,f)}else o(),a.primType=Zt,a.vertCount=0,a.type=Qt;return c}return i.elementsCount++,c(t),c._reglType="elements",c._elements=a,c.subdata=function(e,t){return o.subdata(e,t),c},c.destroy=function(){d(a)},c}return{create:p,createStream:l,destroyStream:f,getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){At(o).forEach(d)}}}var sn=new Float32Array(1),un=new Uint32Array(sn.buffer),cn=5123;function ln(e){for(var t=Le.allocType(cn,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{sn[0]=e[n];var r=un[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function fn(t){return Array.isArray(t)||e(t)}var hn=function(e){return!(e&e-1||!e)},dn=34467,pn=3553,mn=34067,vn=34069,gn=6408,yn=6406,bn=6407,xn=6409,wn=6410,Sn=32854,_n=32855,An=36194,kn=32819,zn=32820,Tn=33635,Mn=34042,Cn=6402,In=34041,Pn=35904,Fn=35906,En=36193,Dn=33776,Nn=33777,On=33778,Ln=33779,jn=35986,Bn=35987,Rn=34798,Vn=35840,qn=35841,Gn=35842,Un=35843,Hn=36196,Yn=5121,Wn=5123,$n=5125,Zn=5126,Xn=10242,Qn=10243,Jn=10497,Kn=33071,er=33648,tr=10240,nr=10241,rr=9728,ir=9729,or=9984,ar=9985,sr=9986,ur=9987,cr=33170,lr=4352,fr=4353,hr=4354,dr=34046,pr=3317,mr=37440,vr=37441,gr=37443,yr=37444,br=33984,xr=[or,sr,ar,ur],wr=[0,xn,wn,bn,gn],Sr={};function _r(e){return"[object "+e+"]"}Sr[xn]=Sr[yn]=Sr[Cn]=1,Sr[In]=Sr[wn]=2,Sr[bn]=Sr[Pn]=3,Sr[gn]=Sr[Fn]=4;var Ar=_r("HTMLCanvasElement"),kr=_r("OffscreenCanvas"),zr=_r("CanvasRenderingContext2D"),Tr=_r("ImageBitmap"),Mr=_r("HTMLImageElement"),Cr=_r("HTMLVideoElement"),Ir=Object.keys(Ft).concat([Ar,kr,zr,Tr,Mr,Cr]),Pr=[];Pr[Yn]=1,Pr[Zn]=4,Pr[En]=2,Pr[Wn]=2,Pr[$n]=4;var Fr=[];function Er(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Dr(e){return!!Array.isArray(e)&&!(0===e.length||!fn(e[0]))}function Nr(e){return Object.prototype.toString.call(e)}function Or(e){return Nr(e)===Ar}function Lr(e){return Nr(e)===kr}function jr(e){return Nr(e)===zr}function Br(e){return Nr(e)===Tr}function Rr(e){return Nr(e)===Mr}function Vr(e){return Nr(e)===Cr}function qr(e){if(!e)return!1;var t=Nr(e);return Ir.indexOf(t)>=0||Er(e)||Dr(e)||_t(e)}function Gr(e){return 0|Ft[Object.prototype.toString.call(e)]}function Ur(e,t){var n=t.length;switch(e.type){case Yn:case Wn:case $n:case Zn:var r=Le.allocType(e.type,n);r.set(t),e.data=r;break;case En:e.data=ln(t);break;default:ne.raise("unsupported texture type, must specify a typed array")}}function Hr(e,t){return Le.allocType(e.type===En?Zn:e.type,t)}function Yr(e,t){e.type===En?(e.data=ln(t),Le.freeType(t)):e.data=t}function Wr(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,c=Hr(e,a*s*u),l=0,f=0;f<s;++f)for(var h=0;h<a;++h)for(var d=0;d<u;++d)c[l++]=t[n*h+r*f+i*d+o];Yr(e,c)}function $r(e,t,n,r,i,o){var a;if(a=void 0!==Fr[e]?Fr[e]:Sr[e]*Pr[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Zr(n,r,i,o,a,s,u){var c={"don't care":lr,"dont care":lr,nice:hr,fast:fr},l={repeat:Jn,clamp:Kn,mirror:er},f={nearest:rr,linear:ir},h=t({mipmap:ur,"nearest mipmap nearest":or,"linear mipmap nearest":ar,"nearest mipmap linear":sr,"linear mipmap linear":ur},f),d={none:0,browser:yr},p={uint8:Yn,rgba4:kn,rgb565:Tn,"rgb5 a1":zn},m={alpha:yn,luminance:xn,"luminance alpha":wn,rgb:bn,rgba:gn,rgba4:Sn,"rgb5 a1":_n,rgb565:An},v={};r.ext_srgb&&(m.srgb=Pn,m.srgba=Fn),r.oes_texture_float&&(p.float32=p.float=Zn),r.oes_texture_half_float&&(p.float16=p["half float"]=En),r.webgl_depth_texture&&(t(m,{depth:Cn,"depth stencil":In}),t(p,{uint16:Wn,uint32:$n,"depth stencil":Mn})),r.webgl_compressed_texture_s3tc&&t(v,{"rgb s3tc dxt1":Dn,"rgba s3tc dxt1":Nn,"rgba s3tc dxt3":On,"rgba s3tc dxt5":Ln}),r.webgl_compressed_texture_atc&&t(v,{"rgb atc":jn,"rgba atc explicit alpha":Bn,"rgba atc interpolated alpha":Rn}),r.webgl_compressed_texture_pvrtc&&t(v,{"rgb pvrtc 4bppv1":Vn,"rgb pvrtc 2bppv1":qn,"rgba pvrtc 4bppv1":Gn,"rgba pvrtc 2bppv1":Un}),r.webgl_compressed_texture_etc1&&(v["rgb etc1"]=Hn);var g=Array.prototype.slice.call(n.getParameter(dn));Object.keys(v).forEach((function(e){var t=v[e];g.indexOf(t)>=0&&(m[e]=t)}));var y=Object.keys(m);i.textureFormats=y;var b=[];Object.keys(m).forEach((function(e){var t=m[e];b[t]=e}));var x=[];Object.keys(p).forEach((function(e){var t=p[e];x[t]=e}));var w=[];Object.keys(f).forEach((function(e){var t=f[e];w[t]=e}));var S=[];Object.keys(h).forEach((function(e){var t=h[e];S[t]=e}));var _=[];Object.keys(l).forEach((function(e){var t=l[e];_[t]=e}));var A=y.reduce((function(e,t){var n=m[t];return n===xn||n===yn||n===xn||n===wn||n===Cn||n===In||r.ext_srgb&&(n===Pn||n===Fn)?e[n]=n:n===_n||t.indexOf("rgba")>=0?e[n]=gn:e[n]=bn,e}),{});function k(){this.internalformat=gn,this.format=gn,this.type=Yn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yr,this.width=0,this.height=0,this.channels=0}function z(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function T(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(ne.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ne.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ne.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ne.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;ne(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ne(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ne(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(n,p,"invalid texture type"),e.type=p[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(ne(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],ne(s>0&&s<=4,"invalid number of channels"),u=!0),ne(o>=0&&o<=i.maxTextureSize,"invalid width"),ne(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,ne(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,ne(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,ne(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,ne(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var c=!1;if("format"in t){var l=t.format;ne(r.webgl_depth_texture||!("depth"===l||"depth stencil"===l),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(l,m,"invalid texture format");var f=e.internalformat=m[l];e.format=A[f],l in p&&("type"in t||(e.type=p[l])),l in v&&(e.compressed=!0),c=!0}!u&&c?e.channels=Sr[e.format]:u&&!c?e.channels!==wr[e.format]&&(e.format=e.internalformat=wr[e.channels]):c&&u&&ne(e.channels===Sr[e.format],"number of channels inconsistent with specified format")}}function M(e){n.pixelStorei(mr,e.flipY),n.pixelStorei(vr,e.premultiplyAlpha),n.pixelStorei(gr,e.colorSpace),n.pixelStorei(pr,e.unpackAlignment)}function C(){k.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(qr(n)?r=n:n&&(ne.type(n,"object","invalid pixel data type"),T(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),qr(n.data)&&(r=n.data)),ne(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ne(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,ne(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Yn||(t.type=Gr(r));else if(Er(r))t.channels=t.channels||4,Ur(t,r),t.alignment=1,t.needsFree=!0;else if(_t(r)){var u=r.data;Array.isArray(u)||t.type!==Yn||(t.type=Gr(u));var c,l,f,h,d,p,m=r.shape,v=r.stride;3===m.length?(f=m[2],p=v[2]):(ne(2===m.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,p=1),c=m[0],l=m[1],h=v[0],d=v[1],t.alignment=1,t.width=c,t.height=l,t.channels=f,t.format=t.internalformat=wr[f],t.needsFree=!0,Wr(t,u,h,d,p,r.offset)}else if(Or(r)||Lr(r)||jr(r))Or(r)||Lr(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Br(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(Rr(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Vr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Dr(r)){var g=t.width||r[0].length,y=t.height||r.length,b=t.channels;b=fn(r[0][0])?b||r[0][0].length:b||1;for(var x=kt.shape(r),w=1,S=0;S<x.length;++S)w*=x[S];var _=Hr(t,w);kt.flatten(r,x,"",_),Yr(t,_),t.alignment=1,t.width=g,t.height=y,t.channels=b,t.format=t.internalformat=wr[b],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Zn?ne(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===En&&ne(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function P(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,c=e.type,l=e.width,f=e.height;M(e),i?n.texImage2D(t,r,u,u,c,i):e.compressed?n.compressedTexImage2D(t,r,s,l,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,l,f,0)):n.texImage2D(t,r,u,l,f,0,u,c,a||null)}function F(e,t,r,i,a){var s=e.element,u=e.data,c=e.internalformat,l=e.format,f=e.type,h=e.width,d=e.height;M(e),s?n.texSubImage2D(t,a,r,i,l,f,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,c,h,d,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,d)):n.texSubImage2D(t,a,r,i,h,d,l,f,u)}var E=[];function D(){return E.pop()||new C}function N(e){e.needsFree&&Le.freeType(e.data),C.call(e),E.push(e)}function O(){k.call(this),this.genMipmaps=!1,this.mipmapHint=lr,this.mipmask=0,this.images=Array(16)}function L(e,t,n){var r=e.images[0]=D();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function j(e,t){var n=null;if(qr(t))z(n=e.images[0]=D(),e),I(n,t),e.mipmask=1;else if(T(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)z(n=e.images[i]=D(),e),n.width>>=i,n.height>>=i,I(n,r[i]),e.mipmask|=1<<i;else z(n=e.images[0]=D(),e),I(n,t),e.mipmask=1;z(e,e.images[0]),!e.compressed||e.internalformat!==Dn&&e.internalformat!==Nn&&e.internalformat!==On&&e.internalformat!==Ln||ne(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function B(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;P(n[r],t,r)}}var R=[];function V(){var e=R.pop()||new O;k.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function q(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&N(t[n]),t[n]=null;R.push(e)}function G(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Kn,this.wrapT=Kn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=lr}function U(e,t){if("min"in t){var n=t.min;ne.parameter(n,h),e.minFilter=h[n],xr.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;ne.parameter(r,f),e.magFilter=f[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(ne.parameter(s,l),o=a=l[s]):Array.isArray(s)&&(ne.parameter(s[0],l),ne.parameter(s[1],l),o=l[s[0]],a=l[s[1]])}else{if("wrapS"in t){var u=t.wrapS;ne.parameter(u,l),o=l[u]}if("wrapT"in t){var d=t.wrapT;ne.parameter(d,l),a=l[d]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var p=t.anisotropic;ne("number"==typeof p&&p>=1&&p<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var m=!1;switch(typeof t.mipmap){case"string":ne.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,m=!0;break;case"boolean":m=e.genMipmaps=t.mipmap;break;case"object":ne(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,m=!0;break;default:ne.raise("invalid mipmap type")}m&&!("min"in t)&&(e.minFilter=or)}}function H(e,t){n.texParameteri(t,nr,e.minFilter),n.texParameteri(t,tr,e.magFilter),n.texParameteri(t,Xn,e.wrapS),n.texParameteri(t,Qn,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,dr,e.anisotropic),e.genMipmaps&&(n.hint(cr,e.mipmapHint),n.generateMipmap(t))}var Y=0,W={},$=i.maxTextureUnits,Z=Array($).map((function(){return null}));function X(e){k.call(this),this.mipmask=0,this.internalformat=gn,this.id=Y++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,u.profile&&(this.stats={size:0})}function Q(e){n.activeTexture(br),n.bindTexture(e.target,e.texture)}function J(){var e=Z[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(pn,null)}function K(e){var t=e.texture;ne(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(br+r),n.bindTexture(i,null),Z[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete W[e.id],s.textureCount--}function ee(e,t){var r=new X(pn);function o(e,t){var n=r.texInfo;G.call(n);var a=V();return"number"==typeof e?L(a,0|e,"number"==typeof t?0|t:0|e):e?(ne.type(e,"object","invalid arguments to regl.texture"),U(n,e),j(a,e)):L(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,z(r,a),ne.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,Q(r),B(a,pn),H(n,pn),J(),q(a),u.profile&&(r.stats.size=$r(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=x[r.type],o.mag=w[n.magFilter],o.min=S[n.minFilter],o.wrapS=_[n.wrapS],o.wrapT=_[n.wrapT],o}function a(e,t,n,i){ne(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,c=D();return z(c,r),c.width=0,c.height=0,I(c,e),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,ne(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),ne(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),ne(r.mipmask&1<<u,"missing mipmap data"),ne(c.data||c.element||c.needsCopy,"missing image data"),Q(r),F(c,pn,a,s,u),J(),N(c),o}function c(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,Q(r);for(var s=0;r.mipmask>>s;++s){var c=i>>s,l=a>>s;if(!c||!l)break;n.texImage2D(pn,s,r.format,c,l,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=$r(r.internalformat,r.type,i,a,!1,!1)),o}return W[r.id]=r,s.textureCount++,o(e,t),o.subimage=a,o.resize=c,o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function te(e,t,r,o,a,c){var l=new X(mn);W[l.id]=l,s.cubeCount++;var f=new Array(6);function h(e,t,n,r,o,a){var s,c=l.texInfo;for(G.call(c),s=0;s<6;++s)f[s]=V();if("number"!=typeof e&&e)if("object"==typeof e)if(t)j(f[0],e),j(f[1],t),j(f[2],n),j(f[3],r),j(f[4],o),j(f[5],a);else if(U(c,e),T(l,e),"faces"in e){var d=e.faces;for(ne(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),s=0;s<6;++s)ne("object"==typeof d[s]&&!!d[s],"invalid input for cube map face"),z(f[s],l),j(f[s],d[s])}else for(s=0;s<6;++s)j(f[s],e);else ne.raise("invalid arguments to cube map");else{var p=0|e||1;for(s=0;s<6;++s)L(f[s],p,p)}for(z(l,f[0]),ne.optional((function(){i.npotTextureCube||ne(hn(l.width)&&hn(l.height),"your browser does not support non power or two texture dimensions")})),c.genMipmaps?l.mipmask=(f[0].width<<1)-1:l.mipmask=f[0].mipmask,ne.textureCube(l,c,f,i),l.internalformat=f[0].internalformat,h.width=f[0].width,h.height=f[0].height,Q(l),s=0;s<6;++s)B(f[s],vn+s);for(H(c,mn),J(),u.profile&&(l.stats.size=$r(l.internalformat,l.type,h.width,h.height,c.genMipmaps,!0)),h.format=b[l.internalformat],h.type=x[l.type],h.mag=w[c.magFilter],h.min=S[c.minFilter],h.wrapS=_[c.wrapS],h.wrapT=_[c.wrapT],s=0;s<6;++s)q(f[s]);return h}function d(e,t,n,r,i){ne(!!t,"must specify image data"),ne("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return z(u,l),u.width=0,u.height=0,I(u,t),u.width=u.width||(l.width>>s)-o,u.height=u.height||(l.height>>s)-a,ne(l.type===u.type&&l.format===u.format&&l.internalformat===u.internalformat,"incompatible format for texture.subimage"),ne(o>=0&&a>=0&&o+u.width<=l.width&&a+u.height<=l.height,"texture.subimage write out of bounds"),ne(l.mipmask&1<<s,"missing mipmap data"),ne(u.data||u.element||u.needsCopy,"missing image data"),Q(l),F(u,vn+e,o,a,s),J(),N(u),h}function p(e){var t=0|e;if(t!==l.width){h.width=l.width=t,h.height=l.height=t,Q(l);for(var r=0;r<6;++r)for(var i=0;l.mipmask>>i;++i)n.texImage2D(vn+r,i,l.format,t>>i,t>>i,0,l.format,l.type,null);return J(),u.profile&&(l.stats.size=$r(l.internalformat,l.type,h.width,h.height,!1,!0)),h}}return h(e,t,r,o,a,c),h.subimage=d,h.resize=p,h._reglType="textureCube",h._texture=l,u.profile&&(h.stats=l.stats),h.destroy=function(){l.decRef()},h}function re(){for(var e=0;e<$;++e)n.activeTexture(br+e),n.bindTexture(pn,null),Z[e]=null;At(W).forEach(K),s.cubeCount=0,s.textureCount=0}function ie(){for(var e=0;e<$;++e){var t=Z[e];t&&(t.bindCount=0,t.unit=-1,Z[e]=null)}At(W).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===pn)n.texImage2D(pn,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(vn+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);H(e.texInfo,e.target)}))}function oe(){for(var e=0;e<$;++e){var t=Z[e];t&&(t.bindCount=0,t.unit=-1,Z[e]=null),n.activeTexture(br+e),n.bindTexture(pn,null),n.bindTexture(mn,null)}}return t(X.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<$;++r){var i=Z[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Z[r]=e,t=r;break}t>=$&&ne.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,n.activeTexture(br+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&K(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(W).forEach((function(t){e+=W[t].stats.size})),e}),{create2D:ee,createCube:te,clear:re,getTexture:function(e){return null},restore:ie,refresh:oe}}Fr[Sn]=2,Fr[_n]=2,Fr[An]=2,Fr[In]=4,Fr[Dn]=.5,Fr[Nn]=.5,Fr[On]=1,Fr[Ln]=1,Fr[jn]=.5,Fr[Bn]=1,Fr[Rn]=1,Fr[Vn]=.5,Fr[qn]=.25,Fr[Gn]=.5,Fr[Un]=.25,Fr[Hn]=.5;var Xr=36161,Qr=32854,Jr=32855,Kr=36194,ei=33189,ti=36168,ni=34041,ri=35907,ii=34836,oi=34842,ai=34843,si=[];function ui(e,t,n){return si[e]*t*n}si[Qr]=2,si[Jr]=2,si[Kr]=2,si[ei]=2,si[ti]=1,si[ni]=4,si[ri]=4,si[ii]=16,si[oi]=8,si[ai]=6;var ci=function(e,t,n,r,i){var o={rgba4:Qr,rgb565:Kr,"rgb5 a1":Jr,depth:ei,stencil:ti,"depth stencil":ni};t.ext_srgb&&(o.srgba=ri),t.ext_color_buffer_half_float&&(o.rgba16f=oi,o.rgb16f=ai),t.webgl_color_buffer_float&&(o.rgba32f=ii);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function c(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=Qr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function l(t){var n=t.renderbuffer;ne(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(Xr,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}function f(t,s){var l=new c(e.createRenderbuffer());function f(t,r){var s=0,u=0,c=Qr;if("object"==typeof t&&t){var h=t;if("shape"in h){var d=h.shape;ne(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),s=0|d[0],u=0|d[1]}else"radius"in h&&(s=u=0|h.radius),"width"in h&&(s=0|h.width),"height"in h&&(u=0|h.height);"format"in h&&(ne.parameter(h.format,o,"invalid renderbuffer format"),c=o[h.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?ne.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(ne(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==l.width||u!==l.height||c!==l.format)return f.width=l.width=s,f.height=l.height=u,l.format=c,e.bindRenderbuffer(Xr,l.renderbuffer),e.renderbufferStorage(Xr,c,s,u),ne(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height)),f.format=a[l.format],f}function h(t,r){var o=0|t,a=0|r||o;return o===l.width&&a===l.height||(ne(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=l.width=o,f.height=l.height=a,e.bindRenderbuffer(Xr,l.renderbuffer),e.renderbufferStorage(Xr,l.format,o,a),ne(0===e.getError(),"invalid render buffer format"),i.profile&&(l.stats.size=ui(l.format,l.width,l.height))),f}return u[l.id]=l,r.renderbufferCount++,f(t,s),f.resize=h,f._reglType="renderbuffer",f._renderbuffer=l,i.profile&&(f.stats=l.stats),f.destroy=function(){l.decRef()},f}function h(){At(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(Xr,t.renderbuffer),e.renderbufferStorage(Xr,t.format,t.width,t.height)})),e.bindRenderbuffer(Xr,null)}return c.prototype.decRef=function(){--this.refCount<=0&&l(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:f,clear:function(){At(u).forEach(l)},restore:h}},li=36160,fi=36161,hi=3553,di=34069,pi=36064,mi=36096,vi=36128,gi=33306,yi=36053,bi=36054,xi=36055,wi=36057,Si=36061,_i=36193,Ai=5121,ki=5126,zi=6407,Ti=6408,Mi=6402,Ci=[zi,Ti],Ii=[];Ii[Ti]=4,Ii[zi]=3;var Pi=[];Pi[Ai]=1,Pi[ki]=4,Pi[_i]=2;var Fi=33189,Ei=36168,Di=34041,Ni=[32854,32855,36194,35907,34842,34843,34836],Oi={};function Li(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var l=["uint8"];function f(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function h(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);ne(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;ne(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function p(t,n){n&&(n.texture?e.framebufferTexture2D(li,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(li,t,fi,n.renderbuffer._renderbuffer.renderbuffer))}function m(e){var t=hi,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),ne.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,ne(t===hi)):"textureCube"===o?(n=i,ne(t>=di&&t<di+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=fi):ne.raise("invalid regl object for attachment"),new f(t,n,r)}function v(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new f(hi,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new f(fi,null,u)}function g(e){return e&&(e.texture||e.renderbuffer)}function y(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&l.push("half float","float16"),n.oes_texture_float&&l.push("float","float32");var b=0,x={};function w(){this.id=b++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function S(e){e.colorAttachments.forEach(h),h(e.depthAttachment),h(e.stencilAttachment),h(e.depthStencilAttachment)}function _(t){var n=t.framebuffer;ne(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete x[t.id]}function A(t){var n;e.bindFramebuffer(li,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)p(pi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(li,pi+n,hi,null,0);e.framebufferTexture2D(li,gi,hi,null,0),e.framebufferTexture2D(li,mi,hi,null,0),e.framebufferTexture2D(li,vi,hi,null,0),p(mi,t.depthAttachment),p(vi,t.stencilAttachment),p(gi,t.depthStencilAttachment);var o=e.checkFramebufferStatus(li);e.isContextLost()||o===yi||ne.raise("framebuffer configuration not supported, status = "+Oi[o]),e.bindFramebuffer(li,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function k(e,i){var o=new w;function f(e,t){var i;ne(s.next!==o,"can not update framebuffer which is currently in use");var a=0,h=0,p=!0,y=!0,b=null,x=!0,w="rgba",_="uint8",k=1,z=null,T=null,M=null,C=!1;if("number"==typeof e)a=0|e,h=0|t||a;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var I=e;if("shape"in I){var P=I.shape;ne(Array.isArray(P)&&P.length>=2,"invalid shape for framebuffer"),a=P[0],h=P[1]}else"radius"in I&&(a=h=I.radius),"width"in I&&(a=I.width),"height"in I&&(h=I.height);("color"in I||"colors"in I)&&(b=I.color||I.colors,Array.isArray(b)&&ne(1===b.length||n.webgl_draw_buffers,"multiple render targets not supported")),b||("colorCount"in I&&(k=0|I.colorCount,ne(k>0,"invalid color buffer count")),"colorTexture"in I&&(x=!!I.colorTexture,w="rgba4"),"colorType"in I&&(_=I.colorType,x?(ne(n.oes_texture_float||!("float"===_||"float32"===_),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ne(n.oes_texture_half_float||!("half float"===_||"float16"===_),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===_||"float16"===_?(ne(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),w="rgba16f"):"float"!==_&&"float32"!==_||(ne(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),w="rgba32f"),ne.oneOf(_,l,"invalid color type")),"colorFormat"in I&&(w=I.colorFormat,u.indexOf(w)>=0?x=!0:c.indexOf(w)>=0?x=!1:ne.optional((function(){x?ne.oneOf(I.colorFormat,u,"invalid color format for texture"):ne.oneOf(I.colorFormat,c,"invalid color format for renderbuffer")})))),("depthTexture"in I||"depthStencilTexture"in I)&&(C=!(!I.depthTexture&&!I.depthStencilTexture),ne(!C||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in I&&("boolean"==typeof I.depth?p=I.depth:(z=I.depth,y=!1)),"stencil"in I&&("boolean"==typeof I.stencil?y=I.stencil:(T=I.stencil,p=!1)),"depthStencil"in I&&("boolean"==typeof I.depthStencil?p=y=I.depthStencil:(M=I.depthStencil,p=!1,y=!1))}else a=h=1;var F=null,E=null,D=null,N=null;if(Array.isArray(b))F=b.map(m);else if(b)F=[m(b)];else for(F=new Array(k),i=0;i<k;++i)F[i]=v(a,h,x,w,_);ne(n.webgl_draw_buffers||F.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ne(F.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||F[0].width,h=h||F[0].height,z?E=m(z):p&&!y&&(E=v(a,h,C,"depth","uint32")),T?D=m(T):y&&!p&&(D=v(a,h,!1,"stencil","uint8")),M?N=m(M):!z&&!T&&y&&p&&(N=v(a,h,C,"depth stencil","depth stencil")),ne(!!z+!!T+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var O=null;for(i=0;i<F.length;++i)if(d(F[i],a,h),ne(!F[i]||F[i].texture&&Ci.indexOf(F[i].texture._texture.format)>=0||F[i].renderbuffer&&Ni.indexOf(F[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),F[i]&&F[i].texture){var L=Ii[F[i].texture._texture.format]*Pi[F[i].texture._texture.type];null===O?O=L:ne(O===L,"all color attachments much have the same number of bits per pixel.")}return d(E,a,h),ne(!E||E.texture&&E.texture._texture.format===Mi||E.renderbuffer&&E.renderbuffer._renderbuffer.format===Fi,"invalid depth attachment for framebuffer object"),d(D,a,h),ne(!D||D.renderbuffer&&D.renderbuffer._renderbuffer.format===Ei,"invalid stencil attachment for framebuffer object"),d(N,a,h),ne(!N||N.texture&&N.texture._texture.format===Di||N.renderbuffer&&N.renderbuffer._renderbuffer.format===Di,"invalid depth-stencil attachment for framebuffer object"),S(o),o.width=a,o.height=h,o.colorAttachments=F,o.depthAttachment=E,o.stencilAttachment=D,o.depthStencilAttachment=N,f.color=F.map(g),f.depth=g(E),f.stencil=g(D),f.depthStencil=g(N),f.width=o.width,f.height=o.height,A(o),f}function h(e,t){ne(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return f;for(var i=o.colorAttachments,a=0;a<i.length;++a)y(i[a],n,r);return y(o.depthAttachment,n,r),y(o.stencilAttachment,n,r),y(o.depthStencilAttachment,n,r),o.width=f.width=n,o.height=f.height=r,A(o),f}return a.framebufferCount++,f(e,i),t(f,{resize:h,_reglType:"framebuffer",_framebuffer:o,destroy:function(){_(o),S(o)},use:function(e){s.setFBO({framebuffer:f},e)}})}function z(e){var o=Array(6);function a(e){var r;ne(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var c,f={color:null},h=0,d=null,p="rgba",m="uint8",v=1;if("number"==typeof e)h=0|e;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var g=e;if("shape"in g){var y=g.shape;ne(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),ne(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in g&&(h=0|g.radius),"width"in g?(h=0|g.width,"height"in g&&ne(g.height===h,"must be square")):"height"in g&&(h=0|g.height);("color"in g||"colors"in g)&&(d=g.color||g.colors,Array.isArray(d)&&ne(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in g&&(v=0|g.colorCount,ne(v>0,"invalid color buffer count")),"colorType"in g&&(ne.oneOf(g.colorType,l,"invalid color type"),m=g.colorType),"colorFormat"in g&&(p=g.colorFormat,ne.oneOf(g.colorFormat,u,"invalid color format for texture"))),"depth"in g&&(f.depth=g.depth),"stencil"in g&&(f.stencil=g.stencil),"depthStencil"in g&&(f.depthStencil=g.depthStencil)}else h=1;if(d)if(Array.isArray(d))for(c=[],r=0;r<d.length;++r)c[r]=d[r];else c=[d];else{c=Array(v);var b={radius:h,format:p,type:m};for(r=0;r<v;++r)c[r]=i.createCube(b)}for(f.color=Array(c.length),r=0;r<c.length;++r){var x=c[r];ne("function"==typeof x&&"textureCube"===x._reglType,"invalid cube map"),h=h||x.width,ne(x.width===h&&x.height===h,"invalid cube map shape"),f.color[r]={target:di,data:c[r]}}for(r=0;r<6;++r){for(var w=0;w<c.length;++w)f.color[w].target=di+r;r>0&&(f.depth=o[0].depth,f.stencil=o[0].stencil,f.depthStencil=o[0].depthStencil),o[r]?o[r](f):o[r]=k(f)}return t(a,{width:h,height:h,color:c})}function c(e){var t,n=0|e;if(ne(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a}return a(e),t(a,{faces:o,resize:c,_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})}function T(){s.cur=null,s.next=null,s.dirty=!0,At(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),A(t)}))}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof w)return t}return null},create:k,createCube:z,clear:function(){At(x).forEach(_)},restore:T})}Oi[yi]="complete",Oi[bi]="incomplete attachment",Oi[wi]="incomplete dimensions",Oi[xi]="incomplete, missing attachment",Oi[Si]="unsupported";var ji=5126,Bi=34962,Ri=34963,Vi=["attributes","elements","offset","count","primitive","instances"];function qi(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=ji,this.offset=0,this.stride=0,this.divisor=0}function Gi(t,n,r,i,o,a,s){for(var u=r.maxAttributes,c=new Array(u),l=0;l<u;++l)c[l]=new qi;var f=0,h={},d={Record:qi,scope:{},state:c,currentVAO:null,targetVAO:null,restore:m()?S:function(){},createVAO:_,getVAO:g,destroyBuffer:p,setVAO:m()?y:b,clear:m()?x:function(){}};function p(e){for(var n=0;n<c.length;++n){var r=c[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function m(){return n.oes_vertex_array_object}function v(){return n.angle_instanced_arrays}function g(e){return"function"==typeof e&&e._vao?e._vao:null}function y(e){if(e!==d.currentVAO){var t=m();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),d.currentVAO=e}}function b(e){if(e!==d.currentVAO){if(e)e.bindAttrs();else{for(var n=v(),r=0;r<c.length;++r){var i=c[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(Ri,s.elements.buffer.buffer):t.bindBuffer(Ri,null)}d.currentVAO=e}}function x(){At(h).forEach((function(e){e.destroy()}))}function w(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=m();this.vao=e?e.createVertexArrayOES():null,h[this.id]=this,this.buffers=[]}function S(){m()&&At(h).forEach((function(e){e.refresh()}))}function _(t){var r=new w;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(ne("object"==typeof t,"invalid arguments for create vao"),ne("attributes"in t,"must specify attributes for vao"),t.elements){var c=t.elements;r.ownsElements?"function"==typeof c&&"elements"===c._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(c),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(ne(t.primitive in Yt,"bad primitive type: "+t.primitive),r.primitive=Yt[t.primitive]),ne.optional((()=>{for(var e=Object.keys(t),n=0;n<e.length;++n)ne(Vi.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Vi)})),ne(Array.isArray(i),"attributes must be an array")}ne(i.length<u,"too many attributes"),ne(i.length>0,"must specify at least one attribute");var l={},f=r.attributes;f.length=i.length;for(var h=0;h<i.length;++h){var d,p=i[h],m=f[h]=new qi,v=p.data||p;Array.isArray(v)||e(v)||_t(v)?(r.buffers[h]&&(d=r.buffers[h],e(v)&&d._buffer.byteLength>=v.byteLength?d.subdata(v):(d.destroy(),r.buffers[h]=null)),r.buffers[h]||(d=r.buffers[h]=o.create(p,Bi,!1,!0)),m.buffer=o.getBuffer(d),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1,l[h]=1):o.getBuffer(p)?(m.buffer=o.getBuffer(p),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1):o.getBuffer(p.buffer)?(m.buffer=o.getBuffer(p.buffer),m.size=0|(+p.size||m.buffer.dimension),m.normalized=!!p.normalized||!1,"type"in p?(ne.parameter(p.type,Et,"invalid buffer type"),m.type=Et[p.type]):m.type=m.buffer.dtype,m.offset=0|(p.offset||0),m.stride=0|(p.stride||0),m.divisor=0|(p.divisor||0),m.state=1,ne(m.size>=1&&m.size<=4,"size must be between 1 and 4"),ne(m.offset>=0,"invalid offset"),ne(m.stride>=0&&m.stride<=255,"stride must be between 0 and 255"),ne(m.divisor>=0,"divisor must be positive"),ne(!m.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in p?(ne(h>0,"first attribute must not be a constant"),m.x=+p.x||0,m.y=+p.y||0,m.z=+p.z||0,m.w=+p.w||0,m.state=2):ne(!1,"invalid attribute spec for location "+h)}for(var g=0;g<r.buffers.length;++g)!l[g]&&r.buffers[g]&&(r.buffers[g].destroy(),r.buffers[g]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)}return w.prototype.bindAttrs=function(){for(var e=v(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(Bi,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(Ri,s.buffer.buffer):t.bindBuffer(Ri,null)},w.prototype.refresh=function(){var e=m();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,e.bindVertexArrayOES(null))},w.prototype.destroy=function(){if(this.vao){var e=m();this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),h[this.id]&&(delete h[this.id],i.vaoCount-=1)},d}var Ui=35632,Hi=35633,Yi=35718,Wi=35721;function $i(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function c(t,r,i){var s=t===Ui?o:a,u=s[r];if(!u){var c=n.str(r);u=e.createShader(t),e.shaderSource(u,c),e.compileShader(u),ne.shaderError(e,u,c,t,i),s[r]=u}return u}var l={},f=[],h=0;function d(e,t){this.id=h++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(t,r,o){var a,l,f=c(Ui,t.fragId),h=c(Hi,t.vertId),d=t.program=e.createProgram();if(e.attachShader(d,f),e.attachShader(d,h),o)for(a=0;a<o.length;++a){var p=o[a];e.bindAttribLocation(d,p[0],p[1])}e.linkProgram(d),ne.linkError(e,d,n.str(t.fragId),n.str(t.vertId),r);var m=e.getProgramParameter(d,Yi);i.profile&&(t.stats.uniformsCount=m);var v=t.uniforms;for(a=0;a<m;++a)if(l=e.getActiveUniform(d,a)){if(l.size>1)for(var g=0;g<l.size;++g){var y=l.name.replace("[0]","["+g+"]");u(v,new s(y,n.id(y),e.getUniformLocation(d,y),l))}var b=l.name;l.size>1&&(b=b.replace("[0]","")),u(v,new s(b,n.id(b),e.getUniformLocation(d,b),l))}var x=e.getProgramParameter(d,Wi);i.profile&&(t.stats.attributesCount=x);var w=t.attributes;for(a=0;a<x;++a)(l=e.getActiveAttrib(d,a))&&u(w,new s(l.name,n.id(l.name),e.getAttribLocation(d,l.name),l))}function m(){o={},a={};for(var e=0;e<f.length;++e)p(f[e],null,f[e].attributes.map((function(e){return[e.location,e.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return f.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return f.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);At(o).forEach(t),o={},At(a).forEach(t),a={},f.forEach((function(t){e.deleteProgram(t.program)})),f.length=0,l={},r.shaderCount=0},program:function(n,i,s,u){ne.command(n>=0,"missing vertex shader",s),ne.command(i>=0,"missing fragment shader",s);var c=l[i];c||(c=l[i]={});var h=c[n];if(h&&(h.refCount++,!u))return h;var m=new d(i,n);return r.shaderCount++,p(m,s,u),h||(c[n]=m),f.push(m),t(m,{destroy:function(){if(m.refCount--,m.refCount<=0){e.deleteProgram(m.program);var t=f.indexOf(m);f.splice(t,1),r.shaderCount--}c[m.vertId].refCount<=0&&(e.deleteShader(a[m.vertId]),delete a[m.vertId],delete l[m.fragId][m.vertId]),Object.keys(l[m.fragId]).length||(e.deleteShader(o[m.fragId]),delete o[m.fragId],delete l[m.fragId])}})},restore:m,shader:c,frag:-1,vert:-1}}var Zi=6408,Xi=5121,Qi=3333,Ji=5126;function Ki(t,n,r,i,o,a,s){function u(u){var c;null===n.next?(ne(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=Xi):(ne(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,ne.optional((function(){a.oes_texture_float?(ne(c===Xi||c===Ji,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===Ji&&ne(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ne(c===Xi,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,f=0,h=i.framebufferWidth,d=i.framebufferHeight,p=null;e(u)?p=u:u&&(ne.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,f=0|u.y,ne(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),ne(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-l),d=0|(u.height||i.framebufferHeight-f),p=u.data||null),p&&(c===Xi?ne(p instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===Ji&&ne(p instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ne(h>0&&h+l<=i.framebufferWidth,"invalid width for read pixels"),ne(d>0&&d+f<=i.framebufferHeight,"invalid height for read pixels"),r();var m=h*d*4;return p||(c===Xi?p=new Uint8Array(m):c===Ji&&(p=p||new Float32Array(m))),ne.isTypedArray(p,"data buffer for regl.read() must be a typedarray"),ne(p.byteLength>=m,"data buffer for regl.read() too small"),t.pixelStorei(Qi,4),t.readPixels(l,f,h,d,Zi,c,p),p}function c(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}function l(e){return e&&"framebuffer"in e?c(e):u(e)}return l}function eo(e){return Array.prototype.slice.call(e)}function to(e){return eo(e).join("")}function no(){var e=0,n=[],r=[];function i(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o}function o(){var n=[];function r(){n.push.apply(n,eo(arguments))}var i=[];function o(){var t="v"+e++;return i.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,eo(arguments)),n.push(";")),t}return t(r,{def:o,toString:function(){return to([i.length>0?"var "+i.join(",")+";":"",to(n)])}})}function a(){var e=o(),n=o(),r=e.toString,i=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,eo(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}function s(){var e=to(arguments),n=a(),r=a(),i=n.toString,o=r.toString;return t(n,{then:function(){return n.apply(n,eo(arguments)),this},else:function(){return r.apply(r,eo(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),to(["if(",e,"){",i(),"}",t])}})}var u=o(),c={};function l(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var o=0;o<n;++o)i();var s=a(),u=s.toString;return c[e]=t(s,{arg:i,toString:function(){return to(["function(",r.join(),"){",u(),"}"])}})}function f(){var e=['"use strict";',u,"return {"];Object.keys(c).forEach((function(t){e.push('"',t,'":',c[t].toString(),",")})),e.push("}");var t=to(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}return{global:u,link:i,block:o,proc:l,scope:a,cond:s,compile:f}}var ro="xyzw".split(""),io=5121,oo=1,ao=2,so=0,uo=1,co=2,lo=3,fo=4,ho=5,po=6,mo="dither",vo="blend.enable",go="blend.color",yo="blend.equation",bo="blend.func",xo="depth.enable",wo="depth.func",So="depth.range",_o="depth.mask",Ao="colorMask",ko="cull.enable",zo="cull.face",To="frontFace",Mo="lineWidth",Co="polygonOffset.enable",Io="polygonOffset.offset",Po="sample.alpha",Fo="sample.enable",Eo="sample.coverage",Do="stencil.enable",No="stencil.mask",Oo="stencil.func",Lo="stencil.opFront",jo="stencil.opBack",Bo="scissor.enable",Ro="scissor.box",Vo="viewport",qo="profile",Go="framebuffer",Uo="vert",Ho="frag",Yo="elements",Wo="primitive",$o="count",Zo="offset",Xo="instances",Qo="vao",Jo="Width",Ko="Height",ea=Go+Jo,ta=Go+Ko,na=Vo+Jo,ra=Vo+Ko,ia="drawingBuffer",oa=ia+Jo,aa=ia+Ko,sa=[bo,yo,Oo,Lo,jo,Eo,Vo,Ro,Io],ua=34962,ca=34963,la=3553,fa=34067,ha=2884,da=3042,pa=3024,ma=2960,va=2929,ga=3089,ya=32823,ba=32926,xa=32928,wa=5126,Sa=35664,_a=35665,Aa=35666,ka=5124,za=35667,Ta=35668,Ma=35669,Ca=35670,Ia=35671,Pa=35672,Fa=35673,Ea=35674,Da=35675,Na=35676,Oa=35678,La=35680,ja=4,Ba=1028,Ra=1029,Va=2304,qa=2305,Ga=32775,Ua=32776,Ha=519,Ya=7680,Wa=0,$a=1,Za=32774,Xa=513,Qa=36160,Ja=36064,Ka={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},es=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ts={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ns={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rs={frag:35632,vert:35633},is={cw:Va,ccw:qa};function os(t){return Array.isArray(t)||e(t)||_t(t)}function as(e){return e.sort((function(e,t){return e===Vo?-1:t===Vo?1:e<t?-1:1}))}function ss(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function us(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function cs(e){return new ss(!1,!1,!1,e)}function ls(e,t){var n=e.type;if(n===so){var r=e.data.length;return new ss(!0,r>=1,r>=2,t)}if(n===fo){var i=e.data;return new ss(i.thisDep,i.contextDep,i.propDep,t)}if(n===ho)return new ss(!1,!1,!1,t);if(n===po){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var c=e.data[u];if(c.type===uo)s=!0;else if(c.type===co)a=!0;else if(c.type===lo)o=!0;else if(c.type===so){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else c.type===fo&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new ss(o,a,s,t)}return new ss(n===lo,n===co,n===uo,t)}var fs=new ss(!1,!1,!1,(function(){}));function hs(e,n,r,i,o,a,s,u,c,l,f,h,d,p,m){var v=l.Record,g={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(g.min=Ga,g.max=Ua);var y=r.angle_instanced_arrays,b=r.webgl_draw_buffers,x=r.oes_vertex_array_object,w={dirty:!0,profile:m.profile},S={},_=[],A={},k={};function z(e){return e.replace(".","_")}function T(e,t,n){var r=z(e);_.push(e),S[r]=w[r]=!!n,A[r]=t}function M(e,t,n){var r=z(e);_.push(e),Array.isArray(n)?(w[r]=n.slice(),S[r]=n.slice()):w[r]=S[r]=n,k[r]=t}T(mo,pa),T(vo,da),M(go,"blendColor",[0,0,0,0]),M(yo,"blendEquationSeparate",[Za,Za]),M(bo,"blendFuncSeparate",[$a,Wa,$a,Wa]),T(xo,va,!0),M(wo,"depthFunc",Xa),M(So,"depthRange",[0,1]),M(_o,"depthMask",!0),M(Ao,Ao,[!0,!0,!0,!0]),T(ko,ha),M(zo,"cullFace",Ra),M(To,To,qa),M(Mo,Mo,1),T(Co,ya),M(Io,"polygonOffset",[0,0]),T(Po,ba),T(Fo,xa),M(Eo,"sampleCoverage",[1,!1]),T(Do,ma),M(No,"stencilMask",-1),M(Oo,"stencilFunc",[Ha,0,-1]),M(Lo,"stencilOpSeparate",[Ba,Ya,Ya,Ya]),M(jo,"stencilOpSeparate",[Ra,Ya,Ya,Ya]),T(Bo,ga),M(Ro,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),M(Vo,Vo,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var C={gl:e,context:d,strings:n,next:S,current:w,draw:h,elements:a,buffer:o,shader:f,attributes:l.state,vao:l,uniforms:c,framebuffer:u,extensions:r,timer:p,isBufferArgs:os},I={primTypes:Yt,compareFuncs:ts,blendFuncs:Ka,blendEquations:g,stencilOps:ns,glTypes:Et,orientationType:is};ne.optional((function(){C.isArrayLike=fn})),b&&(I.backBuffer=[Ra],I.drawBuffer=ze(i.maxDrawbuffers,(function(e){return 0===e?[0]:ze(e,(function(e){return Ja+e}))})));var P=0;function F(){var e=no(),t=e.link,r=e.global;e.id=P++,e.batchId="0";var i=t(C),o=e.shared={props:"a0"};Object.keys(C).forEach((function(e){o[e]=r.def(i,".",e)})),ne.optional((function(){e.CHECK=t(ne),e.commandStr=ne.guessCommand(),e.command=t(e.commandStr),e.assert=function(e,n,r){e("if(!(",n,"))",this.CHECK,".commandRaise(",t(r),",",this.command,");")},I.invalidBlendCombinations=es}));var a=e.next={},s=e.current={};Object.keys(k).forEach((function(e){Array.isArray(w[e])&&(a[e]=r.def(o.next,".",e),s[e]=r.def(o.current,".",e))}));var u=e.constants={};Object.keys(I).forEach((function(e){u[e]=r.def(JSON.stringify(I[e]))})),e.invoke=function(n,r){switch(r.type){case so:var i=["this",o.context,o.props,e.batchId];return n.def(t(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case uo:return n.def(o.props,r.data);case co:return n.def(o.context,r.data);case lo:return n.def("this",r.data);case fo:return r.data.append(e,n),r.data.ref;case ho:return r.data.toString();case po:return r.data.map((function(t){return e.invoke(n,t)}))}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var r=n.id(e);if(r in c)return c[r];var i=l.scope[r];return i||(i=l.scope[r]=new v),c[r]=t(i)},e}function E(e){var t,n=e.static,r=e.dynamic;if(qo in n){var i=!!n[qo];(t=cs((function(e,t){return i}))).enable=i}else if(qo in r){var o=r[qo];t=ls(o,(function(e,t){return e.invoke(t,o)}))}return t}function D(e,t){var n=e.static,r=e.dynamic;if(Go in n){var i=n[Go];return i?(i=u.getFramebuffer(i),ne.command(i,"invalid framebuffer object"),cs((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+ea,n+".width"),t.set(o,"."+ta,n+".height"),n}))):cs((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+ea,r+"."+oa),t.set(r,"."+ta,r+"."+aa),"null"}))}if(Go in r){var o=r[Go];return ls(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");ne.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+ea,a+"?"+a+".width:"+s+"."+oa),t.set(s,"."+ta,a+"?"+a+".height:"+s+"."+aa),a}))}return null}function N(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];ne.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,ne.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,ne.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ss(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",ea,"-",c));var i=s;return"height"in o||(i=t.def(n,".",ta,"-",l)),[c,l,r,i]}))}if(e in i){var f=i[e],h=ls(f,(function(t,n){var r=t.invoke(n,f);ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",ea,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",ta,"-",a,")");return ne.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new ss(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",ea),t.def(n,".",ta)]})):null}var a=o(Vo);if(a){var s=a;a=new ss(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+na,n[2]),t.set(r,"."+ra,n[3]),n}))}return{viewport:a,scissor_box:o(Ro)}}function O(e,t){var n=e.static;if("string"==typeof n[Ho]&&"string"==typeof n[Uo]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)ne("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function L(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);ne.optional((function(){f.shader(rs[e],t,ne.guessCommand())}));var r=cs((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return ls(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return ne.optional((function(){n(t.shared.shader,".shader(",rs[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Ho),c=a(Uo),l=null;return us(u)&&us(c)?(l=f.program(c.id,u.id,null,r),s=cs((function(e,t){return e.link(l)}))):s=new ss(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Ho);var i=r+".program("+(c?c.append(e,t):t.def(r,".",Uo))+","+n;return ne.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:c,progVar:s,program:l}}function j(e,t){var n=e.static,r=e.dynamic,i={},o=!1;function s(){if(Qo in n){var e=n[Qo];return null!==e&&null===l.getVAO(e)&&(e=l.createVAO(e)),o=!0,i.vao=e,cs((function(t){var n=l.getVAO(e);return n?t.link(n):"null"}))}if(Qo in r){o=!0;var t=r[Qo];return ls(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),c=!1;function f(){if(Yo in n){var e=n[Yo];if(i.elements=e,os(e)){var s=i.elements=a.create(e,!0);e=a.getElements(s),c=!0}else e&&(e=a.getElements(e),c=!0,ne.command(e,"invalid elements",t.commandStr));var l=cs((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return l.value=e,l}if(Yo in r){c=!0;var f=r[Yo];return ls(f,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,f),a=t.def("null"),s=t.def(r,"(",o,")"),u=e.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return ne.optional((function(){e.assert(u.else,"!"+o+"||"+a,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",a,");")),e.ELEMENTS=a,a}))}return o?new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}var h=f();function d(){if(Wo in n){var e=n[Wo];return i.primitive=e,ne.commandParameter(e,Yt,"invalid primitve",t.commandStr),cs((function(t,n){return Yt[e]}))}if(Wo in r){var a=r[Wo];return ls(a,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,a);return ne.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(Yt))})),t.def(n,"[",r,"]")}))}return c?us(h)?h.value?cs((function(e,t){return t.def(e.ELEMENTS,".primType")})):cs((function(){return ja})):new ss(h.thisDep,h.contextDep,h.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",ja)})):o?new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:"+ja)})):null}function p(e,a){if(e in n){var s=0|n[e];return a?i.offset=s:i.instances=s,ne.command(!a||s>=0,"invalid "+e,t.commandStr),cs((function(e,t){return a&&(e.OFFSET=s),s}))}if(e in r){var l=r[e];return ls(l,(function(t,n){var r=t.invoke(n,l);return a&&(t.OFFSET=r,ne.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(a){if(c)return cs((function(e,t){return e.OFFSET=0,0}));if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var m=p(Zo,!0);function v(){if($o in n){var e=0|n[$o];return i.count=e,ne.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),cs((function(){return e}))}if($o in r){var a=r[$o];return ls(a,(function(e,t){var n=e.invoke(t,a);return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(c){if(us(h)){if(h)return m?new ss(m.thisDep,m.contextDep,m.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ne.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):cs((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=cs((function(){return-1}));return ne.optional((function(){s.MISSING=!0})),s}var l=new ss(h.thisDep||m.thisDep,h.contextDep||m.contextDep,h.propDep||m.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return ne.optional((function(){l.DYNAMIC=!0})),l}if(o){var f=new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")}));return f}return null}var g=d(),y=v(),b=p(Xo,!1);return{elements:h,primitive:g,count:y,instances:b,offset:m,vao:u,vaoActive:o,elementsActive:c,static:i}}function B(e,t){var n=e.static,r=e.dynamic,o={};return _.forEach((function(e){var a=z(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=cs((function(){return s}))}else if(e in r){var u=r[e];o[a]=ls(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case ko:case vo:case mo:case Do:case xo:case Bo:case Co:case Po:case Fo:case _o:return s((function(n){return ne.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return ne.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case wo:return s((function(n){return ne.commandParameter(n,ts,"invalid "+e,t.commandStr),ts[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return ne.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(ts))})),n.def(i,"[",r,"]")}));case So:return s((function(e){return ne.command(fn(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case bo:return s((function(e){ne.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return ne.commandParameter(n,Ka,a+".srcRGB",t.commandStr),ne.commandParameter(r,Ka,a+".srcAlpha",t.commandStr),ne.commandParameter(i,Ka,a+".dstRGB",t.commandStr),ne.commandParameter(o,Ka,a+".dstAlpha",t.commandStr),ne.command(-1===es.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Ka[n],Ka[i],Ka[r],Ka[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return ne.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Ka))})),s}ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");ne.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),c,n.def(i,"[",o("dst","Alpha"),"]")]}));case yo:return s((function(n){return"string"==typeof n?(ne.commandParameter(n,g,"invalid "+e,t.commandStr),[g[n],g[n]]):"object"==typeof n?(ne.commandParameter(n.rgb,g,e+".rgb",t.commandStr),ne.commandParameter(n.alpha,g,e+".alpha",t.commandStr),[g[n.rgb],g[n.alpha]]):void ne.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return ne.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(g))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case go:return s((function(e){return ne.command(fn(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),ze(4,(function(t){return+e[t]}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),ze(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case No:return s((function(e){return ne.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case Oo:return s((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return ne.commandParameter(r,ts,e+".cmp",t.commandStr),ne.commandType(i,"number",e+".ref",t.commandStr),ne.commandType(o,"number",e+".mask",t.commandStr),[ts[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return ne.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Ya),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Lo:case jo:return s((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return ne.commandParameter(r,ns,e+".fail",t.commandStr),ne.commandParameter(i,ns,e+".zfail",t.commandStr),ne.commandParameter(o,ns,e+".zpass",t.commandStr),[e===jo?Ra:Ba,ns[r],ns[i],ns[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return ne.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(ns))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Ya)}return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===jo?Ra:Ba,o("fail"),o("zfail"),o("zpass")]}));case Io:return s((function(e){ne.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return ne.commandType(n,"number",a+".factor",t.commandStr),ne.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case zo:return s((function(e){var n=0;return"front"===e?n=Ba:"back"===e&&(n=Ra),ne.command(!!n,a,t.commandStr),n}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Ba,":",Ra)}));case Mo:return s((function(e){return ne.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case To:return s((function(e){return ne.commandParameter(e,is,a,t.commandStr),is[e]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+Va+":"+qa)}));case Ao:return s((function(e){return ne.command(fn(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),ze(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Eo:return s((function(e){ne.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return ne.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}function R(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=cs((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=cs((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(ne.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=cs((function(e){return e.link(o.color[0])}))):ne.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else fn(o)?r=cs((function(t){return t.global.def("[",ze(o.length,(function(n){return ne.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):ne.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=ls(t,(function(e,n){return e.invoke(n,t)}))})),i}function V(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),u=new v;if(os(i))u.state=oo,u.buffer=o.getBuffer(o.create(i,ua,!1,!0)),u.type=0;else{var c=o.getBuffer(i);if(c)u.state=oo,u.buffer=c,u.type=0;else if(ne.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var l=i.constant;u.buffer="null",u.state=ao,"number"==typeof l?u.x=l:(ne.command(fn(l)&&l.length>0&&l.length<=4,"invalid constant for attribute "+e,t.commandStr),ro.forEach((function(e,t){t<l.length&&(u[e]=l[t])})))}else{c=os(i.buffer)?o.getBuffer(o.create(i.buffer,ua,!1,!0)):o.getBuffer(i.buffer),ne.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var f=0|i.offset;ne.command(f>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var h=0|i.stride;ne.command(h>=0&&h<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;ne.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var p=!!i.normalized,m=0;"type"in i&&(ne.commandParameter(i.type,Et,"invalid type for attribute "+e,t.commandStr),m=Et[i.type]);var g=0|i.divisor;ne.optional((function(){"divisor"in i&&(ne.command(0===g||y,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),ne.command(g>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){ne.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=c,u.state=oo,u.size=d,u.normalized=p,u.type=m||c.dtype,u.offset=f,u.stride=h,u.divisor=g}}a[e]=cs((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];function n(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;ne.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var c={isStream:r.def(!1)},l=new v;l.state=oo,Object.keys(l).forEach((function(e){c[e]=r.def(""+l[e])}));var f=c.buffer,h=c.type;function d(e){r(c[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",f,"=",u,".createStream(",ua,",",i,");",h,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",ao,";","if(typeof "+i+'.constant === "number"){',c[ro[0]],"=",i,".constant;",ro.slice(1).map((function(e){return c[e]})).join("="),"=0;","}else{",ro.map((function(e,t){return c[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",ua,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",c.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",f,");","}"),c}a[e]=ls(t,n)})),a}function q(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=cs((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=ls(t,(function(e,n){return e.invoke(n,t)}))})),r}function G(e,t,n,i,o){var a=e.static,s=e.dynamic;ne.optional((function(){var e=[Go,Uo,Ho,Yo,Wo,Zo,$o,Xo,qo,Qo].concat(_);function t(t){Object.keys(t).forEach((function(t){ne.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',o.commandStr)}))}t(a),t(s)}));var u=O(e,t),c=D(e),f=N(e,c,o),h=j(e,o),d=B(e,o),p=L(e,o,u);function m(e){var t=f[e];t&&(d[e]=t)}m(Vo),m(z(Ro));var v=Object.keys(d).length>0,g={framebuffer:c,draw:h,shader:p,state:d,dirty:v,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(g.profile=E(e),g.uniforms=R(n,o),g.drawVAO=g.scopeVAO=h.vao,!g.drawVAO&&p.program&&!u&&r.angle_instanced_arrays&&h.static.elements){var y=!0,b=p.program.attributes.map((function(e){var n=t.static[e];return y=y&&!!n,n}));if(y&&b.length>0){var x=l.getVAO(l.createVAO({attributes:b,elements:h.static.elements}));g.drawVAO=new ss(null,null,null,(function(e,t){return e.link(x)})),g.useVAO=!0}}return u?g.useVAO=!0:g.attributes=V(t,o),g.context=q(i),g}function U(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function H(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,c=e.constants,l=c.drawBuffer,f=c.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",Qa,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Qa,",null);"),b&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function Y(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,c=e.cond(s,".dirty");_.forEach((function(t){var r,l,f=z(t);if(!(f in n.state))if(f in a){r=a[f],l=o[f];var h=ze(w[f].length,(function(e){return c.def(r,"[",e,"]")}));c(e.cond(h.map((function(e,t){return e+"!=="+l+"["+t+"]"})).join("||")).then(i,".",k[f],"(",h,");",h.map((function(e,t){return l+"["+t+"]="+e})).join(";"),";"))}else{r=c.def(u,".",f);var d=e.cond(r,"!==",s,".",f);c(d),f in A?d(e.cond(r).then(i,".enable(",A[f],");").else(i,".disable(",A[f],");"),s,".",f,"=",r,";"):d(i,".",k[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),t(c)}function W(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;as(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(e,t);if(A[i]){var l=A[i];us(u)?t(s,c?".enable(":".disable(",l,");"):t(e.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),t(a,".",i,"=",c,";")}else if(fn(c)){var f=o[i];t(s,".",k[i],"(",c,");",c.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",k[i],"(",c,");",a,".",i,"=",c,";")}}))}function $(e,t){y&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function Z(e,t,n,r,i){var o,a,s,u=e.shared,c=e.stats,l=u.current,f=u.timer,h=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function m(e){e(o=t.def(),"=",d(),";"),"string"==typeof i?e(c,".count+=",i,";"):e(c,".count++;"),p&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",c,");"))}function v(e){e(c,".cpuTime+=",d(),"-",o,";"),p&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",c,");"):e(f,".endQuery();"))}function g(e){var n=t.def(l,".profile");t(l,".profile=",e,";"),t.exit(l,".profile=",n,";")}if(h){if(us(h))return void(h.enable?(m(t),v(t.exit),g("true")):g("false"));g(s=h.append(e,t))}else s=t.def(l,".profile");var y=e.block();m(y),t("if(",s,"){",y,"}");var b=e.block();v(b),t.exit("if(",s,"){",b,"}")}function X(e,t,n,r,i){var o=e.shared;function a(e){switch(e){case Sa:case za:case Ia:return 2;case _a:case Ta:case Pa:return 3;case Aa:case Ma:case Fa:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),c=i.state,l=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function d(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",ua,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),y){var c=i.divisor;t("if(",u,".divisor!==",c,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function p(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ro.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",f,");",ro.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}c===oo?d():c===ao?p():(t("if(",c,"===",oo,"){"),d(),t("}else{"),p(),t("}"))}r.forEach((function(r){var o,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;o=c.append(e,t)}else{if(!i(fs))return;var l=e.scopeAttrib(u);ne.optional((function(){e.assert(t,l+".state","missing attribute "+u)})),o={},Object.keys(new v).forEach((function(e){o[e]=t.def(l,".",e)}))}s(e.link(r),a(r.info.type),o)}))}function Q(e,t,r,i,o,a){for(var s,u=e.shared,c=u.gl,l={},f=0;f<i.length;++f){var h=i[f],d=h.name,p=h.info.type,m=h.info.size,v=r.uniforms[d];if(m>1){if(!v)continue;var g=d.replace("[0]","");if(l[g])continue;l[g]=1}var y,b=e.link(h)+".location";if(v){if(!o(v))continue;if(us(v)){var x=v.value;if(ne.command(null!=x,'missing uniform "'+d+'"',e.commandStr),p===Oa||p===La){ne.command("function"==typeof x&&(p===Oa&&("texture2d"===x._reglType||"framebuffer"===x._reglType)||p===La&&("textureCube"===x._reglType||"framebufferCube"===x._reglType)),"invalid texture for uniform "+d,e.commandStr);var w=e.link(x._texture||x.color[0]._texture);t(c,".uniform1i(",b,",",w+".bind());"),t.exit(w,".unbind();")}else if(p===Ea||p===Da||p===Na){ne.optional((function(){ne.command(fn(x),"invalid matrix for uniform "+d,e.commandStr),ne.command(p===Ea&&4===x.length||p===Da&&9===x.length||p===Na&&16===x.length,"invalid length for matrix uniform "+d,e.commandStr)}));var S=e.global.def("new Float32Array(["+Array.prototype.slice.call(x)+"])"),_=2;p===Da?_=3:p===Na&&(_=4),t(c,".uniformMatrix",_,"fv(",b,",false,",S,");")}else{switch(p){case wa:1===m?ne.commandType(x,"number","uniform "+d,e.commandStr):ne.command(fn(x)&&x.length===m,"uniform "+d,e.commandStr),s="1f";break;case Sa:ne.command(fn(x)&&x.length&&x.length%2==0&&x.length<=2*m,"uniform "+d,e.commandStr),s="2f";break;case _a:ne.command(fn(x)&&x.length&&x.length%3==0&&x.length<=3*m,"uniform "+d,e.commandStr),s="3f";break;case Aa:ne.command(fn(x)&&x.length&&x.length%4==0&&x.length<=4*m,"uniform "+d,e.commandStr),s="4f";break;case Ca:1===m?ne.commandType(x,"boolean","uniform "+d,e.commandStr):ne.command(fn(x)&&x.length===m,"uniform "+d,e.commandStr),s="1i";break;case ka:1===m?ne.commandType(x,"number","uniform "+d,e.commandStr):ne.command(fn(x)&&x.length===m,"uniform "+d,e.commandStr),s="1i";break;case Ia:case za:ne.command(fn(x)&&x.length&&x.length%2==0&&x.length<=2*m,"uniform "+d,e.commandStr),s="2i";break;case Pa:case Ta:ne.command(fn(x)&&x.length&&x.length%3==0&&x.length<=3*m,"uniform "+d,e.commandStr),s="3i";break;case Fa:case Ma:ne.command(fn(x)&&x.length&&x.length%4==0&&x.length<=4*m,"uniform "+d,e.commandStr),s="4i"}m>1?(s+="v",x=e.global.def("["+Array.prototype.slice.call(x)+"]")):x=fn(x)?Array.prototype.slice.call(x):x,t(c,".uniform",s,"(",b,",",x,");")}continue}y=v.append(e,t)}else{if(!o(fs))continue;y=t.def(u.uniforms,"[",n.id(d),"]")}p===Oa?(ne(!Array.isArray(y),"must specify a scalar prop for textures"),t("if(",y,"&&",y,'._reglType==="framebuffer"){',y,"=",y,".color[0];","}")):p===La&&(ne(!Array.isArray(y),"must specify a scalar prop for cube maps"),t("if(",y,"&&",y,'._reglType==="framebufferCube"){',y,"=",y,".color[0];","}")),ne.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+d+'".  '+r)}function r(e,t){1===t&&ne(!Array.isArray(y),"must not specify an array type for uniform"),n("Array.isArray("+y+") && typeof "+y+'[0]===" '+e+'" || typeof '+y+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r,i){Array.isArray(y)?ne(y.length&&y.length%t==0&&y.length<=t*i,"must have length of "+(1===i?"":"n * ")+t):n(u.isArrayLike+"("+y+")&&"+y+".length && "+y+".length % "+t+" === 0 && "+y+".length<="+t*i,"invalid vector, should have length of "+(1===i?"":"n * ")+t,e.commandStr)}function o(t){ne(!Array.isArray(y),"must not specify a value type"),n("typeof "+y+'==="function"&&'+y+'._reglType==="texture'+(t===la?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case ka:r("number",m);break;case za:i(2,"number",m);break;case Ta:i(3,"number",m);break;case Ma:i(4,"number",m);break;case wa:r("number",m);break;case Sa:i(2,"number",m);break;case _a:i(3,"number",m);break;case Aa:i(4,"number",m);break;case Ca:r("boolean",m);break;case Ia:i(2,"boolean",m);break;case Pa:i(3,"boolean",m);break;case Fa:i(4,"boolean",m);break;case Ea:i(4,"number",m);break;case Da:i(9,"number",m);break;case Na:i(16,"number",m);break;case Oa:o(la);break;case La:o(fa)}}));var A=1;switch(p){case Oa:case La:var k=t.def(y,"._texture");t(c,".uniform1i(",b,",",k,".bind());"),t.exit(k,".unbind();");continue;case ka:case Ca:s="1i";break;case za:case Ia:s="2i",A=2;break;case Ta:case Pa:s="3i",A=3;break;case Ma:case Fa:s="4i",A=4;break;case wa:s="1f";break;case Sa:s="2f",A=2;break;case _a:s="3f",A=3;break;case Aa:s="4f",A=4;break;case Ea:s="Matrix2fv";break;case Da:s="Matrix3fv";break;case Na:s="Matrix4fv"}if(-1===s.indexOf("Matrix")&&m>1&&(s+="v",A=1),"M"===s.charAt(0)){t(c,".uniform",s,"(",b,",");var z=Math.pow(p-Ea+2,2),T=e.global.def("new Float32Array(",z,")");Array.isArray(y)?t("false,(",ze(z,(function(e){return T+"["+e+"]="+y[e]})),",",T,")"):t("false,(Array.isArray(",y,")||",y," instanceof Float32Array)?",y,":(",ze(z,(function(e){return T+"["+e+"]="+y+"["+e+"]"})),",",T,")"),t(");")}else if(A>1){for(var M=[],C=[],I=0;I<A;++I)Array.isArray(y)?C.push(y[I]):C.push(t.def(y+"["+I+"]")),a&&M.push(t.def());a&&t("if(!",e.batchId,"||",M.map((function(e,t){return e+"!=="+C[t]})).join("||"),"){",M.map((function(e,t){return e+"="+C[t]+";"})).join("")),t(c,".uniform",s,"(",b,",",C.join(","),");"),a&&t("}")}else{if(ne(!Array.isArray(y),"uniform value must not be an array"),a){var P=t.def();t("if(!",e.batchId,"||",P,"!==",y,"){",P,"=",y,";")}t(c,".uniform",s,"(",b,",",y,");"),a&&t("}")}}}function J(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,c=s.elements,l=t;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(e,l),s.elementsActive&&l("if("+u+")"+o+".bindBuffer("+ca+","+u+".buffer.buffer);")):(u=l.def(),l(u,"=",a,".",Yo,";","if(",u,"){",o,".bindBuffer(",ca,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",x?"":"if("+u+")"+o+".bindBuffer("+ca+","+u+".buffer.buffer);","}")),u}function c(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),ne.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",$o),ne.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}var l=u();function f(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var h,d,p=f(Wo),m=f(Zo),v=c();if("number"==typeof v){if(0===v)return}else n("if(",v,"){"),n.exit("}");y&&(h=f(Xo),d=e.instancing);var g=l+".type",b=s.elements&&us(s.elements)&&!s.vaoActive;function w(){function e(){n(d,".drawElementsInstancedANGLE(",[p,v,g,m+"<<(("+g+"-"+io+")>>1)",h],");")}function t(){n(d,".drawArraysInstancedANGLE(",[p,m,v,h],");")}l&&"null"!==l?b?e():(n("if(",l,"){"),e(),n("}else{"),t(),n("}")):t()}function S(){function e(){n(o+".drawElements("+[p,v,g,m+"<<(("+g+"-"+io+")>>1)"]+");")}function t(){n(o+".drawArrays("+[p,m,v]+");")}l&&"null"!==l?b?e():(n("if(",l,"){"),e(),n("}else{"),t(),n("}")):t()}y&&("number"!=typeof h||h>=0)?"string"==typeof h?(n("if(",h,">0){"),w(),n("}else if(",h,"<0){"),S(),n("}")):w():S()}function K(e,t,n,r,i){var o=F(),a=o.proc("body",i);return ne.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),y&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function ee(e,t,n,r){$(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),X(e,t,n,r.attributes,(function(){return!0}))),Q(e,t,n,r.uniforms,(function(){return!0}),!1),J(e,t,t,n)}function te(e,t){var n=e.proc("draw",1);$(e,n),U(e,n,t.context),H(e,n,t.framebuffer),Y(e,n,t),W(e,n,t.state),Z(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)ee(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return K(ee,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function re(e,t,n,r){function i(){return!0}e.batchId="a1",$(e,t),X(e,t,n,r.attributes,i),Q(e,t,n,r.uniforms,i,!1),J(e,t,t,n)}function ie(e,t,n,r){$(e,t);var i=n.contextDep,o=t.def(),a="a0",s="a1",u=t.def();e.shared.props=u,e.batchId=o;var c=e.scope(),l=e.scope();function f(e){return e.contextDep&&i||e.propDep}function h(e){return!f(e)}if(t(c.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",l,"}",c.exit),n.needsContext&&U(e,l,n.context),n.needsFramebuffer&&H(e,l,n.framebuffer),W(e,l,n.state,f),n.profile&&f(n.profile)&&Z(e,l,n,!1,!0),r)n.useVAO?n.drawVAO?f(n.drawVAO)?l(e.shared.vao,".setVAO(",n.drawVAO.append(e,l),");"):c(e.shared.vao,".setVAO(",n.drawVAO.append(e,c),");"):c(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(c(e.shared.vao,".setVAO(null);"),X(e,c,n,r.attributes,h),X(e,l,n,r.attributes,f)),Q(e,c,n,r.uniforms,h,!1),Q(e,l,n,r.uniforms,f,!0),J(e,c,l,n);else{var d=e.global.def("{}"),p=n.shader.progVar.append(e,l),m=l.def(p,".id"),v=l.def(d,"[",m,"]");l(e.shared.gl,".useProgram(",p,".program);","if(!",v,"){",v,"=",d,"[",m,"]=",e.link((function(t){return K(re,e,n,t,2)})),"(",p,");}",v,".call(this,a0[",o,"],",o,");")}}function oe(e,t){var n=e.proc("batch",2);e.batchId="0",$(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(U(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||H(e,n,o)):H(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),Y(e,n,t),W(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||Z(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)ie(e,n,t,null);else{var c=u.append(e,n);if(n(e.shared.gl,".useProgram(",c,".program);"),t.shader.program)ie(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var l=e.global.def("{}"),f=n.def(c,".id"),h=n.def(l,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",l,"[",f,"]=",e.link((function(n){return K(ie,e,t,n,2)})),"(",c,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function ae(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}U(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),as(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);fn(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),Z(e,r,t,!0,!0),[Yo,Zo,$o,Xo,Wo].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new v).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Uo),a(Ho),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}function se(e){if("object"==typeof e&&!fn(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(pe.isDynamic(e[t[n]]))return!0;return!1}}function ue(e,t,n){var r=t.static[n];if(r&&se(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(pe.isDynamic(n)){"function"==typeof n&&(n=r[t]=pe.unbox(n));var o=ls(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(c,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new pe.DynamicVariable(fo,{thisDep:a,contextDep:s,propDep:u,ref:c,append:l}),delete t.static[n]}function l(e,t){o.forEach((function(n){var i=r[n];if(pe.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}function ce(e,n,r,i,o){var a=F();a.stats=a.link(o),Object.keys(n.static).forEach((function(e){ue(a,n,e)})),sa.forEach((function(t){ue(a,e,t)}));var s=G(e,n,r,i,a);return te(a,s),ae(a,s),oe(a,s),t(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:S,current:w,procs:function(){var e=F(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,c=s.next,l=s.current;o(l,".dirty=false;"),H(e,t),H(e,n,null,!0),y&&(a=e.link(y)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(s.attributes,"[",f,"]"),d=e.cond(h,".buffer");d.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",ua,",",h,".buffer.buffer);",u,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(d),y&&n(a,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(r){var i=A[r],a=o.def(c,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",a,";"),n(s),t("if(",a,"!==",l,".",r,"){",s,"}")})),Object.keys(k).forEach((function(r){var i,a,s=k[r],f=w[r],h=e.block();if(h(u,".",s,"("),fn(f)){var d=f.length;i=e.global.def(c,".",r),a=e.global.def(l,".",r),h(ze(d,(function(e){return i+"["+e+"]"})),");",ze(d,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",ze(d,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else i=o.def(c,".",r),a=o.def(l,".",r),h(i,");",l,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)})),e.compile()}(),compile:ce}}function ds(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ps=34918,ms=34919,vs=35007,gs=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function i(e){n.push(e)}var o=[];function a(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(vs,n),o.push(n),d(o.length-1,o.length,e)}function s(){t.ext_disjoint_timer_query.endQueryEXT(vs)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function l(){return c.pop()||new u}function f(e){c.push(e)}var h=[];function d(e,t,n){var r=l();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,h.push(r)}var p=[],m=[];function v(){var e,n,r=o.length;if(0!==r){m.length=Math.max(m.length,r+1),p.length=Math.max(p.length,r+1),p[0]=0,m[0]=0;var a=0;for(e=0,n=0;n<o.length;++n){var s=o[n];t.ext_disjoint_timer_query.getQueryObjectEXT(s,ms)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,ps),i(s)):o[e++]=s,p[n+1]=a,m[n+1]=e}for(o.length=e,e=0,n=0;n<h.length;++n){var u=h[n],c=u.startQueryIndex,l=u.endQueryIndex;u.sum+=p[l]-p[c];var d=m[c],v=m[l];v===d?(u.stats.gpuTime+=u.sum/1e6,f(u)):(u.startQueryIndex=d,u.endQueryIndex=v,h[e++]=u)}h.length=e}}return{beginQuery:a,endQuery:s,pushScopeStats:d,update:v,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},ys=16384,bs=256,xs=1024,ws=34962,Ss="webglcontextlost",_s="webglcontextrestored",As=1,ks=2,zs=3;function Ts(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function Ms(e){var n=Ae(e);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=ke(r,n);if(!a)return null;var s=ge(),u=ds(),c=a.extensions,l=gs(r,c),f=ve(),h=r.drawingBufferWidth,d=r.drawingBufferHeight,p={tick:0,time:0,viewportWidth:h,viewportHeight:d,framebufferWidth:h,framebufferHeight:d,drawingBufferWidth:h,drawingBufferHeight:d,pixelRatio:n.pixelRatio},m={},v={elements:null,primitive:4,count:-1,offset:0,instances:-1},g=St(r,c),y=Ht(r,u,n,w),b=an(r,c,y,u),x=Gi(r,c,g,u,y,b,v);function w(e){return x.destroyBuffer(e)}var S=$i(r,s,u,n),_=Zr(r,c,g,(function(){z.procs.poll()}),p,u,n),A=ci(r,c,g,u,n),k=Li(r,c,g,_,A,u),z=hs(r,s,c,g,y,b,_,k,m,x,S,v,p,l,n),T=Ki(r,k,z.procs.poll,p,i,c,g),M=z.next,C=r.canvas,I=[],P=[],F=[],E=[n.onDestroy],D=null;function N(){if(0===I.length)return l&&l.update(),void(D=null);D=me.next(N),W();for(var e=I.length-1;e>=0;--e){var t=I[e];t&&t(p,null,0)}r.flush(),l&&l.update()}function O(){!D&&I.length>0&&(D=me.next(N))}function L(){D&&(me.cancel(N),D=null)}function j(e){e.preventDefault(),o=!0,L(),P.forEach((function(e){e()}))}function B(e){r.getError(),o=!1,a.restore(),S.restore(),y.restore(),_.restore(),A.restore(),k.restore(),x.restore(),l&&l.restore(),z.procs.refresh(),O(),F.forEach((function(e){e()}))}function R(){I.length=0,L(),C&&(C.removeEventListener(Ss,j),C.removeEventListener(_s,B)),S.clear(),k.clear(),A.clear(),x.clear(),_.clear(),b.clear(),y.clear(),l&&l.clear(),E.forEach((function(e){e()}))}function V(e){function n(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}function r(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(pe.isDynamic(o))r[i]=pe.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(pe.isDynamic(o[a]))return void(r[i]=pe.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}ne(!!e,"invalid args to regl({...})"),ne.type(e,"object","invalid args to regl({...})");var i=r(e.context||{},!0),a=r(e.uniforms||{},!0),s=r(e.attributes||{},!1),u=r(n(e),!1),c={gpuTime:0,cpuTime:0,count:0},l=z.compile(u,s,a,i,c),f=l.draw,h=l.batch,d=l.scope,p=[];function m(e){for(;p.length<e;)p.push(null);return p}function v(e,t){var n;if(o&&ne.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)d.call(this,null,t,n);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(n=0;n<e.length;++n)d.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return h.call(this,m(0|e),0|e)}else{if(!Array.isArray(e))return f.call(this,e);if(e.length)return h.call(this,e,e.length)}}return t(v,{stats:c,destroy:function(){l.destroy()}})}C&&(C.addEventListener(Ss,j,!1),C.addEventListener(_s,B,!1));var q=k.setFBO=V({framebuffer:pe.define.call(null,As,"framebuffer")});function G(e,t){var n=0;z.procs.poll();var i=t.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=ys),"depth"in t&&(r.clearDepth(+t.depth),n|=bs),"stencil"in t&&(r.clearStencil(0|t.stencil),n|=xs),ne(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function U(e){if(ne("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)q(t({framebuffer:e.framebuffer.faces[n]},e),G);else q(e,G);else G(null,e)}function H(e){function t(){var t=Ts(I,e);function n(){var e=Ts(I,n);I[e]=I[I.length-1],I.length-=1,I.length<=0&&L()}ne(t>=0,"cannot cancel a frame twice"),I[t]=n}return ne.type(e,"function","regl.frame() callback must be a function"),I.push(e),O(),{cancel:t}}function Y(){var e=M.viewport,t=M.scissor_box;e[0]=e[1]=t[0]=t[1]=0,p.viewportWidth=p.framebufferWidth=p.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,p.viewportHeight=p.framebufferHeight=p.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function W(){p.tick+=1,p.time=Z(),Y(),z.procs.poll()}function $(){_.refresh(),Y(),z.procs.refresh(),l&&l.update()}function Z(){return(ve()-f)/1e3}function X(e,t){var n;switch(ne.type(t,"function","listener callback must be a function"),e){case"frame":return H(t);case"lost":n=P;break;case"restore":n=F;break;case"destroy":n=E;break;default:ne.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}$();var Q=t(V,{clear:U,prop:pe.define.bind(null,As),context:pe.define.bind(null,ks),this:pe.define.bind(null,zs),draw:V({}),buffer:function(e){return y.create(e,ws,!1,!1)},elements:function(e){return b.create(e,!1)},texture:_.create2D,cube:_.createCube,renderbuffer:A.create,framebuffer:k.create,framebufferCube:k.createCube,vao:x.createVAO,attributes:i,frame:H,on:X,limits:g,hasExtension:function(e){return g.extensions.indexOf(e.toLowerCase())>=0},read:T,destroy:R,_gl:r,_refresh:$,poll:function(){W(),l&&l.update()},now:Z,stats:u});return n.onDone(null,Q),Q}return Ms}()}(hr);var dr=hr.exports;const pr="#b3b3b3",mr=4,vr="#666666",gr={disableSimulation:!1,spaceSize:4096,nodeSizeScale:1,linkWidthScale:1,arrowSizeScale:1,renderLinks:!0,curvedLinks:!1,curvedLinkSegments:19,curvedLinkWeight:.8,curvedLinkControlPointDistance:.5,arrowLinks:!0,linkVisibilityDistanceRange:[50,150],linkVisibilityMinTransparency:.25,hoveredNodeRingColor:"white",focusedNodeRingColor:"white",useQuadtree:!1,simulation:{decay:1e3,gravity:0,center:0,repulsion:.1,repulsionTheta:1.7,repulsionQuadtreeLevels:12,linkSpring:1,linkDistance:2,linkDistRandomVariationRange:[1,1.2],repulsionFromMouse:2,friction:.85},showFPSMonitor:!1,pixelRatio:2,scaleNodesOnZoom:!0,disableZoom:!1,fitViewOnInit:!0,fitViewDelay:250,nodeSamplingDistance:150},yr=e=>"function"==typeof e,br=e=>Array.isArray(e),xr=e=>(e=>e instanceof Object)(e)&&!br(e)&&!yr(e)&&!(e=>e instanceof Object&&"Function"!==e.constructor.name&&"Object"!==e.constructor.name)(e);function wr(e,t,n){return yr(t)?t(e,n):t}function Sr(e){var t;let n;if(br(e))n=e;else{const r=bt(e),i=null==r?void 0:r.rgb();n=[(null==i?void 0:i.r)||0,(null==i?void 0:i.g)||0,(null==i?void 0:i.b)||0,null!==(t=null==r?void 0:r.opacity)&&void 0!==t?t:1]}return[n[0]/255,n[1]/255,n[2]/255,n[3]]}function _r(e,t){let n=new Float32Array;return e({framebuffer:t})((()=>{n=e.read()})),n}class Ar{constructor(){this.disableSimulation=gr.disableSimulation,this.backgroundColor="#222222",this.spaceSize=gr.spaceSize,this.nodeColor=pr,this.nodeGreyoutOpacity=.1,this.nodeSize=mr,this.nodeSizeScale=gr.nodeSizeScale,this.renderHighlightedNodeRing=!0,this.highlightedNodeRingColor=void 0,this.renderHoveredNodeRing=!0,this.hoveredNodeRingColor=gr.hoveredNodeRingColor,this.focusedNodeRingColor=gr.focusedNodeRingColor,this.linkColor=vr,this.linkGreyoutOpacity=.1,this.linkWidth=1,this.linkWidthScale=gr.linkWidthScale,this.renderLinks=gr.renderLinks,this.curvedLinks=gr.curvedLinks,this.curvedLinkSegments=gr.curvedLinkSegments,this.curvedLinkWeight=gr.curvedLinkWeight,this.curvedLinkControlPointDistance=gr.curvedLinkControlPointDistance,this.linkArrows=gr.arrowLinks,this.linkArrowsSizeScale=gr.arrowSizeScale,this.linkVisibilityDistanceRange=gr.linkVisibilityDistanceRange,this.linkVisibilityMinTransparency=gr.linkVisibilityMinTransparency,this.useQuadtree=gr.useQuadtree,this.simulation={decay:gr.simulation.decay,gravity:gr.simulation.gravity,center:gr.simulation.center,repulsion:gr.simulation.repulsion,repulsionTheta:gr.simulation.repulsionTheta,repulsionQuadtreeLevels:gr.simulation.repulsionQuadtreeLevels,linkSpring:gr.simulation.linkSpring,linkDistance:gr.simulation.linkDistance,linkDistRandomVariationRange:gr.simulation.linkDistRandomVariationRange,repulsionFromMouse:gr.simulation.repulsionFromMouse,friction:gr.simulation.friction,onStart:void 0,onTick:void 0,onEnd:void 0,onPause:void 0,onRestart:void 0},this.events={onClick:void 0,onMouseMove:void 0,onNodeMouseOver:void 0,onNodeMouseOut:void 0,onZoomStart:void 0,onZoom:void 0,onZoomEnd:void 0},this.showFPSMonitor=gr.showFPSMonitor,this.pixelRatio=gr.pixelRatio,this.scaleNodesOnZoom=gr.scaleNodesOnZoom,this.initialZoomLevel=void 0,this.disableZoom=gr.disableZoom,this.fitViewOnInit=gr.fitViewOnInit,this.fitViewDelay=gr.fitViewDelay,this.fitViewByNodesInRect=void 0,this.randomSeed=void 0,this.nodeSamplingDistance=gr.nodeSamplingDistance}init(e){Object.keys(e).forEach((t=>{this.deepMergeConfig(this.getConfig(),e,t)}))}deepMergeConfig(e,t,n){xr(e[n])&&xr(t[n])?Object.keys(t[n]).forEach((r=>{this.deepMergeConfig(e[n],t[n],r)})):e[n]=t[n]}getConfig(){return this}}class kr{constructor(e,t,n,r,i){this.reglInstance=e,this.config=t,this.store=n,this.data=r,i&&(this.points=i)}}function zr(e){return{buffer:e.buffer(new Float32Array([-1,-1,1,-1,-1,1,1,1])),size:2}}function Tr(e,t){const n=new Float32Array(t*t*2);for(let e=0;e<t;e++)for(let r=0;r<t;r++){const i=e*t*2+2*r;n[i+0]=r,n[i+1]=e}return{buffer:e.buffer(n),size:2}}function Mr(e){var t;e&&(null===(t=null==e?void 0:e._framebuffer)||void 0===t?void 0:t.framebuffer)&&e.destroy()}function Cr(e){var t;e&&(null===(t=null==e?void 0:e._buffer)||void 0===t?void 0:t.buffer)&&e.destroy()}var Ir="#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec2 index;void main(){gl_FragColor=vec4(0.0);}",Pr="#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nattribute vec2 quad;varying vec2 index;void main(){index=(quad+1.0)/2.0;gl_Position=vec4(quad,0,1);}";class Fr extends kr{create(){const{reglInstance:e}=this;this.centermassFbo=e.framebuffer({color:e.texture({data:new Float32Array(4).fill(0),shape:[1,1,4],type:"float"}),depth:!1,stencil:!1})}initPrograms(){const{reglInstance:e,config:t,store:n,data:r,points:i}=this;this.clearCentermassCommand=e({frag:Ir,vert:Pr,framebuffer:this.centermassFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)}}),this.calculateCentermassCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec4 rgba;void main(){gl_FragColor=rgba;}",vert:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float pointsTextureSize;attribute vec2 indexes;varying vec4 rgba;void main(){vec4 pointPosition=texture2D(position,indexes/pointsTextureSize);rgba=vec4(pointPosition.xy,1.0,0.0);gl_Position=vec4(0.0,0.0,0.0,1.0);gl_PointSize=1.0;}",framebuffer:()=>this.centermassFbo,primitive:"points",count:()=>r.nodes.length,attributes:{indexes:Tr(e,n.pointsTextureSize)},uniforms:{position:()=>null==i?void 0:i.previousPositionFbo,pointsTextureSize:()=>n.pointsTextureSize},blend:{enable:!0,func:{src:"one",dst:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},stencil:{enable:!1}}),this.runCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D centermass;uniform float center;uniform float alpha;varying vec2 index;void main(){vec4 pointPosition=texture2D(position,index);vec4 velocity=vec4(0.0);vec4 centermassValues=texture2D(centermass,vec2(0.0));vec2 centermassPosition=centermassValues.xy/centermassValues.b;vec2 distVector=centermassPosition-pointPosition.xy;float dist=sqrt(dot(distVector,distVector));if(dist>0.0){float angle=atan(distVector.y,distVector.x);float addV=alpha*center*dist*0.01;velocity.rg+=addV*vec2(cos(angle),sin(angle));}gl_FragColor=velocity;}",vert:Pr,framebuffer:()=>null==i?void 0:i.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==i?void 0:i.previousPositionFbo,centermass:()=>this.centermassFbo,center:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.center},alpha:()=>n.alpha}})}run(){var e,t,n;null===(e=this.clearCentermassCommand)||void 0===e||e.call(this),null===(t=this.calculateCentermassCommand)||void 0===t||t.call(this),null===(n=this.runCommand)||void 0===n||n.call(this)}destroy(){Mr(this.centermassFbo)}}var Er;class Dr extends kr{initPrograms(){const{reglInstance:e,config:t,store:n,points:r}=this;this.runCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float gravity;uniform float spaceSize;uniform float alpha;varying vec2 index;void main(){vec4 pointPosition=texture2D(position,index);vec4 velocity=vec4(0.0);vec2 centerPosition=vec2(spaceSize/2.0);vec2 distVector=centerPosition-pointPosition.rg;float dist=sqrt(dot(distVector,distVector));if(dist>0.0){float angle=atan(distVector.y,distVector.x);float addV=alpha*gravity*dist*0.1;velocity.rg+=addV*vec2(cos(angle),sin(angle));}gl_FragColor=velocity;}",vert:Pr,framebuffer:()=>null==r?void 0:r.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==r?void 0:r.previousPositionFbo,gravity:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.gravity},spaceSize:()=>n.adjustedSpaceSize,alpha:()=>n.alpha}})}run(){var e;null===(e=this.runCommand)||void 0===e||e.call(this)}}!function(e){e.OUTGOING="outgoing",e.INCOMING="incoming"}(Er||(Er={}));class Nr extends kr{constructor(){super(...arguments),this.linkFirstIndicesAndAmount=new Float32Array,this.indices=new Float32Array,this.maxPointDegree=0}create(e){const{reglInstance:t,store:{pointsTextureSize:n,linksTextureSize:r},data:i}=this;if(!n||!r)return;this.linkFirstIndicesAndAmount=new Float32Array(n*n*4),this.indices=new Float32Array(r*r*4);const o=new Float32Array(r*r*4),a=new Float32Array(r*r*4),s=e===Er.INCOMING?i.groupedSourceToTargetLinks:i.groupedTargetToSourceLinks;this.maxPointDegree=0;let u=0;s.forEach(((e,t)=>{this.linkFirstIndicesAndAmount[4*t+0]=u%r,this.linkFirstIndicesAndAmount[4*t+1]=Math.floor(u/r),this.linkFirstIndicesAndAmount[4*t+2]=e.size,e.forEach((e=>{var r,s;this.indices[4*u+0]=e%n,this.indices[4*u+1]=Math.floor(e/n);const c=null!==(r=i.degree[i.getInputIndexBySortedIndex(e)])&&void 0!==r?r:0,l=null!==(s=i.degree[i.getInputIndexBySortedIndex(t)])&&void 0!==s?s:0,f=c/(c+l);let h=1/Math.min(c,l);h=Math.sqrt(h),o[4*u+0]=f,o[4*u+1]=h,a[4*u]=this.store.getRandomFloat(0,1),u+=1})),this.maxPointDegree=Math.max(this.maxPointDegree,e.size)})),this.linkFirstIndicesAndAmountFbo=t.framebuffer({color:t.texture({data:this.linkFirstIndicesAndAmount,shape:[n,n,4],type:"float"}),depth:!1,stencil:!1}),this.indicesFbo=t.framebuffer({color:t.texture({data:this.indices,shape:[r,r,4],type:"float"}),depth:!1,stencil:!1}),this.biasAndStrengthFbo=t.framebuffer({color:t.texture({data:o,shape:[r,r,4],type:"float"}),depth:!1,stencil:!1}),this.randomDistanceFbo=t.framebuffer({color:t.texture({data:a,shape:[r,r,4],type:"float"}),depth:!1,stencil:!1})}initPrograms(){const{reglInstance:e,config:t,store:n,points:r}=this;this.runCommand=e({frag:()=>`\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D position;\nuniform float linkSpring;\nuniform float linkDistance;\nuniform vec2 linkDistRandomVariationRange;\n\nuniform sampler2D linkFirstIndicesAndAmount;\nuniform sampler2D linkIndices;\nuniform sampler2D linkBiasAndStrength;\nuniform sampler2D linkRandomDistanceFbo;\n\nuniform float pointsTextureSize;\nuniform float linksTextureSize;\nuniform float alpha;\n\nvarying vec2 index;\n\nconst float MAX_LINKS = ${this.maxPointDegree}.0;\n\nvoid main() {\n  vec4 pointPosition = texture2D(position, index);\n  vec4 velocity = vec4(0.0);\n\n  vec4 linkFirstIJAndAmount = texture2D(linkFirstIndicesAndAmount, index);\n  float iCount = linkFirstIJAndAmount.r;\n  float jCount = linkFirstIJAndAmount.g;\n  float linkAmount = linkFirstIJAndAmount.b;\n  if (linkAmount > 0.0) {\n    for (float i = 0.0; i < MAX_LINKS; i += 1.0) {\n      if (i < linkAmount) {\n        if (iCount >= linksTextureSize) {\n          iCount = 0.0;\n          jCount += 1.0;\n        }\n        vec2 linkTextureIndex = (vec2(iCount, jCount) + 0.5) / linksTextureSize;\n        vec4 connectedPointIndex = texture2D(linkIndices, linkTextureIndex);\n        vec4 biasAndStrength = texture2D(linkBiasAndStrength, linkTextureIndex);\n        vec4 randomMinDistance = texture2D(linkRandomDistanceFbo, linkTextureIndex);\n        float bias = biasAndStrength.r;\n        float strength = biasAndStrength.g;\n        float randomMinLinkDist = randomMinDistance.r * (linkDistRandomVariationRange.g - linkDistRandomVariationRange.r) + linkDistRandomVariationRange.r;\n        randomMinLinkDist *= linkDistance;\n\n        iCount += 1.0;\n\n        vec4 connectedPointPosition = texture2D(position, (connectedPointIndex.rg + 0.5) / pointsTextureSize);\n        float x = connectedPointPosition.x - (pointPosition.x + velocity.x);\n        float y = connectedPointPosition.y - (pointPosition.y + velocity.y);\n        float l = sqrt(x * x + y * y);\n        l = max(l, randomMinLinkDist * 0.99);\n        l = (l - randomMinLinkDist) / l;\n        l *= linkSpring * alpha;\n        l *= strength;\n        l *= bias;\n        x *= l;\n        y *= l;\n        velocity.x += x;\n        velocity.y += y;\n      }\n    }\n  }\n\n  gl_FragColor = vec4(velocity.rg, 0.0, 0.0);\n}\n  `,vert:Pr,framebuffer:()=>null==r?void 0:r.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==r?void 0:r.previousPositionFbo,linkSpring:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.linkSpring},linkDistance:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.linkDistance},linkDistRandomVariationRange:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.linkDistRandomVariationRange},linkFirstIndicesAndAmount:()=>this.linkFirstIndicesAndAmountFbo,linkIndices:()=>this.indicesFbo,linkBiasAndStrength:()=>this.biasAndStrengthFbo,linkRandomDistanceFbo:()=>this.randomDistanceFbo,pointsTextureSize:()=>n.pointsTextureSize,linksTextureSize:()=>n.linksTextureSize,alpha:()=>n.alpha}})}run(){var e;null===(e=this.runCommand)||void 0===e||e.call(this)}destroy(){Mr(this.linkFirstIndicesAndAmountFbo),Mr(this.indicesFbo),Mr(this.biasAndStrengthFbo),Mr(this.randomDistanceFbo)}}var Or="#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec4 rgba;void main(){gl_FragColor=rgba;}",Lr="#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float pointsTextureSize;uniform float levelTextureSize;uniform float cellSize;attribute vec2 indexes;varying vec4 rgba;void main(){vec4 pointPosition=texture2D(position,indexes/pointsTextureSize);rgba=vec4(pointPosition.rg,1.0,0.0);float n=floor(pointPosition.x/cellSize);float m=floor(pointPosition.y/cellSize);vec2 levelPosition=2.0*(vec2(n,m)+0.5)/levelTextureSize-1.0;gl_Position=vec4(levelPosition,0.0,1.0);gl_PointSize=1.0;}";class jr extends kr{constructor(){super(...arguments),this.levelsFbos=new Map,this.quadtreeLevels=0}create(){const{reglInstance:e,store:t}=this;if(!t.pointsTextureSize)return;this.quadtreeLevels=Math.log2(t.adjustedSpaceSize);for(let t=0;t<this.quadtreeLevels;t+=1){const n=Math.pow(2,t+1);this.levelsFbos.set(`level[${t}]`,e.framebuffer({shape:[n,n],colorType:"float",depth:!1,stencil:!1}))}const n=new Float32Array(t.pointsTextureSize*t.pointsTextureSize*4);for(let e=0;e<t.pointsTextureSize*t.pointsTextureSize;++e)n[4*e]=1e-5*t.getRandomFloat(-1,1),n[4*e+1]=1e-5*t.getRandomFloat(-1,1);this.randomValuesFbo=e.framebuffer({color:e.texture({data:n,shape:[t.pointsTextureSize,t.pointsTextureSize,4],type:"float"}),depth:!1,stencil:!1})}initPrograms(){const{reglInstance:e,config:t,store:n,data:r,points:i}=this;this.clearLevelsCommand=e({frag:Ir,vert:Pr,framebuffer:(e,t)=>t.levelFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)}}),this.calculateLevelsCommand=e({frag:Or,vert:Lr,framebuffer:(e,t)=>t.levelFbo,primitive:"points",count:()=>r.nodes.length,attributes:{indexes:Tr(e,n.pointsTextureSize)},uniforms:{position:()=>null==i?void 0:i.previousPositionFbo,pointsTextureSize:()=>n.pointsTextureSize,levelTextureSize:(e,t)=>t.levelTextureSize,cellSize:(e,t)=>t.cellSize},blend:{enable:!0,func:{src:"one",dst:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},stencil:{enable:!1}}),this.forceCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D levelFbo;uniform float level;uniform float levels;uniform float levelTextureSize;uniform float repulsion;uniform float alpha;uniform float spaceSize;uniform float theta;varying vec2 index;const float MAX_LEVELS_NUM=14.0;vec2 calcAdd(vec2 ij,vec2 pp){vec2 add=vec2(0.0);vec4 centermass=texture2D(levelFbo,ij);if(centermass.r>0.0&&centermass.g>0.0&&centermass.b>0.0){vec2 centermassPosition=vec2(centermass.rg/centermass.b);vec2 distVector=pp-centermassPosition;float l=dot(distVector,distVector);float dist=sqrt(l);if(l>0.0){float angle=atan(distVector.y,distVector.x);float c=alpha*repulsion*centermass.b;float distanceMin2=1.0;if(l<distanceMin2)l=sqrt(distanceMin2*l);float addV=c/sqrt(l);add=addV*vec2(cos(angle),sin(angle));}}return add;}void main(){vec4 pointPosition=texture2D(position,index);float x=pointPosition.x;float y=pointPosition.y;float left=0.0;float top=0.0;float right=spaceSize;float bottom=spaceSize;float n_left=0.0;float n_top=0.0;float n_right=0.0;float n_bottom=0.0;float cellSize=0.0;for(float i=0.0;i<MAX_LEVELS_NUM;i+=1.0){if(i<=level){left+=cellSize*n_left;top+=cellSize*n_top;right-=cellSize*n_right;bottom-=cellSize*n_bottom;cellSize=pow(2.0,levels-i-1.0);float dist_left=x-left;n_left=max(0.0,floor(dist_left/cellSize-theta));float dist_top=y-top;n_top=max(0.0,floor(dist_top/cellSize-theta));float dist_right=right-x;n_right=max(0.0,floor(dist_right/cellSize-theta));float dist_bottom=bottom-y;n_bottom=max(0.0,floor(dist_bottom/cellSize-theta));}}vec4 velocity=vec4(vec2(0.0),1.0,0.0);for(float i=0.0;i<12.0;i+=1.0){for(float j=0.0;j<4.0;j+=1.0){float n=left+cellSize*j;float m=top+cellSize*n_top+cellSize*i;if(n<(left+n_left*cellSize)&&m<bottom){velocity.xy+=calcAdd(vec2(n/cellSize,m/cellSize)/levelTextureSize,pointPosition.xy);}n=left+cellSize*i;m=top+cellSize*j;if(n<(right-n_right*cellSize)&&m<(top+n_top*cellSize)){velocity.xy+=calcAdd(vec2(n/cellSize,m/cellSize)/levelTextureSize,pointPosition.xy);}n=right-n_right*cellSize+cellSize*j;m=top+cellSize*i;if(n<right&&m<(bottom-n_bottom*cellSize)){velocity.xy+=calcAdd(vec2(n/cellSize,m/cellSize)/levelTextureSize,pointPosition.xy);}n=left+n_left*cellSize+cellSize*i;m=bottom-n_bottom*cellSize+cellSize*j;if(n<right&&m<bottom){velocity.xy+=calcAdd(vec2(n/cellSize,m/cellSize)/levelTextureSize,pointPosition.xy);}}}gl_FragColor=velocity;}",vert:Pr,framebuffer:()=>null==i?void 0:i.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==i?void 0:i.previousPositionFbo,level:(e,t)=>t.level,levels:this.quadtreeLevels,levelFbo:(e,t)=>t.levelFbo,levelTextureSize:(e,t)=>t.levelTextureSize,alpha:()=>n.alpha,repulsion:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.repulsion},spaceSize:()=>n.adjustedSpaceSize,theta:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.repulsionTheta}},blend:{enable:!0,func:{src:"one",dst:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},stencil:{enable:!1}}),this.forceFromItsOwnCentermassCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D levelFbo;uniform sampler2D randomValues;uniform float levelTextureSize;uniform float repulsion;uniform float alpha;varying vec2 index;vec2 calcAdd(vec2 ij,vec2 pp){vec2 add=vec2(0.0);vec4 centermass=texture2D(levelFbo,ij);if(centermass.r>0.0&&centermass.g>0.0&&centermass.b>0.0){vec2 centermassPosition=vec2(centermass.rg/centermass.b);vec2 distVector=pp-centermassPosition;float l=dot(distVector,distVector);float dist=sqrt(l);if(l>0.0){float angle=atan(distVector.y,distVector.x);float c=alpha*repulsion*centermass.b;float distanceMin2=1.0;if(l<distanceMin2)l=sqrt(distanceMin2*l);float addV=c/sqrt(l);add=addV*vec2(cos(angle),sin(angle));}}return add;}void main(){vec4 pointPosition=texture2D(position,index);vec4 random=texture2D(randomValues,index);vec4 velocity=vec4(0.0);velocity.xy+=calcAdd(pointPosition.xy/levelTextureSize,pointPosition.xy);velocity.xy+=velocity.xy*random.rg;gl_FragColor=velocity;}",vert:Pr,framebuffer:()=>null==i?void 0:i.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==i?void 0:i.previousPositionFbo,randomValues:()=>this.randomValuesFbo,levelFbo:(e,t)=>t.levelFbo,levelTextureSize:(e,t)=>t.levelTextureSize,alpha:()=>n.alpha,repulsion:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.repulsion},spaceSize:()=>n.adjustedSpaceSize},blend:{enable:!0,func:{src:"one",dst:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},stencil:{enable:!1}}),this.clearVelocityCommand=e({frag:Ir,vert:Pr,framebuffer:()=>null==i?void 0:i.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)}})}run(){var e,t,n,r,i;const{store:o}=this;for(let n=0;n<this.quadtreeLevels;n+=1){null===(e=this.clearLevelsCommand)||void 0===e||e.call(this,{levelFbo:this.levelsFbos.get(`level[${n}]`)});const r=Math.pow(2,n+1),i=o.adjustedSpaceSize/r;null===(t=this.calculateLevelsCommand)||void 0===t||t.call(this,{levelFbo:this.levelsFbos.get(`level[${n}]`),levelTextureSize:r,cellSize:i})}null===(n=this.clearVelocityCommand)||void 0===n||n.call(this);for(let e=0;e<this.quadtreeLevels;e+=1){const t=Math.pow(2,e+1);null===(r=this.forceCommand)||void 0===r||r.call(this,{levelFbo:this.levelsFbos.get(`level[${e}]`),levelTextureSize:t,level:e}),e===this.quadtreeLevels-1&&(null===(i=this.forceFromItsOwnCentermassCommand)||void 0===i||i.call(this,{levelFbo:this.levelsFbos.get(`level[${e}]`),levelTextureSize:t,level:e}))}}destroy(){Mr(this.randomValuesFbo),this.levelsFbos.forEach((e=>{Mr(e)})),this.levelsFbos.clear()}}function Br(e,t){e=Math.min(e,t);const n=t-e,r="\n    float dist = sqrt(l);\n    if (dist > 0.0) {\n      float c = alpha * repulsion * centermass.b;\n      addVelocity += calcAdd(vec2(x, y), l, c);\n      addVelocity += addVelocity * random.rg;\n    }\n  ";return`\n#ifdef GL_ES\nprecision highp float;\n#endif\n\nuniform sampler2D position;\nuniform sampler2D randomValues;\nuniform float spaceSize;\nuniform float repulsion;\nuniform float theta;\nuniform float alpha;\nuniform sampler2D level[${t}];\nvarying vec2 index;\n\nvec2 calcAdd(vec2 xy, float l, float c) {\n  float distanceMin2 = 1.0;\n  if (l < distanceMin2) l = sqrt(distanceMin2 * l);\n  float add = c / l;\n  return add * xy;\n}\n\nvoid main() {\n  vec4 pointPosition = texture2D(position, index);\n  vec4 random = texture2D(randomValues, index);\n\n  float width0 = spaceSize;\n\n  vec2 velocity = vec2(0.0);\n  vec2 addVelocity = vec2(0.0);\n\n  ${new Array(t).fill(0).map(((e,t)=>`float width${t+1} = width${t} / 2.0;`)).join("\n")}\n\n  for (float n = 0.0; n < pow(2.0, ${n}.0); n += 1.0) {\n    for (float m = 0.0; m < pow(2.0, ${n}.0); m += 1.0) {\n      ${function i(o){if(o>=t)return r;{const t=Math.pow(2,o+1),a=new Array(o+1-n).fill(0).map(((e,t)=>`pow(2.0, ${o-(t+n)}.0) * i${t+n}`)).join("+"),s=new Array(o+1-n).fill(0).map(((e,t)=>`pow(2.0, ${o-(t+n)}.0) * j${t+n}`)).join("+");return`\n      for (float ij${o} = 0.0; ij${o} < 4.0; ij${o} += 1.0) {\n        float i${o} = 0.0;\n        float j${o} = 0.0;\n        if (ij${o} == 1.0 || ij${o} == 3.0) i${o} = 1.0;\n        if (ij${o} == 2.0 || ij${o} == 3.0) j${o} = 1.0;\n        float i = pow(2.0, ${e}.0) * n / width${o+1} + ${a};\n        float j = pow(2.0, ${e}.0) * m / width${o+1} + ${s};\n        float groupPosX = (i + 0.5) / ${t}.0;\n        float groupPosY = (j + 0.5) / ${t}.0;\n        \n        vec4 centermass = texture2D(level[${o}], vec2(groupPosX, groupPosY));\n        if (centermass.r > 0.0 && centermass.g > 0.0 && centermass.b > 0.0) {\n          float x = centermass.r / centermass.b - pointPosition.r;\n          float y = centermass.g / centermass.b - pointPosition.g;\n          float l = x * x + y * y;\n          if ((width${o+1} * width${o+1}) / theta < l) {\n            ${r}\n          } else {\n            ${i(o+1)}\n          }\n        }\n      }\n      `}}(n)}\n    }\n  }\n\n  velocity -= addVelocity;\n\n  gl_FragColor = vec4(velocity, 0.0, 0.0);\n}\n`}class Rr extends kr{constructor(){super(...arguments),this.levelsFbos=new Map,this.quadtreeLevels=0}create(){const{reglInstance:e,store:t}=this;if(!t.pointsTextureSize)return;this.quadtreeLevels=Math.log2(t.adjustedSpaceSize);for(let t=0;t<this.quadtreeLevels;t+=1){const n=Math.pow(2,t+1);this.levelsFbos.set(`level[${t}]`,e.framebuffer({color:e.texture({data:new Float32Array(n*n*4),shape:[n,n,4],type:"float"}),depth:!1,stencil:!1}))}const n=new Float32Array(t.pointsTextureSize*t.pointsTextureSize*4);for(let e=0;e<t.pointsTextureSize*t.pointsTextureSize;++e)n[4*e]=1e-5*t.getRandomFloat(-1,1),n[4*e+1]=1e-5*t.getRandomFloat(-1,1);this.randomValuesFbo=e.framebuffer({color:e.texture({data:n,shape:[t.pointsTextureSize,t.pointsTextureSize,4],type:"float"}),depth:!1,stencil:!1})}initPrograms(){var e,t;const{reglInstance:n,config:r,store:i,data:o,points:a}=this;this.clearLevelsCommand=n({frag:Ir,vert:Pr,framebuffer:(e,t)=>t.levelFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(n)}}),this.calculateLevelsCommand=n({frag:Or,vert:Lr,framebuffer:(e,t)=>t.levelFbo,primitive:"points",count:()=>o.nodes.length,attributes:{indexes:Tr(n,i.pointsTextureSize)},uniforms:{position:()=>null==a?void 0:a.previousPositionFbo,pointsTextureSize:()=>i.pointsTextureSize,levelTextureSize:(e,t)=>t.levelTextureSize,cellSize:(e,t)=>t.cellSize},blend:{enable:!0,func:{src:"one",dst:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},stencil:{enable:!1}}),this.quadtreeCommand=n({frag:Br(null!==(t=null===(e=r.simulation)||void 0===e?void 0:e.repulsionQuadtreeLevels)&&void 0!==t?t:this.quadtreeLevels,this.quadtreeLevels),vert:Pr,framebuffer:()=>null==a?void 0:a.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(n)},uniforms:{position:()=>null==a?void 0:a.previousPositionFbo,randomValues:()=>this.randomValuesFbo,spaceSize:()=>i.adjustedSpaceSize,repulsion:()=>{var e;return null===(e=r.simulation)||void 0===e?void 0:e.repulsion},theta:()=>{var e;return null===(e=r.simulation)||void 0===e?void 0:e.repulsionTheta},alpha:()=>i.alpha,...Object.fromEntries(this.levelsFbos)}})}run(){var e,t,n;const{store:r}=this;for(let n=0;n<this.quadtreeLevels;n+=1){null===(e=this.clearLevelsCommand)||void 0===e||e.call(this,{levelFbo:this.levelsFbos.get(`level[${n}]`)});const i=Math.pow(2,n+1),o=r.adjustedSpaceSize/i;null===(t=this.calculateLevelsCommand)||void 0===t||t.call(this,{levelFbo:this.levelsFbos.get(`level[${n}]`),levelTextureSize:i,cellSize:o})}null===(n=this.quadtreeCommand)||void 0===n||n.call(this)}destroy(){Mr(this.randomValuesFbo),this.levelsFbos.forEach((e=>{Mr(e)})),this.levelsFbos.clear()}}class Vr extends kr{initPrograms(){const{reglInstance:e,config:t,store:n,points:r}=this;this.runCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float repulsion;uniform vec2 mousePos;varying vec2 index;void main(){vec4 pointPosition=texture2D(position,index);vec4 velocity=vec4(0.0);vec2 mouse=mousePos;vec2 distVector=mouse-pointPosition.rg;float dist=sqrt(dot(distVector,distVector));dist=max(dist,10.0);float angle=atan(distVector.y,distVector.x);float addV=100.0*repulsion/(dist*dist);velocity.rg-=addV*vec2(cos(angle),sin(angle));gl_FragColor=velocity;}",vert:Pr,framebuffer:()=>null==r?void 0:r.velocityFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>null==r?void 0:r.previousPositionFbo,mousePos:()=>n.mousePosition,repulsion:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.repulsionFromMouse}}})}run(){var e;null===(e=this.runCommand)||void 0===e||e.call(this)}}var qr={exports:{}};!function(e,t){e.exports=function(){var e='<div class="gl-box">\n  <svg viewBox="0 0 55 60">\n    <text x="27" y="56" class="gl-fps">00 FPS</text>\n    <text x="28" y="8" class="gl-mem"></text>\n    <rect x="0" y="14" rx="4" ry="4" width="55" height="32"></rect>\n    <polyline class="gl-chart"></polyline>\n  </svg>\n  <svg viewBox="0 0 14 60" class="gl-cpu-svg">\n    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>\n    <line x1="7" y1="38" x2="7" y2="11" class="gl-cpu" stroke-dasharray="0 27"/>\n    <path d="M5.35 43c-.464 0-.812.377-.812.812v1.16c-.783.1972-1.421.812-1.595 1.624h-1.16c-.435 0-.812.348-.812.812s.348.812.812.812h1.102v1.653H1.812c-.464 0-.812.377-.812.812 0 .464.377.812.812.812h1.131c.1943.783.812 1.392 1.595 1.595v1.131c0 .464.377.812.812.812.464 0 .812-.377.812-.812V53.15h1.653v1.073c0 .464.377.812.812.812.464 0 .812-.377.812-.812v-1.131c.783-.1943 1.392-.812 1.595-1.595h1.131c.464 0 .812-.377.812-.812 0-.464-.377-.812-.812-.812h-1.073V48.22h1.102c.435 0 .812-.348.812-.812s-.348-.812-.812-.812h-1.16c-.1885-.783-.812-1.421-1.595-1.624v-1.131c0-.464-.377-.812-.812-.812-.464 0-.812.377-.812.812v1.073H6.162v-1.073c0-.464-.377-.812-.812-.812zm.58 3.48h2.088c.754 0 1.363.609 1.363 1.363v2.088c0 .754-.609 1.363-1.363 1.363H5.93c-.754 0-1.363-.609-1.363-1.363v-2.088c0-.754.609-1.363 1.363-1.363z"/>\n  </svg>\n  <svg viewBox="0 0 14 60" class="gl-gpu-svg">\n    <line x1="7" y1="38" x2="7" y2="11" class="opacity"/>\n    <line x1="7" y1="38" x2="7" y2="11" class="gl-gpu" stroke-dasharray="0 27"/>\n    <path d="M1.94775 43.3772a.736.736 0 10-.00416 1.472c.58535.00231.56465.1288.6348.3197.07015.18975.04933.43585.04933.43585l-.00653.05405v8.671a.736.736 0 101.472 0v-1.4145c.253.09522.52785.1495.81765.1495h5.267c1.2535 0 2.254-.9752 2.254-2.185v-3.105c0-1.2075-1.00625-2.185-2.254-2.185h-5.267c-.28865 0-.5635.05405-.8165.1495.01806-.16445.04209-.598-.1357-1.0787-.22425-.6072-.9499-1.2765-2.0125-1.2765zm2.9095 3.6455c.42435 0 .7659.36225.7659.8119v2.9785c0 .44965-.34155.8119-.7659.8119s-.7659-.36225-.7659-.8119v-2.9785c0-.44965.34155-.8119.7659-.8119zm4.117 0a2.3 2.3 0 012.3 2.3 2.3 2.3 0 01-2.3 2.3 2.3 2.3 0 01-2.3-2.3 2.3 2.3 0 012.3-2.3z"/>\n  </svg>\n</div>',t="#gl-bench {\n  position:absolute;\n  left:0;\n  top:0;\n  z-index:1000;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  user-select: none;\n}\n\n#gl-bench div {\n  position: relative;\n  display: block;\n  margin: 4px;\n  padding: 0 7px 0 10px;\n  background: #6c6;\n  border-radius: 15px;\n  cursor: pointer;\n  opacity: 0.9;\n}\n\n#gl-bench svg {\n  height: 60px;\n  margin: 0 -1px;\n}\n\n#gl-bench text {\n  font-size: 12px;\n  font-family: Helvetica,Arial,sans-serif;\n  font-weight: 700;\n  dominant-baseline: middle;\n  text-anchor: middle;\n}\n\n#gl-bench .gl-mem {\n  font-size: 9px;\n}\n\n#gl-bench line {\n  stroke-width: 5;\n  stroke: #112211;\n  stroke-linecap: round;\n}\n\n#gl-bench polyline {\n  fill: none;\n  stroke: #112211;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n  stroke-width: 3.5;\n}\n\n#gl-bench rect {\n  fill: #448844;\n}\n\n#gl-bench .opacity {\n  stroke: #448844;\n}\n";class n{constructor(n,r={}){this.css=t,this.svg=e,this.paramLogger=()=>{},this.chartLogger=()=>{},this.chartLen=20,this.chartHz=20,this.names=[],this.cpuAccums=[],this.gpuAccums=[],this.activeAccums=[],this.chart=new Array(this.chartLen),this.now=()=>performance&&performance.now?performance.now():Date.now(),this.updateUI=()=>{[].forEach.call(this.nodes["gl-gpu-svg"],(e=>{e.style.display=this.trackGPU?"inline":"none"}))},Object.assign(this,r),this.detected=0,this.finished=[],this.isFramebuffer=0,this.frameId=0;let i,o,a=0,s=e=>{++a<20?i=requestAnimationFrame(s):(this.detected=Math.ceil(1e3*a/(e-o)/70),cancelAnimationFrame(i)),o||(o=e)};if(requestAnimationFrame(s),n){const e=async(e,t)=>Promise.resolve(setTimeout((()=>{n.getError();const r=this.now()-e;t.forEach(((e,t)=>{e&&(this.gpuAccums[t]+=r)}))}),0)),t=(t,n,r)=>function(){const i=n.now();t.apply(r,arguments),n.trackGPU&&n.finished.push(e(i,n.activeAccums.slice(0)))};["drawArrays","drawElements","drawArraysInstanced","drawBuffers","drawElementsInstanced","drawRangeElements"].forEach((e=>{n[e]&&(n[e]=t(n[e],this,n))})),n.getExtension=((e,r)=>function(){let i=e.apply(n,arguments);return i&&["drawElementsInstancedANGLE","drawBuffersWEBGL"].forEach((e=>{i[e]&&(i[e]=t(i[e],r,i))})),i})(n.getExtension,this)}if(!this.withoutUI){this.dom||(this.dom=document.body);let e=document.createElement("div");e.id="gl-bench",this.dom.appendChild(e),this.dom.insertAdjacentHTML("afterbegin",'<style id="gl-bench-style">'+this.css+"</style>"),this.dom=e,this.dom.addEventListener("click",(()=>{this.trackGPU=!this.trackGPU,this.updateUI()})),this.paramLogger=((e,t,n)=>{const r=["gl-cpu","gl-gpu","gl-mem","gl-fps","gl-gpu-svg","gl-chart"],i=Object.assign({},r);return r.forEach((e=>i[e]=t.getElementsByClassName(e))),this.nodes=i,(t,r,o,a,s,u,c)=>{i["gl-cpu"][t].style.strokeDasharray=(.27*r).toFixed(0)+" 100",i["gl-gpu"][t].style.strokeDasharray=(.27*o).toFixed(0)+" 100",i["gl-mem"][t].innerHTML=n[t]?n[t]:a?"mem: "+a.toFixed(0)+"mb":"",i["gl-fps"][t].innerHTML=s.toFixed(0)+" FPS",e(n[t],r,o,a,s,u,c)}})(this.paramLogger,this.dom,this.names),this.chartLogger=((e,t)=>{let n={"gl-chart":this.dom.getElementsByClassName("gl-chart")};return(t,r,i)=>{let o="",a=r.length;for(let e=0;e<a;e++){let t=(i+e+1)%a;null!=r[t]&&(o=o+" "+(55*e/(a-1)).toFixed(1)+","+(45-22*r[t]/60/this.detected).toFixed(1))}n["gl-chart"][t].setAttribute("points",o),e(this.names[t],r,i)}})(this.chartLogger)}}addUI(e){-1==this.names.indexOf(e)&&(this.names.push(e),this.dom&&(this.dom.insertAdjacentHTML("beforeend",this.svg),this.updateUI()),this.cpuAccums.push(0),this.gpuAccums.push(0),this.activeAccums.push(!1))}nextFrame(e){this.frameId++;const t=e||this.now();if(this.frameId<=1)this.paramFrame=this.frameId,this.paramTime=t;else{let e=t-this.paramTime;if(e>=1e3){const n=this.frameId-this.paramFrame,r=n/e*1e3;for(let t=0;t<this.names.length;t++){const i=this.cpuAccums[t]/e*100,o=this.gpuAccums[t]/e*100,a=performance&&performance.memory?performance.memory.usedJSHeapSize/(1<<20):0;this.paramLogger(t,i,o,a,r,e,n),this.cpuAccums[t]=0,Promise.all(this.finished).then((()=>{this.gpuAccums[t]=0,this.finished=[]}))}this.paramFrame=this.frameId,this.paramTime=t}}if(this.detected&&this.chartFrame){let e=t-this.chartTime,n=this.chartHz*e/1e3;for(;--n>0&&this.detected;){const n=(this.frameId-this.chartFrame)/e*1e3;this.chart[this.circularId%this.chartLen]=n;for(let e=0;e<this.names.length;e++)this.chartLogger(e,this.chart,this.circularId);this.circularId++,this.chartFrame=this.frameId,this.chartTime=t}}else this.chartFrame=this.frameId,this.chartTime=t,this.circularId=0}begin(e){this.updateAccums(e)}end(e){this.updateAccums(e)}updateAccums(e){let t=this.names.indexOf(e);-1==t&&(t=this.names.length,this.addUI(e));const n=this.now(),r=n-this.t0;for(let e=0;e<t+1;e++)this.activeAccums[e]&&(this.cpuAccums[e]+=r);this.activeAccums[t]=!this.activeAccums[t],this.t0=n}}return n}()}(qr);var Gr=qr.exports;class Ur{constructor(e){this.destroy();const t=e.getContext("webgl")||e.getContext("experimental-webgl");this.bench=new Gr(t,{css:"\n  #gl-bench {\n    position:absolute;\n    right:0;\n    top:0;\n    z-index:1000;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  #gl-bench div {\n    position: relative;\n    display: block;\n    margin: 4px;\n    padding: 0 7px 0 10px;\n    background: #5f69de;\n    border-radius: 15px;\n    cursor: pointer;\n    opacity: 0.9;\n  }\n  #gl-bench svg {\n    height: 60px;\n    margin: 0 -1px;\n  }\n  #gl-bench text {\n    font-size: 12px;\n    font-family: Helvetica,Arial,sans-serif;\n    font-weight: 700;\n    dominant-baseline: middle;\n    text-anchor: middle;\n  }\n  #gl-bench .gl-mem {\n    font-size: 9px;\n  }\n  #gl-bench line {\n    stroke-width: 5;\n    stroke: #112211;\n    stroke-linecap: round;\n  }\n  #gl-bench polyline {\n    fill: none;\n    stroke: #112211;\n    stroke-linecap: round;\n    stroke-linejoin: round;\n    stroke-width: 3.5;\n  }\n  #gl-bench rect {\n    fill: #8288e4;\n  }\n  #gl-bench .opacity {\n    stroke: #8288e4;\n  }\n"})}begin(){var e;null===(e=this.bench)||void 0===e||e.begin("frame")}end(e){var t,n;null===(t=this.bench)||void 0===t||t.end("frame"),null===(n=this.bench)||void 0===n||n.nextFrame(e)}destroy(){this.bench=void 0,de("#gl-bench").remove()}}class Hr{constructor(){this.completeLinks=new Set,this.degree=[],this.groupedSourceToTargetLinks=new Map,this.groupedTargetToSourceLinks=new Map,this._nodes=[],this._links=[],this.idToNodeMap=new Map,this.sortedIndexToInputIndexMap=new Map,this.inputIndexToSortedIndexMap=new Map,this.idToSortedIndexMap=new Map,this.inputIndexToIdMap=new Map,this.idToIndegreeMap=new Map,this.idToOutdegreeMap=new Map}get nodes(){return this._nodes}get links(){return this._links}get linksNumber(){return this.completeLinks.size}setData(e,t){this.idToNodeMap.clear(),this.idToSortedIndexMap.clear(),this.inputIndexToIdMap.clear(),this.idToIndegreeMap.clear(),this.idToOutdegreeMap.clear(),e.forEach(((e,t)=>{this.idToNodeMap.set(e.id,e),this.inputIndexToIdMap.set(t,e.id),this.idToIndegreeMap.set(e.id,0),this.idToOutdegreeMap.set(e.id,0)})),this.completeLinks.clear(),t.forEach((e=>{const t=this.idToNodeMap.get(e.source),n=this.idToNodeMap.get(e.target);if(void 0!==t&&void 0!==n){this.completeLinks.add(e);const r=this.idToOutdegreeMap.get(t.id);void 0!==r&&this.idToOutdegreeMap.set(t.id,r+1);const i=this.idToIndegreeMap.get(n.id);void 0!==i&&this.idToIndegreeMap.set(n.id,i+1)}})),this.degree=new Array(e.length),e.forEach(((e,t)=>{const n=this.idToOutdegreeMap.get(e.id),r=this.idToIndegreeMap.get(e.id);this.degree[t]=(null!=n?n:0)+(null!=r?r:0)})),this.sortedIndexToInputIndexMap.clear(),this.inputIndexToSortedIndexMap.clear();Object.entries(this.degree).sort(((e,t)=>e[1]-t[1])).forEach((([e],t)=>{const n=+e;this.sortedIndexToInputIndexMap.set(t,n),this.inputIndexToSortedIndexMap.set(n,t),this.idToSortedIndexMap.set(this.inputIndexToIdMap.get(n),t)})),this.groupedSourceToTargetLinks.clear(),this.groupedTargetToSourceLinks.clear(),t.forEach((e=>{const t=this.idToSortedIndexMap.get(e.source),n=this.idToSortedIndexMap.get(e.target);if(void 0!==t&&void 0!==n){void 0===this.groupedSourceToTargetLinks.get(t)&&this.groupedSourceToTargetLinks.set(t,new Set);const e=this.groupedSourceToTargetLinks.get(t);null==e||e.add(n),void 0===this.groupedTargetToSourceLinks.get(n)&&this.groupedTargetToSourceLinks.set(n,new Set);const r=this.groupedTargetToSourceLinks.get(n);null==r||r.add(t)}})),this._nodes=e,this._links=t}getNodeById(e){return this.idToNodeMap.get(e)}getNodeByIndex(e){return this._nodes[e]}getSortedIndexByInputIndex(e){return this.inputIndexToSortedIndexMap.get(e)}getInputIndexBySortedIndex(e){return this.sortedIndexToInputIndexMap.get(e)}getSortedIndexById(e){return void 0!==e?this.idToSortedIndexMap.get(e):void 0}getInputIndexById(e){if(void 0===e)return;const t=this.getSortedIndexById(e);return void 0!==t?this.getInputIndexBySortedIndex(t):void 0}getAdjacentNodes(e){var t,n;const r=this.getSortedIndexById(e);if(void 0===r)return;const i=null!==(t=this.groupedSourceToTargetLinks.get(r))&&void 0!==t?t:[],o=null!==(n=this.groupedTargetToSourceLinks.get(r))&&void 0!==n?n:[];return[...new Set([...i,...o])].map((e=>this.getNodeByIndex(this.getInputIndexBySortedIndex(e))))}}function Yr(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Wr(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function $r(e){let t,n,r;function i(e,r,i=0,o=e.length){if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<0?i=t+1:o=t}while(i<o)}return i}return 2!==e.length?(t=Yr,n=(t,n)=>Yr(e(t),n),r=(t,n)=>e(t)-n):(t=e===Yr||e===Wr?e:Zr,n=e,r=e),{left:i,center:function(e,t,n=0,o=e.length){const a=i(e,t,n,o-1);return a>n&&r(e[a-1],t)>-r(e[a],t)?a-1:a},right:function(e,r,i=0,o=e.length){if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<=0?i=t+1:o=t}while(i<o)}return i}}}function Zr(){return 0}const Xr=$r(Yr).right;function Qr(e,t){let n,r;if(void 0===t)for(const t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));else{let i=-1;for(let o of e)null!=(o=t(o,++i,e))&&(void 0===n?o>=o&&(n=r=o):(n>o&&(n=o),r<o&&(r=o)))}return[n,r]}$r((function(e){return null===e?NaN:+e})).center;var Jr=Math.sqrt(50),Kr=Math.sqrt(10),ei=Math.sqrt(2);function ti(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=Jr?10:o>=Kr?5:o>=ei?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=Jr?10:o>=Kr?5:o>=ei?2:1)}function ni(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function ri(e){return+e}var ii=[0,1];function oi(e){return e}function ai(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function si(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=ai(i,r),o=n(a,o)):(r=ai(r,i),o=n(o,a)),function(e){return o(r(e))}}function ui(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=ai(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=Xr(e,t,1,r)-1;return o[n](i[n](t))}}function ci(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function li(){var e,t,n,r,i,o,a=ii,s=ii,u=_n,c=oi;function l(){var e,t,n,u=Math.min(a.length,s.length);return c!==oi&&(e=a[0],t=a[u-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=u>2?ui:si,i=o=null,f}function f(t){return null==t||isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(c(t)))}return f.invert=function(n){return c(t((o||(o=r(s,a.map(e),yn)))(n)))},f.domain=function(e){return arguments.length?(a=Array.from(e,ri),l()):a.slice()},f.range=function(e){return arguments.length?(s=Array.from(e),l()):s.slice()},f.rangeRound=function(e){return s=Array.from(e),u=An,l()},f.clamp=function(e){return arguments.length?(c=!!e||oi,l()):c!==oi},f.interpolate=function(e){return arguments.length?(u=e,l()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,l()}}function fi(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function hi(e){return(e=fi(Math.abs(e)))?e[1]:NaN}var di,pi=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function mi(e){if(!(t=pi.exec(e)))throw new Error("invalid format: "+e);var t;return new vi({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function vi(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function gi(e,t){var n=fi(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}mi.prototype=vi.prototype,vi.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var yi={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>gi(100*e,t),r:gi,s:function(e,t){var n=fi(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(di=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+fi(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function bi(e){return e}var xi,wi,Si,_i=Array.prototype.map,Ai=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function ki(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?bi:(t=_i.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?bi:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(_i.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"":e.minus+"",l=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=mi(e)).fill,n=e.align,f=e.sign,h=e.symbol,d=e.zero,p=e.width,m=e.comma,v=e.precision,g=e.trim,y=e.type;"n"===y?(m=!0,y="g"):yi[y]||(void 0===v&&(v=12),g=!0,y="g"),(d||"0"===t&&"="===n)&&(d=!0,t="0",n="=");var b="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===h?o:/[%p]/.test(y)?u:"",w=yi[y],S=/[defgprs%]/.test(y);function _(e){var i,o,u,h=b,_=x;if("c"===y)_=w(e)+_,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?l:w(Math.abs(e),v),g&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==f&&(A=!1),h=(A?"("===f?f:c:"-"===f||"("===f?"":f)+h,_=("s"===y?Ai[8+di/3]:"")+_+(A&&"("===f?")":""),S)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){_=(46===u?a+e.slice(i+1):e.slice(i))+_,e=e.slice(0,i);break}}m&&!d&&(e=r(e,1/0));var k=h.length+e.length+_.length,z=k<p?new Array(p-k+1).join(t):"";switch(m&&d&&(e=r(z+e,z.length?p-_.length:1/0),z=""),n){case"<":e=h+e+_+z;break;case"=":e=h+z+e+_;break;case"^":e=z.slice(0,k=z.length>>1)+h+e+_+z.slice(k);break;default:e=z+h+e+_}return s(e)}return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),_.toString=function(){return e+""},_}return{format:f,formatPrefix:function(e,t){var n=f(((e=mi(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(hi(t)/3))),i=Math.pow(10,-r),o=Ai[8+r/3];return function(e){return n(i*e)+o}}}}function zi(e,t,n,r){var i,o=function(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=Jr?i*=10:o>=Kr?i*=5:o>=ei&&(i*=2),t<e?-i:i}(e,t,n);switch((r=mi(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(hi(t)/3)))-hi(Math.abs(e)))}(o,a))||(r.precision=i),Si(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,hi(t)-hi(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-hi(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return wi(r)}function Ti(e){var t=e.domain;return e.ticks=function(e){var n=t();return function(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=ti(e,t,n))||!isFinite(a))return[];if(a>0){let n=Math.round(e/a),r=Math.round(t/a);for(n*a<e&&++n,r*a>t&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)*a}else{a=-a;let n=Math.round(e*a),r=Math.round(t*a);for(n/a<e&&++n,r/a>t&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)/a}return r&&o.reverse(),o}(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return zi(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i,o=t(),a=0,s=o.length-1,u=o[a],c=o[s],l=10;for(c<u&&(i=u,u=c,c=i,i=a,a=s,s=i);l-- >0;){if((i=ti(u,c,n))===r)return o[a]=u,o[s]=c,t(o);if(i>0)u=Math.floor(u/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;u=Math.ceil(u*i)/i,c=Math.floor(c*i)/i}r=i}return e},e}function Mi(){var e=li()(oi,oi);return e.copy=function(){return ci(e,Mi())},ni.apply(e,arguments),Ti(e)}function Ci(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Ii(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Pi(e){return e<0?-e*e:e*e}function Fi(e){var t=e(oi,oi),n=1;return t.exponent=function(t){return arguments.length?1===(n=+t)?e(oi,oi):.5===n?e(Ii,Pi):e(Ci(n),Ci(1/n)):n},Ti(t)}function Ei(){var e=Fi(li());return e.copy=function(){return ci(e,Ei()).exponent(e.exponent())},ni.apply(e,arguments),e}xi=ki({thousands:",",grouping:[3],currency:["$",""]}),wi=xi.format,Si=xi.formatPrefix;var Di=new Date,Ni=new Date;function Oi(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return Oi((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return Di.setTime(+t),Ni.setTime(+r),e(Di),e(Ni),Math.floor(n(Di,Ni))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var Li=Oi((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e}));Li.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?Oi((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Li:null},Li.range;const ji=1e3,Bi=6e4,Ri=36e5,Vi=864e5,qi=6048e5;var Gi=Oi((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*ji)}),(function(e,t){return(t-e)/ji}),(function(e){return e.getUTCSeconds()}));Gi.range;var Ui=Oi((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ji)}),(function(e,t){e.setTime(+e+t*Bi)}),(function(e,t){return(t-e)/Bi}),(function(e){return e.getMinutes()}));Ui.range;var Hi=Oi((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*ji-e.getMinutes()*Bi)}),(function(e,t){e.setTime(+e+t*Ri)}),(function(e,t){return(t-e)/Ri}),(function(e){return e.getHours()}));Hi.range;var Yi=Oi((e=>e.setHours(0,0,0,0)),((e,t)=>e.setDate(e.getDate()+t)),((e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Bi)/Vi),(e=>e.getDate()-1));function Wi(e){return Oi((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*Bi)/qi}))}Yi.range;var $i=Wi(0),Zi=Wi(1),Xi=Wi(2),Qi=Wi(3),Ji=Wi(4),Ki=Wi(5),eo=Wi(6);$i.range,Zi.range,Xi.range,Qi.range,Ji.range,Ki.range,eo.range;var to=Oi((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}));to.range;var no=Oi((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));no.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Oi((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null},no.range;var ro=Oi((function(e){e.setUTCSeconds(0,0)}),(function(e,t){e.setTime(+e+t*Bi)}),(function(e,t){return(t-e)/Bi}),(function(e){return e.getUTCMinutes()}));ro.range;var io=Oi((function(e){e.setUTCMinutes(0,0,0)}),(function(e,t){e.setTime(+e+t*Ri)}),(function(e,t){return(t-e)/Ri}),(function(e){return e.getUTCHours()}));io.range;var oo=Oi((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Vi}),(function(e){return e.getUTCDate()-1}));function ao(e){return Oi((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/qi}))}oo.range;var so=ao(0),uo=ao(1),co=ao(2),lo=ao(3),fo=ao(4),ho=ao(5),po=ao(6);so.range,uo.range,co.range,lo.range,fo.range,ho.range,po.range;var mo=Oi((function(e){e.setUTCDate(1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCMonth(e.getUTCMonth()+t)}),(function(e,t){return t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear())}),(function(e){return e.getUTCMonth()}));mo.range;var vo=Oi((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()}));function go(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function yo(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bo(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}vo.every=function(e){return isFinite(e=Math.floor(e))&&e>0?Oi((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null},vo.range;var xo,wo,So,_o={"-":"",_:" ",0:"0"},Ao=/^\s*\d+/,ko=/^%/,zo=/[\\^$*+?|[\]().{}]/g;function To(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function Mo(e){return e.replace(zo,"\\$&")}function Co(e){return new RegExp("^(?:"+e.map(Mo).join("|")+")","i")}function Io(e){return new Map(e.map(((e,t)=>[e.toLowerCase(),t])))}function Po(e,t,n){var r=Ao.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function Fo(e,t,n){var r=Ao.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function Eo(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function Do(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function No(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Oo(e,t,n){var r=Ao.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Lo(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function jo(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Bo(e,t,n){var r=Ao.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Ro(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function Vo(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function qo(e,t,n){var r=Ao.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function Go(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Uo(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Ho(e,t,n){var r=Ao.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function Yo(e,t,n){var r=Ao.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Wo(e,t,n){var r=Ao.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function $o(e,t,n){var r=ko.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Zo(e,t,n){var r=Ao.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Xo(e,t,n){var r=Ao.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Qo(e,t){return To(e.getDate(),t,2)}function Jo(e,t){return To(e.getHours(),t,2)}function Ko(e,t){return To(e.getHours()%12||12,t,2)}function ea(e,t){return To(1+Yi.count(no(e),e),t,3)}function ta(e,t){return To(e.getMilliseconds(),t,3)}function na(e,t){return ta(e,t)+"000"}function ra(e,t){return To(e.getMonth()+1,t,2)}function ia(e,t){return To(e.getMinutes(),t,2)}function oa(e,t){return To(e.getSeconds(),t,2)}function aa(e){var t=e.getDay();return 0===t?7:t}function sa(e,t){return To($i.count(no(e)-1,e),t,2)}function ua(e){var t=e.getDay();return t>=4||0===t?Ji(e):Ji.ceil(e)}function ca(e,t){return e=ua(e),To(Ji.count(no(e),e)+(4===no(e).getDay()),t,2)}function la(e){return e.getDay()}function fa(e,t){return To(Zi.count(no(e)-1,e),t,2)}function ha(e,t){return To(e.getFullYear()%100,t,2)}function da(e,t){return To((e=ua(e)).getFullYear()%100,t,2)}function pa(e,t){return To(e.getFullYear()%1e4,t,4)}function ma(e,t){var n=e.getDay();return To((e=n>=4||0===n?Ji(e):Ji.ceil(e)).getFullYear()%1e4,t,4)}function va(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+To(t/60|0,"0",2)+To(t%60,"0",2)}function ga(e,t){return To(e.getUTCDate(),t,2)}function ya(e,t){return To(e.getUTCHours(),t,2)}function ba(e,t){return To(e.getUTCHours()%12||12,t,2)}function xa(e,t){return To(1+oo.count(vo(e),e),t,3)}function wa(e,t){return To(e.getUTCMilliseconds(),t,3)}function Sa(e,t){return wa(e,t)+"000"}function _a(e,t){return To(e.getUTCMonth()+1,t,2)}function Aa(e,t){return To(e.getUTCMinutes(),t,2)}function ka(e,t){return To(e.getUTCSeconds(),t,2)}function za(e){var t=e.getUTCDay();return 0===t?7:t}function Ta(e,t){return To(so.count(vo(e)-1,e),t,2)}function Ma(e){var t=e.getUTCDay();return t>=4||0===t?fo(e):fo.ceil(e)}function Ca(e,t){return e=Ma(e),To(fo.count(vo(e),e)+(4===vo(e).getUTCDay()),t,2)}function Ia(e){return e.getUTCDay()}function Pa(e,t){return To(uo.count(vo(e)-1,e),t,2)}function Fa(e,t){return To(e.getUTCFullYear()%100,t,2)}function Ea(e,t){return To((e=Ma(e)).getUTCFullYear()%100,t,2)}function Da(e,t){return To(e.getUTCFullYear()%1e4,t,4)}function Na(e,t){var n=e.getUTCDay();return To((e=n>=4||0===n?fo(e):fo.ceil(e)).getUTCFullYear()%1e4,t,4)}function Oa(){return"+0000"}function La(){return"%"}function ja(e){return+e}function Ba(e){return Math.floor(+e/1e3)}!function(e){xo=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,c=Co(i),l=Io(i),f=Co(o),h=Io(o),d=Co(a),p=Io(a),m=Co(s),v=Io(s),g=Co(u),y=Io(u),b={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Qo,e:Qo,f:na,g:da,G:ma,H:Jo,I:Ko,j:ea,L:ta,m:ra,M:ia,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:ja,s:Ba,S:oa,u:aa,U:sa,V:ca,w:la,W:fa,x:null,X:null,y:ha,Y:pa,Z:va,"%":La},x={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:ga,e:ga,f:Sa,g:Ea,G:Na,H:ya,I:ba,j:xa,L:wa,m:_a,M:Aa,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:ja,s:Ba,S:ka,u:za,U:Ta,V:Ca,w:Ia,W:Pa,x:null,X:null,y:Fa,Y:Da,Z:Oa,"%":La},w={a:function(e,t,n){var r=d.exec(t.slice(n));return r?(e.w=p.get(r[0].toLowerCase()),n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h.get(r[0].toLowerCase()),n+r[0].length):-1},b:function(e,t,n){var r=g.exec(t.slice(n));return r?(e.m=y.get(r[0].toLowerCase()),n+r[0].length):-1},B:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=v.get(r[0].toLowerCase()),n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:Vo,e:Vo,f:Wo,g:Lo,G:Oo,H:Go,I:Go,j:qo,L:Yo,m:Ro,M:Uo,p:function(e,t,n){var r=c.exec(t.slice(n));return r?(e.p=l.get(r[0].toLowerCase()),n+r[0].length):-1},q:Bo,Q:Zo,s:Xo,S:Ho,u:Fo,U:Eo,V:Do,w:Po,W:No,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:Lo,Y:Oo,Z:jo,"%":$o};function S(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,c=e.length;for(n instanceof Date||(n=new Date(+n));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=_o[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function _(e,t){return function(n){var r,i,o=bo(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=yo(bo(o.y,0,1))).getUTCDay(),r=i>4||0===i?uo.ceil(r):uo(r),r=oo.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=go(bo(o.y,0,1))).getDay(),r=i>4||0===i?Zi.ceil(r):Zi(r),r=Yi.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?yo(bo(o.y,0,1)).getUTCDay():go(bo(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,yo(o)):go(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=w[i in _o?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return b.x=S(n,b),b.X=S(r,b),b.c=S(t,b),x.x=S(n,x),x.X=S(r,x),x.c=S(t,x),{format:function(e){var t=S(e+="",b);return t.toString=function(){return e},t},parse:function(e){var t=_(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=S(e+="",x);return t.toString=function(){return e},t},utcParse:function(e){var t=_(e+="",!0);return t.toString=function(){return e},t}}}(e),xo.format,xo.parse,wo=xo.utcFormat,So=xo.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Ra="%Y-%m-%dT%H:%M:%S.%LZ";Date.prototype.toISOString||wo(Ra),+new Date("2000-01-01T00:00:00.000Z")||So(Ra);const Va=e=>{const t=Ei().exponent(2).range([0,1]).domain([-1,1]),n=function(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n)),o=new Array(i);++r<i;)o[r]=e+r*n;return o}(0,e).map((t=>t/e-.5));n.push(.5);const r=new Array(2*n.length);return n.forEach(((e,n)=>{r[2*n]=[t(2*e),.5],r[2*n+1]=[t(2*e),-.5]})),r};class qa extends kr{create(){this.updateColor(),this.updateWidth(),this.updateArrow(),this.updateCurveLineGeometry()}initPrograms(){const{reglInstance:e,config:t,store:n,data:r,points:i}=this,{pointsTextureSize:o}=n,a=[];r.completeLinks.forEach((e=>{const t=r.getSortedIndexById(e.target),n=r.getSortedIndexById(e.source),i=n%o,s=Math.floor(n/o),u=t%o,c=Math.floor(t/o);a.push([i,s]),a.push([u,c])}));const s=e.buffer(a);this.drawCurveCommand=e({vert:"precision highp float;\n#define GLSLIFY 1\nattribute vec2 position,pointA,pointB;attribute vec4 color;attribute float width;attribute float arrow;uniform sampler2D positions;uniform sampler2D particleGreyoutStatus;uniform mat3 transform;uniform float pointsTextureSize;uniform float widthScale;uniform float nodeSizeScale;uniform float arrowSizeScale;uniform float spaceSize;uniform vec2 screenSize;uniform float ratio;uniform vec2 linkVisibilityDistanceRange;uniform float linkVisibilityMinTransparency;uniform float greyoutOpacity;uniform bool scaleNodesOnZoom;uniform float curvedWeight;uniform float curvedLinkControlPointDistance;uniform float curvedLinkSegments;varying vec4 rgbaColor;varying vec2 pos;varying float arrowLength;varying float linkWidthArrowWidthRatio;varying float smoothWidthRatio;varying float useArrow;float map(float value,float min1,float max1,float min2,float max2){return min2+(value-min1)*(max2-min2)/(max1-min1);}vec2 conicParametricCurve(vec2 A,vec2 B,vec2 ControlPoint,float t,float w){vec2 divident=(1.0-t)*(1.0-t)*A+2.0*(1.0-t)*t*w*ControlPoint+t*t*B;float divisor=(1.0-t)*(1.0-t)+2.0*(1.0-t)*t*w+t*t;return divident/divisor;}void main(){pos=position;vec2 pointTexturePosA=(pointA+0.5)/pointsTextureSize;vec2 pointTexturePosB=(pointB+0.5)/pointsTextureSize;vec4 greyoutStatusA=texture2D(particleGreyoutStatus,pointTexturePosA);vec4 greyoutStatusB=texture2D(particleGreyoutStatus,pointTexturePosB);vec4 pointPositionA=texture2D(positions,pointTexturePosA);vec4 pointPositionB=texture2D(positions,pointTexturePosB);vec2 a=pointPositionA.xy;vec2 b=pointPositionB.xy;vec2 xBasis=b-a;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));float linkDist=length(xBasis);float h=curvedLinkControlPointDistance;vec2 controlPoint=(a+b)/2.0+yBasis*linkDist*h;float linkDistPx=linkDist*transform[0][0];float linkWidth=width*widthScale;float k=2.0;float arrowWidth=max(5.0,linkWidth*k);arrowWidth*=arrowSizeScale;float arrowWidthPx=arrowWidth/transform[0][0];arrowLength=min(0.3,(0.866*arrowWidthPx*2.0)/linkDist);float smoothWidth=2.0;float arrowExtraWidth=arrowWidth-linkWidth;linkWidth+=smoothWidth/2.0;useArrow=arrow;if(useArrow>0.5){linkWidth+=arrowExtraWidth;}smoothWidthRatio=smoothWidth/linkWidth;linkWidthArrowWidthRatio=arrowExtraWidth/linkWidth;float linkWidthPx=linkWidth/transform[0][0];vec3 rgbColor=color.rgb;float opacity=color.a*max(linkVisibilityMinTransparency,map(linkDistPx,linkVisibilityDistanceRange.g,linkVisibilityDistanceRange.r,0.0,1.0));if(greyoutStatusA.r>0.0||greyoutStatusB.r>0.0){opacity*=greyoutOpacity;}rgbaColor=vec4(rgbColor,opacity);float t=position.x;float w=curvedWeight;float tPrev=t-1.0/curvedLinkSegments;float tNext=t+1.0/curvedLinkSegments;vec2 pointCurr=conicParametricCurve(a,b,controlPoint,t,w);vec2 pointPrev=conicParametricCurve(a,b,controlPoint,max(0.0,tPrev),w);vec2 pointNext=conicParametricCurve(a,b,controlPoint,min(tNext,1.0),w);vec2 xBasisCurved=pointNext-pointPrev;vec2 yBasisCurved=normalize(vec2(-xBasisCurved.y,xBasisCurved.x));pointCurr+=yBasisCurved*linkWidthPx*position.y;vec2 p=2.0*pointCurr/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);gl_Position=vec4(final.rg,0,1);}",frag:"precision highp float;\n#define GLSLIFY 1\nvarying vec4 rgbaColor;varying vec2 pos;varying float arrowLength;varying float linkWidthArrowWidthRatio;varying float smoothWidthRatio;varying float useArrow;float map(float value,float min1,float max1,float min2,float max2){return min2+(value-min1)*(max2-min2)/(max1-min1);}void main(){float opacity=1.0;vec3 color=rgbaColor.rgb;float smoothDelta=smoothWidthRatio/2.0;if(useArrow>0.5){float end_arrow=0.5+arrowLength/2.0;float start_arrow=end_arrow-arrowLength;float arrowWidthDelta=linkWidthArrowWidthRatio/2.0;float linkOpacity=rgbaColor.a*smoothstep(0.5-arrowWidthDelta,0.5-arrowWidthDelta-smoothDelta,abs(pos.y));float arrowOpacity=1.0;if(pos.x>start_arrow&&pos.x<start_arrow+arrowLength){float xmapped=map(pos.x,start_arrow,end_arrow,0.0,1.0);arrowOpacity=rgbaColor.a*smoothstep(xmapped-smoothDelta,xmapped,map(abs(pos.y),0.5,0.0,0.0,1.0));if(linkOpacity!=arrowOpacity){linkOpacity+=arrowOpacity;}}opacity=linkOpacity;}else opacity=rgbaColor.a*smoothstep(0.5,0.5-smoothDelta,abs(pos.y));gl_FragColor=vec4(color,opacity);}",attributes:{position:{buffer:()=>this.curveLineBuffer,divisor:0},pointA:{buffer:()=>s,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},pointB:{buffer:()=>s,divisor:1,offset:2*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},color:{buffer:()=>this.colorBuffer,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT,stride:4*Float32Array.BYTES_PER_ELEMENT},width:{buffer:()=>this.widthBuffer,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT,stride:1*Float32Array.BYTES_PER_ELEMENT},arrow:{buffer:()=>this.arrowBuffer,divisor:1,offset:0*Float32Array.BYTES_PER_ELEMENT,stride:1*Float32Array.BYTES_PER_ELEMENT}},uniforms:{positions:()=>null==i?void 0:i.currentPositionFbo,particleGreyoutStatus:()=>null==i?void 0:i.greyoutStatusFbo,transform:()=>n.transform,pointsTextureSize:()=>n.pointsTextureSize,nodeSizeScale:()=>t.nodeSizeScale,widthScale:()=>t.linkWidthScale,arrowSizeScale:()=>t.linkArrowsSizeScale,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize,ratio:()=>t.pixelRatio,linkVisibilityDistanceRange:()=>t.linkVisibilityDistanceRange,linkVisibilityMinTransparency:()=>t.linkVisibilityMinTransparency,greyoutOpacity:()=>t.linkGreyoutOpacity,scaleNodesOnZoom:()=>t.scaleNodesOnZoom,curvedWeight:()=>t.curvedLinkWeight,curvedLinkControlPointDistance:()=>t.curvedLinkControlPointDistance,curvedLinkSegments:()=>{var e;return t.curvedLinks?null!==(e=t.curvedLinkSegments)&&void 0!==e?e:gr.curvedLinkSegments:1}},cull:{enable:!0,face:"back"},blend:{enable:!0,func:{dstRGB:"one minus src alpha",srcRGB:"src alpha",dstAlpha:"one minus src alpha",srcAlpha:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1},count:()=>{var e,t;return null!==(t=null===(e=this.curveLineGeometry)||void 0===e?void 0:e.length)&&void 0!==t?t:0},instances:()=>r.linksNumber,primitive:"triangle strip"})}draw(){var e;this.colorBuffer&&this.widthBuffer&&this.curveLineBuffer&&(null===(e=this.drawCurveCommand)||void 0===e||e.call(this))}updateColor(){const{reglInstance:e,config:t,data:n}=this,r=[];n.completeLinks.forEach((e=>{var n;const i=Sr(null!==(n=wr(e,t.linkColor))&&void 0!==n?n:vr);r.push(i)})),this.colorBuffer=e.buffer(r)}updateWidth(){const{reglInstance:e,config:t,data:n}=this,r=[];n.completeLinks.forEach((e=>{const n=wr(e,t.linkWidth);r.push([null!=n?n:1])})),this.widthBuffer=e.buffer(r)}updateArrow(){const{reglInstance:e,config:t,data:n}=this,r=[];n.completeLinks.forEach((e=>{var n;const i=null!==(n=wr(e,t.linkArrows))&&void 0!==n?n:gr.arrowLinks;r.push([i?1:0])})),this.arrowBuffer=e.buffer(r)}updateCurveLineGeometry(){const{reglInstance:e,config:{curvedLinks:t,curvedLinkSegments:n}}=this;this.curveLineGeometry=Va(t?null!=n?n:gr.curvedLinkSegments:1),this.curveLineBuffer=e.buffer(this.curveLineGeometry)}destroy(){Cr(this.colorBuffer),Cr(this.widthBuffer),Cr(this.arrowBuffer),Cr(this.curveLineBuffer)}}function Ga(e,t,n){const r=wr(e,t,n);return null!=r?r:mr}class Ua extends kr{constructor(){super(...arguments),this.trackedPositionsById=new Map}create(){var e,t;const{reglInstance:n,store:r,data:i,config:o}=this,{pointsTextureSize:a,adjustedSpaceSize:s}=r;if(!a)return;const u=i.nodes.length,c=new Float32Array(a*a*4);o.disableSimulation||this.rescaleInitialNodePositions();for(let n=0;n<u;++n){const o=this.data.getSortedIndexByInputIndex(n),a=i.nodes[n];a&&void 0!==o&&(c[4*o+0]=null!==(e=a.x)&&void 0!==e?e:s*r.getRandomFloat(.495,.505),c[4*o+1]=null!==(t=a.y)&&void 0!==t?t:s*r.getRandomFloat(.495,.505))}this.currentPositionFbo=n.framebuffer({color:n.texture({data:c,shape:[a,a,4],type:"float"}),depth:!1,stencil:!1}),this.config.disableSimulation||(this.previousPositionFbo=n.framebuffer({color:n.texture({data:c,shape:[a,a,4],type:"float"}),depth:!1,stencil:!1}),this.velocityFbo=n.framebuffer({color:n.texture({data:new Float32Array(a*a*4).fill(0),shape:[a,a,4],type:"float"}),depth:!1,stencil:!1})),this.selectedFbo=n.framebuffer({color:n.texture({data:c,shape:[a,a,4],type:"float"}),depth:!1,stencil:!1}),this.hoveredFbo=n.framebuffer({shape:[2,2],colorType:"float",depth:!1,stencil:!1}),this.updateSize(),this.updateColor(),this.updateGreyoutStatus(),this.updateSampledNodesGrid()}initPrograms(){const{reglInstance:e,config:t,store:n,data:r}=this;t.disableSimulation||(this.updatePositionCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D velocity;uniform float friction;uniform float spaceSize;varying vec2 index;void main(){vec4 pointPosition=texture2D(position,index);vec4 pointVelocity=texture2D(velocity,index);pointVelocity.rg*=friction;pointPosition.rg+=pointVelocity.rg;pointPosition.r=clamp(pointPosition.r,0.0,spaceSize);pointPosition.g=clamp(pointPosition.g,0.0,spaceSize);gl_FragColor=pointPosition;}",vert:Pr,framebuffer:()=>this.currentPositionFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>this.previousPositionFbo,velocity:()=>this.velocityFbo,friction:()=>{var e;return null===(e=t.simulation)||void 0===e?void 0:e.friction},spaceSize:()=>n.adjustedSpaceSize}})),this.drawCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec2 index;varying vec3 rgbColor;varying float alpha;const float smoothing=0.9;void main(){if(alpha==0.0){discard;}float r=0.0;float delta=0.0;vec2 cxy=2.0*gl_PointCoord-1.0;r=dot(cxy,cxy);float opacity=alpha*(1.0-smoothstep(smoothing,1.0,r));gl_FragColor=vec4(rgbColor,opacity);}",vert:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nattribute vec2 indexes;uniform sampler2D positions;uniform sampler2D particleColor;uniform sampler2D particleGreyoutStatus;uniform sampler2D particleSize;uniform float ratio;uniform mat3 transform;uniform float pointsTextureSize;uniform float sizeScale;uniform float spaceSize;uniform vec2 screenSize;uniform float greyoutOpacity;uniform bool scaleNodesOnZoom;uniform float maxPointSize;varying vec2 index;varying vec3 rgbColor;varying float alpha;float pointSize(float size){float pSize;if(scaleNodesOnZoom){pSize=size*ratio*transform[0][0];}else{pSize=size*ratio*min(5.0,max(1.0,transform[0][0]*0.01));}return min(pSize,maxPointSize*ratio);}void main(){index=indexes;vec4 pointPosition=texture2D(positions,(index+0.5)/pointsTextureSize);vec2 point=pointPosition.rg;vec2 p=2.0*point/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);gl_Position=vec4(final.rg,0,1);vec4 pSize=texture2D(particleSize,(index+0.5)/pointsTextureSize);float size=pSize.r*sizeScale;vec4 pColor=texture2D(particleColor,(index+0.5)/pointsTextureSize);rgbColor=pColor.rgb;gl_PointSize=pointSize(size);alpha=pColor.a;vec4 greyoutStatus=texture2D(particleGreyoutStatus,(index+0.5)/pointsTextureSize);if(greyoutStatus.r>0.0){alpha*=greyoutOpacity;}}",primitive:"points",count:()=>r.nodes.length,attributes:{indexes:Tr(e,n.pointsTextureSize)},uniforms:{positions:()=>this.currentPositionFbo,particleColor:()=>this.colorFbo,particleGreyoutStatus:()=>this.greyoutStatusFbo,particleSize:()=>this.sizeFbo,ratio:()=>t.pixelRatio,sizeScale:()=>t.nodeSizeScale,pointsTextureSize:()=>n.pointsTextureSize,transform:()=>n.transform,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize,greyoutOpacity:()=>t.nodeGreyoutOpacity,scaleNodesOnZoom:()=>t.scaleNodesOnZoom,maxPointSize:()=>n.maxPointSize},blend:{enable:!0,func:{dstRGB:"one minus src alpha",srcRGB:"src alpha",dstAlpha:"one minus src alpha",srcAlpha:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1}}),this.findPointsOnAreaSelectionCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D particleSize;uniform float sizeScale;uniform float spaceSize;uniform vec2 screenSize;uniform float ratio;uniform mat3 transform;uniform vec2 selection[2];uniform bool scaleNodesOnZoom;uniform float maxPointSize;varying vec2 index;float pointSize(float size){float pSize;if(scaleNodesOnZoom){pSize=size*ratio*transform[0][0];}else{pSize=size*ratio*min(5.0,max(1.0,transform[0][0]*0.01));}return min(pSize,maxPointSize*ratio);}void main(){vec4 pointPosition=texture2D(position,index);vec2 p=2.0*pointPosition.rg/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);vec4 pSize=texture2D(particleSize,index);float size=pSize.r*sizeScale;float left=2.0*(selection[0].x-0.5*pointSize(size))/screenSize.x-1.0;float right=2.0*(selection[1].x+0.5*pointSize(size))/screenSize.x-1.0;float top=2.0*(selection[0].y-0.5*pointSize(size))/screenSize.y-1.0;float bottom=2.0*(selection[1].y+0.5*pointSize(size))/screenSize.y-1.0;gl_FragColor=vec4(0.0,0.0,pointPosition.rg);if(final.x>=left&&final.x<=right&&final.y>=top&&final.y<=bottom){gl_FragColor.r=1.0;}}",vert:Pr,framebuffer:()=>this.selectedFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>this.currentPositionFbo,particleSize:()=>this.sizeFbo,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize,sizeScale:()=>t.nodeSizeScale,transform:()=>n.transform,ratio:()=>t.pixelRatio,"selection[0]":()=>n.selectedArea[0],"selection[1]":()=>n.selectedArea[1],scaleNodesOnZoom:()=>t.scaleNodesOnZoom,maxPointSize:()=>n.maxPointSize}}),this.clearHoveredFboCommand=e({frag:Ir,vert:Pr,framebuffer:this.hoveredFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)}}),this.findHoveredPointCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec4 rgba;void main(){gl_FragColor=rgba;}",vert:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float pointsTextureSize;uniform sampler2D particleSize;uniform float sizeScale;uniform float spaceSize;uniform vec2 screenSize;uniform float ratio;uniform mat3 transform;uniform vec2 mousePosition;uniform bool scaleNodesOnZoom;uniform float maxPointSize;attribute vec2 indexes;varying vec4 rgba;float pointSize(float size){float pSize;if(scaleNodesOnZoom){pSize=size*ratio*transform[0][0];}else{pSize=size*ratio*min(5.0,max(1.0,transform[0][0]*0.01));}return min(pSize,maxPointSize*ratio);}float euclideanDistance(float x1,float x2,float y1,float y2){return sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));}void main(){vec4 pointPosition=texture2D(position,(indexes+0.5)/pointsTextureSize);vec2 p=2.0*pointPosition.rg/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);vec4 pSize=texture2D(particleSize,indexes/pointsTextureSize);float size=pSize.r*sizeScale;float pointRadius=0.5*pointSize(size);vec2 pointScreenPosition=(final.xy+1.0)*screenSize/2.0;rgba=vec4(0.0);gl_Position=vec4(0.5,0.5,0.0,1.0);if(euclideanDistance(pointScreenPosition.x,mousePosition.x,pointScreenPosition.y,mousePosition.y)<pointRadius/ratio){float index=indexes.g*pointsTextureSize+indexes.r;rgba=vec4(index,pSize.r,pointPosition.xy);gl_Position=vec4(-0.5,-0.5,0.0,1.0);}gl_PointSize=1.0;}",primitive:"points",count:()=>r.nodes.length,framebuffer:()=>this.hoveredFbo,attributes:{indexes:Tr(e,n.pointsTextureSize)},uniforms:{position:()=>this.currentPositionFbo,particleSize:()=>this.sizeFbo,ratio:()=>t.pixelRatio,sizeScale:()=>t.nodeSizeScale,pointsTextureSize:()=>n.pointsTextureSize,transform:()=>n.transform,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize,scaleNodesOnZoom:()=>t.scaleNodesOnZoom,mousePosition:()=>n.screenMousePosition,maxPointSize:()=>n.maxPointSize},depth:{enable:!1,mask:!1}}),this.clearSampledNodesFboCommand=e({frag:Ir,vert:Pr,framebuffer:()=>this.sampledNodesFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)}}),this.fillSampledNodesFboCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nvarying vec4 rgba;void main(){gl_FragColor=rgba;}",vert:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform float pointsTextureSize;uniform float spaceSize;uniform vec2 screenSize;uniform mat3 transform;attribute vec2 indexes;varying vec4 rgba;void main(){vec4 pointPosition=texture2D(position,(indexes+0.5)/pointsTextureSize);vec2 p=2.0*pointPosition.rg/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);vec2 pointScreenPosition=(final.xy+1.0)*screenSize/2.0;float index=indexes.g*pointsTextureSize+indexes.r;rgba=vec4(index,1.0,pointPosition.xy);float i=(pointScreenPosition.x+0.5)/screenSize.x;float j=(pointScreenPosition.y+0.5)/screenSize.y;gl_Position=vec4(2.0*vec2(i,j)-1.0,0.0,1.0);gl_PointSize=1.0;}",primitive:"points",count:()=>r.nodes.length,framebuffer:()=>this.sampledNodesFbo,attributes:{indexes:Tr(e,n.pointsTextureSize)},uniforms:{position:()=>this.currentPositionFbo,pointsTextureSize:()=>n.pointsTextureSize,transform:()=>n.transform,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize},depth:{enable:!1,mask:!1}}),this.drawHighlightedCommand=e({frag:"precision mediump float;\n#define GLSLIFY 1\nuniform vec4 color;uniform float width;varying vec2 pos;varying float particleOpacity;const float smoothing=1.05;void main(){vec2 cxy=pos;float r=dot(cxy,cxy);float opacity=smoothstep(r,r*smoothing,1.0);float stroke=smoothstep(width,width*smoothing,r);gl_FragColor=vec4(color.rgb,opacity*stroke*color.a*particleOpacity);}",vert:"precision mediump float;\n#define GLSLIFY 1\nattribute vec2 quad;uniform sampler2D positions;uniform sampler2D particleColor;uniform sampler2D particleGreyoutStatus;uniform sampler2D particleSize;uniform mat3 transform;uniform float pointsTextureSize;uniform float sizeScale;uniform float spaceSize;uniform vec2 screenSize;uniform bool scaleNodesOnZoom;uniform float pointIndex;uniform float maxPointSize;uniform vec4 color;uniform float greyoutOpacity;varying vec2 pos;varying float particleOpacity;float pointSize(float size){float pSize;if(scaleNodesOnZoom){pSize=size*transform[0][0];}else{pSize=size*min(5.0,max(1.0,transform[0][0]*0.01));}return min(pSize,maxPointSize);}const float relativeRingRadius=1.3;void main(){pos=quad;vec2 ij=vec2(mod(pointIndex,pointsTextureSize),floor(pointIndex/pointsTextureSize))+0.5;vec4 pointPosition=texture2D(positions,ij/pointsTextureSize);vec4 pSize=texture2D(particleSize,ij/pointsTextureSize);vec4 pColor=texture2D(particleColor,ij/pointsTextureSize);particleOpacity=pColor.a;vec4 greyoutStatus=texture2D(particleGreyoutStatus,ij/pointsTextureSize);if(greyoutStatus.r>0.0){particleOpacity*=greyoutOpacity;}float size=(pointSize(pSize.r*sizeScale)*relativeRingRadius)/transform[0][0];float radius=size*0.5;vec2 a=pointPosition.xy;vec2 b=pointPosition.xy+vec2(0.0,radius);vec2 xBasis=b-a;vec2 yBasis=normalize(vec2(-xBasis.y,xBasis.x));vec2 point=a+xBasis*quad.x+yBasis*radius*quad.y;vec2 p=2.0*point/spaceSize-1.0;p*=spaceSize/screenSize;vec3 final=transform*vec3(p,1);gl_Position=vec4(final.rg,0,1);}",attributes:{quad:zr(e)},primitive:"triangle strip",count:4,uniforms:{color:e.prop("color"),width:e.prop("width"),pointIndex:e.prop("pointIndex"),positions:()=>this.currentPositionFbo,particleColor:()=>this.colorFbo,particleSize:()=>this.sizeFbo,sizeScale:()=>t.nodeSizeScale,pointsTextureSize:()=>n.pointsTextureSize,transform:()=>n.transform,spaceSize:()=>n.adjustedSpaceSize,screenSize:()=>n.screenSize,scaleNodesOnZoom:()=>t.scaleNodesOnZoom,maxPointSize:()=>n.maxPointSize,particleGreyoutStatus:()=>this.greyoutStatusFbo,greyoutOpacity:()=>t.nodeGreyoutOpacity},blend:{enable:!0,func:{dstRGB:"one minus src alpha",srcRGB:"src alpha",dstAlpha:"one minus src alpha",srcAlpha:"one"},equation:{rgb:"add",alpha:"add"}},depth:{enable:!1,mask:!1}}),this.trackPointsCommand=e({frag:"#ifdef GL_ES\nprecision highp float;\n#define GLSLIFY 1\n#endif\nuniform sampler2D position;uniform sampler2D trackedIndices;uniform float pointsTextureSize;varying vec2 index;void main(){vec4 trackedPointIndicies=texture2D(trackedIndices,index);if(trackedPointIndicies.r<0.0)discard;vec4 pointPosition=texture2D(position,(trackedPointIndicies.rg+0.5)/pointsTextureSize);gl_FragColor=vec4(pointPosition.rg,1.0,1.0);}",vert:Pr,framebuffer:()=>this.trackedPositionsFbo,primitive:"triangle strip",count:4,attributes:{quad:zr(e)},uniforms:{position:()=>this.currentPositionFbo,trackedIndices:()=>this.trackedIndicesFbo,pointsTextureSize:()=>n.pointsTextureSize}})}updateColor(){const{reglInstance:e,config:t,store:{pointsTextureSize:n},data:r}=this;n&&(this.colorFbo=function(e,t,n,r){var i;if(0===n)return;const o=new Float32Array(n*n*4);for(let t=0;t<e.nodes.length;++t){const n=e.getSortedIndexByInputIndex(t),a=e.nodes[t];if(a&&void 0!==n){const e=Sr(null!==(i=wr(a,r,t))&&void 0!==i?i:pr);o[4*n+0]=e[0],o[4*n+1]=e[1],o[4*n+2]=e[2],o[4*n+3]=e[3]}}const a=t.texture({data:o,width:n,height:n,type:"float"});return t.framebuffer({color:a,depth:!1,stencil:!1})}(r,e,n,t.nodeColor))}updateGreyoutStatus(){const{reglInstance:e,store:t}=this;this.greyoutStatusFbo=function(e,t,n){if(0===n)return;const r=new Float32Array(n*n*4).fill(e?1:0);if(e)for(const t of e)r[4*t]=0;const i=t.texture({data:r,width:n,height:n,type:"float"});return t.framebuffer({color:i,depth:!1,stencil:!1})}(t.selectedIndices,e,t.pointsTextureSize)}updateSize(){const{reglInstance:e,config:t,store:{pointsTextureSize:n},data:r}=this;n&&(this.sizeByIndex=new Float32Array(r.nodes.length),this.sizeFbo=function(e,t,n,r,i){if(0===n)return;const o=e.nodes.length,a=new Float32Array(n*n*4);for(let t=0;t<o;++t){const n=e.getSortedIndexByInputIndex(t),o=e.nodes[t];if(o&&void 0!==n){const e=Ga(o,r,t);a[4*n]=e,i[t]=e}}const s=t.texture({data:a,width:n,height:n,type:"float"});return t.framebuffer({color:s,depth:!1,stencil:!1})}(r,e,n,t.nodeSize,this.sizeByIndex))}updateSampledNodesGrid(){const{store:{screenSize:e},config:{nodeSamplingDistance:t},reglInstance:n}=this,r=null!=t?t:Math.min(...e)/2,i=Math.ceil(e[0]/r),o=Math.ceil(e[1]/r);Mr(this.sampledNodesFbo),this.sampledNodesFbo=n.framebuffer({shape:[i,o],depth:!1,stencil:!1,colorType:"float"})}trackPoints(){var e;this.trackedIndicesFbo&&this.trackedPositionsFbo&&(null===(e=this.trackPointsCommand)||void 0===e||e.call(this))}draw(){var e,t,n;const{config:{renderHoveredNodeRing:r,renderHighlightedNodeRing:i},store:o}=this;null===(e=this.drawCommand)||void 0===e||e.call(this),(null!=r?r:i)&&o.hoveredNode&&(null===(t=this.drawHighlightedCommand)||void 0===t||t.call(this,{width:.85,color:o.hoveredNodeRingColor,pointIndex:o.hoveredNode.index})),o.focusedNode&&(null===(n=this.drawHighlightedCommand)||void 0===n||n.call(this,{width:.75,color:o.focusedNodeRingColor,pointIndex:o.focusedNode.index}))}updatePosition(){var e;null===(e=this.updatePositionCommand)||void 0===e||e.call(this),this.swapFbo()}findPointsOnAreaSelection(){var e;null===(e=this.findPointsOnAreaSelectionCommand)||void 0===e||e.call(this)}findHoveredPoint(){var e,t;null===(e=this.clearHoveredFboCommand)||void 0===e||e.call(this),null===(t=this.findHoveredPointCommand)||void 0===t||t.call(this)}getNodeRadiusByIndex(e){var t;return null===(t=this.sizeByIndex)||void 0===t?void 0:t[e]}trackNodesByIds(e){this.trackedIds=e.length?e:void 0,this.trackedPositionsById.clear();const t=e.map((e=>this.data.getSortedIndexById(e))).filter((e=>void 0!==e));Mr(this.trackedIndicesFbo),this.trackedIndicesFbo=void 0,Mr(this.trackedPositionsFbo),this.trackedPositionsFbo=void 0,t.length&&(this.trackedIndicesFbo=function(e,t,n){const r=Math.ceil(Math.sqrt(e.length));if(0===r)return;const i=new Float32Array(r*r*4).fill(-1);for(const[n,r]of e.entries())void 0!==r&&(i[4*n]=r%t,i[4*n+1]=Math.floor(r/t),i[4*n+2]=0,i[4*n+3]=0);const o=n.texture({data:i,width:r,height:r,type:"float"});return n.framebuffer({color:o,depth:!1,stencil:!1})}(t,this.store.pointsTextureSize,this.reglInstance),this.trackedPositionsFbo=function(e,t){const n=Math.ceil(Math.sqrt(e.length));return t.framebuffer({shape:[n,n],depth:!1,stencil:!1,colorType:"float"})}(t,this.reglInstance)),this.trackPoints()}getTrackedPositions(){if(!this.trackedIds)return this.trackedPositionsById;const e=_r(this.reglInstance,this.trackedPositionsFbo);return this.trackedIds.forEach(((t,n)=>{const r=e[4*n],i=e[4*n+1];void 0!==r&&void 0!==i&&this.trackedPositionsById.set(t,[r,i])})),this.trackedPositionsById}getSampledNodePositionsMap(){var e,t,n;const r=new Map;if(!this.sampledNodesFbo)return r;null===(e=this.clearSampledNodesFboCommand)||void 0===e||e.call(this),null===(t=this.fillSampledNodesFboCommand)||void 0===t||t.call(this);const i=_r(this.reglInstance,this.sampledNodesFbo);for(let e=0;e<i.length/4;e++){const t=i[4*e],o=!!i[4*e+1],a=i[4*e+2],s=i[4*e+3];if(o&&void 0!==t&&void 0!==a&&void 0!==s){const e=this.data.getInputIndexBySortedIndex(t);if(void 0!==e){const t=null===(n=this.data.getNodeByIndex(e))||void 0===n?void 0:n.id;void 0!==t&&r.set(t,[a,s])}}}return r}destroy(){Mr(this.currentPositionFbo),Mr(this.previousPositionFbo),Mr(this.velocityFbo),Mr(this.selectedFbo),Mr(this.colorFbo),Mr(this.sizeFbo),Mr(this.greyoutStatusFbo),Mr(this.hoveredFbo),Mr(this.trackedIndicesFbo),Mr(this.trackedPositionsFbo)}swapFbo(){const e=this.previousPositionFbo;this.previousPositionFbo=this.currentPositionFbo,this.currentPositionFbo=e}rescaleInitialNodePositions(){const{nodes:e}=this.data,{spaceSize:t}=this.config;if(0===e.length)return;const n=e.map((e=>e.x)).filter((e=>void 0!==e));if(0===n.length)return;const r=e.map((e=>e.y)).filter((e=>void 0!==e));if(0===r.length)return;const[i,o]=Qr(n);if(void 0===i||void 0===o)return;const[a,s]=Qr(r);if(void 0===a||void 0===s)return;const u=o-i,c=s-a,l=Math.max(u,c),f=(l-u)/2,h=(l-c)/2,d=Mi().range([0,null!=t?t:gr.spaceSize]).domain([i-f,o+f]),p=Mi().range([0,null!=t?t:gr.spaceSize]).domain([a-h,s+h]);e.forEach((e=>{e.x=d(e.x),e.y=p(e.y)}))}}var Ha="undefined"!=typeof Float32Array?Float32Array:Array;function Ya(){var e=new Ha(9);return Ha!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Wa(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],c=t[6],l=t[7],f=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=h*r+d*a+c,e[7]=h*i+d*s+l,e[8]=h*o+d*u+f,e}function $a(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Za(){var e=new Ha(3);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Xa(e,t,n){var r=new Ha(3);return r[0]=e,r[1]=t,r[2]=n,r}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});function Qa(){var e=new Ha(4);return Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Za(),function(){var e,t=(e=new Ha(4),Ha!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();Za(),Xa(1,0,0),Xa(0,1,0),Qa(),Qa(),Ya(),function(){var e,t=(e=new Ha(2),Ha!=Float32Array&&(e[0]=0,e[1]=0),e)}();var Ja={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n=function(){var e=4022871197,t=function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)};return t}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.alea=o}(0,e,!1)}(Ja);var Ka={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xor128=o}(0,e,!1)}(Ka);var es={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xorwow=o}(0,e,!1)}(es);var ts={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.x&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xorshift7=o}(0,e,!1)}(ts);var ns={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,a,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=a,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.X&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.xor4096=o}(0,e,!1)}(ns);var rs={exports:{}};!function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n((function(){return o})):this.tychei=o}(0,e,!1)}(rs);var is={exports:{}};!function(e){!function(t,n,r){var i,o=256,a="random",s=r.pow(o,6),u=r.pow(2,52),c=2*u,l=o-1;function f(e,l,f){var g=[],y=m(p((l=1==l?{entropy:!0}:l||{}).entropy?[e,v(n)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(o):(e=new Uint8Array(o),(t.crypto||t.msCrypto).getRandomValues(e)),v(e)}catch(e){var r=t.navigator,a=r&&r.plugins;return[+new Date,t,a,t.screen,v(n)]}}():e,3),g),b=new h(g),x=function(){for(var e=b.g(6),t=s,n=0;e<u;)e=(e+n)*o,t*=o,n=b.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return x.int32=function(){return 0|b.g(4)},x.quick=function(){return b.g(4)/4294967296},x.double=x,m(v(b.S),n),(l.pass||f||function(e,t,n,i){return i&&(i.S&&d(i,b),e.state=function(){return d(b,{})}),n?(r[a]=e,t):e})(x,y,"global"in l?l.global:this==r,l.state)}function h(e){var t,n=e.length,r=this,i=0,a=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<o;)s[i]=i++;for(i=0;i<o;i++)s[i]=s[a=l&a+e[i%n]+(t=s[i])],s[a]=t;(r.g=function(e){for(var t,n=0,i=r.i,a=r.j,s=r.S;e--;)t=s[i=l&i+1],n=n*o+s[l&(s[i]=s[a=l&a+t])+(s[a]=t)];return r.i=i,r.j=a,n})(o)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){var n,r=[],i=typeof e;if(t&&"object"==i)for(n in e)try{r.push(p(e[n],t-1))}catch(e){}return r.length?r:"string"==i?e:e+"\0"}function m(e,t){for(var n,r=e+"",i=0;i<r.length;)t[l&i]=l&(n^=19*t[l&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(m(r.random(),n),e.exports){e.exports=f;try{i=require("crypto")}catch(e){}}else r["seed"+a]=f}("undefined"!=typeof self?self:fr,[],Math)}(is);var os=Ja.exports,as=Ka.exports,ss=es.exports,us=ts.exports,cs=ns.exports,ls=rs.exports,fs=is.exports;fs.alea=os,fs.xor128=as,fs.xorwow=ss,fs.xorshift7=us,fs.xor4096=cs,fs.tychei=ls;var hs=fs;function ds(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,(i=r.key,o=void 0,"symbol"==typeof(o=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(i,"string"))?o:String(o)),r)}var i,o}function ps(e,t,n){return t&&ds(e.prototype,t),n&&ds(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function ms(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,vs(e,t)}function vs(e,t){return vs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vs(e,t)}var gs=function(){function e(){}return e.prototype._seed=function(e,t){if(e===(e||0))return e;for(var n=""+e,r=0,i=0;i<n.length;++i)r^=0|n.charCodeAt(i);return r},e}(),ys=function(e){function t(t,n){var r;return(r=e.call(this)||this)._rng=void 0,r.seed(t,n),r}ms(t,e);var n=t.prototype;return n.next=function(){return this._rng()},n.seed=function(e,t){this._rng=e},n.clone=function(e,n){return new t(this._rng,n)},ps(t,[{key:"name",get:function(){return"function"}}]),t}(gs),bs=function(){var e=[].slice.call(arguments),t=e[0],n=void 0===t?"default":t;switch(typeof n){case"object":if(n instanceof gs)return n;break;case"function":return new ys(n);default:return new ys(hs.apply(void 0,e))}throw new Error('invalid RNG "'+n+'"')},xs=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),function(){return e.next()*(n-t)+t}};function ws(e){return new Ss(e)}var Ss=function(e){var t=this;this.n=void 0,this.isInt=function(){if(Number.isInteger(t.n))return t;throw new Error("Expected number to be an integer, got "+t.n)},this.isPositive=function(){if(t.n>0)return t;throw new Error("Expected number to be positive, got "+t.n)},this.lessThan=function(e){if(t.n<e)return t;throw new Error("Expected number to be less than "+e+", got "+t.n)},this.greaterThanOrEqual=function(e){if(t.n>=e)return t;throw new Error("Expected number to be greater than or equal to "+e+", got "+t.n)},this.greaterThan=function(e){if(t.n>e)return t;throw new Error("Expected number to be greater than "+e+", got "+t.n)},this.n=e},_s=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),void 0===n&&(n=void 0===t?1:t,t=0),ws(t).isInt(),ws(n).isInt(),function(){return Math.floor(e.next()*(n-t+1)+t)}},As=function(e){return function(){return e.next()>=.5}},ks=[0,0,.6931471805599453,1.791759469228055,3.1780538303479458,4.787491742782046,6.579251212010101,8.525161361065415,10.60460290274525,12.801827480081469],zs=function(e){return ks[e]},Ts=function(e){function t(){return e.apply(this,arguments)||this}ms(t,e);var n=t.prototype;return n.next=function(){return Math.random()},n.seed=function(e,t){},n.clone=function(){return new t},ps(t,[{key:"name",get:function(){return"default"}}]),t}(gs),Ms=function(){function e(e){var t=this;this._rng=void 0,this._patch=void 0,this._cache={},this.next=function(){return t._rng.next()},this.float=function(e,n){return t.uniform(e,n)()},this.int=function(e,n){return t.uniformInt(e,n)()},this.integer=function(e,n){return t.uniformInt(e,n)()},this.bool=function(){return t.uniformBoolean()()},this.boolean=function(){return t.uniformBoolean()()},this.uniform=function(e,n){return t._memoize("uniform",xs,e,n)},this.uniformInt=function(e,n){return t._memoize("uniformInt",_s,e,n)},this.uniformBoolean=function(){return t._memoize("uniformBoolean",As)},this.normal=function(e,n){return function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),function(){var r,i,o;do{o=(r=2*e.next()-1)*r+(i=2*e.next()-1)*i}while(!o||o>1);return t+n*i*Math.sqrt(-2*Math.log(o)/o)}}(t,e,n)},this.logNormal=function(e,n){return function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=1);var r=e.normal(t,n);return function(){return Math.exp(r())}}(t,e,n)},this.bernoulli=function(e){return function(e,t){return void 0===t&&(t=.5),ws(t).greaterThanOrEqual(0).lessThan(1),function(){return Math.floor(e.next()+t)}}(t,e)},this.binomial=function(e,n){return function(e,t,n){return void 0===t&&(t=1),void 0===n&&(n=.5),ws(t).isInt().isPositive(),ws(n).greaterThanOrEqual(0).lessThan(1),function(){for(var r=0,i=0;r++<t;)e.next()<n&&i++;return i}}(t,e,n)},this.geometric=function(e){return function(e,t){void 0===t&&(t=.5),ws(t).greaterThan(0).lessThan(1);var n=1/Math.log(1-t);return function(){return Math.floor(1+Math.log(e.next())*n)}}(t,e)},this.poisson=function(e){return function(e,t){if(void 0===t&&(t=1),ws(t).isPositive(),t<10){var n=Math.exp(-t);return function(){for(var r=n,i=0,o=e.next();o>r;)o-=r,r=t*r/++i;return i}}var r=Math.sqrt(t),i=.931+2.53*r,o=.02483*i-.059,a=1.1239+1.1328/(i-3.4),s=.9277-3.6224/(i-2);return function(){for(;;){var n=void 0,u=e.next();if(u<=.86*s)return n=u/s-.43,Math.floor((2*o/(.5-Math.abs(n))+i)*n+t+.445);u>=s?n=e.next()-.5:(n=((n=u/s-.93)<0?-.5:.5)-n,u=e.next()*s);var c=.5-Math.abs(n);if(!(c<.013&&u>c)){var l=Math.floor((2*o/c+i)*n+t+.445);if(u=u*a/(o/(c*c)+i),l>=10){var f=(l+.5)*Math.log(t/l)-t-.9189385332046727+l-(1/12-(1/360-1/(1260*l*l))/(l*l))/l;if(Math.log(u*r)<=f)return l}else if(l>=0){var h,d=null!=(h=zs(l))?h:0;if(Math.log(u)<=l*Math.log(t)-t-d)return l}}}}}(t,e)},this.exponential=function(e){return function(e,t){return void 0===t&&(t=1),ws(t).isPositive(),function(){return-Math.log(1-e.next())/t}}(t,e)},this.irwinHall=function(e){return function(e,t){return void 0===t&&(t=1),ws(t).isInt().greaterThanOrEqual(0),function(){for(var n=0,r=0;r<t;++r)n+=e.next();return n}}(t,e)},this.bates=function(e){return function(e,t){void 0===t&&(t=1),ws(t).isInt().isPositive();var n=e.irwinHall(t);return function(){return n()/t}}(t,e)},this.pareto=function(e){return function(e,t){void 0===t&&(t=1),ws(t).greaterThanOrEqual(0);var n=1/t;return function(){return 1/Math.pow(1-e.next(),n)}}(t,e)},e&&e instanceof gs?this.use(e):this.use(new Ts),this._cache={}}var t=e.prototype;return t.clone=function(){var t=[].slice.call(arguments);return t.length?new e(bs.apply(void 0,t)):new e(this.rng.clone())},t.use=function(){this._rng=bs.apply(void 0,[].slice.call(arguments))},t.patch=function(){if(this._patch)throw new Error("Math.random already patched");this._patch=Math.random,Math.random=this.uniform()},t.unpatch=function(){this._patch&&(Math.random=this._patch,delete this._patch)},t.choice=function(e){if(!Array.isArray(e))throw new Error("Random.choice expected input to be an array, got "+typeof e);var t=null==e?void 0:e.length;return t>0?e[this.uniformInt(0,t-1)()]:void 0},t._memoize=function(e,t){var n=[].slice.call(arguments,2),r=""+n.join(";"),i=this._cache[e];return void 0!==i&&i.key===r||(i={key:r,distribution:t.apply(void 0,[this].concat(n))},this._cache[e]=i),i.distribution},ps(e,[{key:"rng",get:function(){return this._rng}}]),e}();new Ms;const Cs=.001;class Is{constructor(){this.pointsTextureSize=0,this.linksTextureSize=0,this.alpha=1,this.transform=Ya(),this.backgroundColor=[0,0,0,0],this.screenSize=[0,0],this.mousePosition=[0,0],this.screenMousePosition=[0,0],this.selectedArea=[[0,0],[0,0]],this.isSimulationRunning=!1,this.simulationProgress=0,this.selectedIndices=null,this.maxPointSize=64,this.hoveredNode=void 0,this.focusedNode=void 0,this.adjustedSpaceSize=gr.spaceSize,this.hoveredNodeRingColor=[1,1,1,.7],this.focusedNodeRingColor=[1,1,1,.95],this.alphaTarget=0,this.scaleNodeX=Mi(),this.scaleNodeY=Mi(),this.random=new Ms,this.alphaDecay=e=>1-Math.pow(Cs,1/e)}addRandomSeed(e){this.random=this.random.clone(e)}getRandomFloat(e,t){return this.random.float(e,t)}adjustSpaceSize(e,t){e>=t?(this.adjustedSpaceSize=t/2,console.warn(`The \`spaceSize\` has been reduced to ${this.adjustedSpaceSize} due to WebGL limits`)):this.adjustedSpaceSize=e}updateScreenSize(e,t){const{adjustedSpaceSize:n}=this;this.screenSize=[e,t],this.scaleNodeX.domain([0,n]).range([(e-n)/2,(e+n)/2]),this.scaleNodeY.domain([n,0]).range([(t-n)/2,(t+n)/2])}scaleX(e){return this.scaleNodeX(e)}scaleY(e){return this.scaleNodeY(e)}setHoveredNodeRingColor(e){const t=Sr(e);this.hoveredNodeRingColor[0]=t[0],this.hoveredNodeRingColor[1]=t[1],this.hoveredNodeRingColor[2]=t[2]}setFocusedNodeRingColor(e){const t=Sr(e);this.focusedNodeRingColor[0]=t[0],this.focusedNodeRingColor[1]=t[1],this.focusedNodeRingColor[2]=t[2]}setFocusedNode(e,t){this.focusedNode=e&&void 0!==t?{node:e,index:t}:void 0}addAlpha(e){return(this.alphaTarget-this.alpha)*this.alphaDecay(e)}}var Ps="http://www.w3.org/1999/xhtml",Fs={svg:"http://www.w3.org/2000/svg",xhtml:Ps,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Es(e){var t=e+="",n=t.indexOf(":");return n>=0&&"xmlns"!==(t=e.slice(0,n))&&(e=e.slice(n+1)),Fs.hasOwnProperty(t)?{space:Fs[t],local:e}:e}function Ds(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===Ps&&t.documentElement.namespaceURI===Ps?t.createElement(e):t.createElementNS(n,e)}}function Ns(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function Os(e){var t=Es(e);return(t.local?Ns:Ds)(t)}function Ls(){}function js(e){return null==e?Ls:function(){return this.querySelector(e)}}function Bs(e){return"object"==typeof e&&"length"in e?e:Array.from(e)}function Rs(){return[]}function Vs(e){return function(t){return t.matches(e)}}var qs=Array.prototype.find;function Gs(){return this.firstElementChild}var Us=Array.prototype.filter;function Hs(){return this.children}function Ys(e){return new Array(e.length)}function Ws(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}function $s(e,t,n,r,i,o){for(var a,s=0,u=t.length,c=o.length;s<c;++s)(a=t[s])?(a.__data__=o[s],r[s]=a):n[s]=new Ws(e,o[s]);for(;s<u;++s)(a=t[s])&&(i[s]=a)}function Zs(e,t,n,r,i,o,a){var s,u,c,l=new Map,f=t.length,h=o.length,d=new Array(f);for(s=0;s<f;++s)(u=t[s])&&(d[s]=c=a.call(u,u.__data__,s,t)+"",l.has(c)?i[s]=u:l.set(c,u));for(s=0;s<h;++s)c=a.call(e,o[s],s,o)+"",(u=l.get(c))?(r[s]=u,u.__data__=o[s],l.delete(c)):n[s]=new Ws(e,o[s]);for(s=0;s<f;++s)(u=t[s])&&l.get(d[s])===u&&(i[s]=u)}function Xs(e){return e.__data__}function Qs(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Js(e){return function(){this.removeAttribute(e)}}function Ks(e){return function(){this.removeAttributeNS(e.space,e.local)}}function eu(e,t){return function(){this.setAttribute(e,t)}}function tu(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function nu(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}}function ru(e,t){return function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function iu(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function ou(e){return function(){this.style.removeProperty(e)}}function au(e,t,n){return function(){this.style.setProperty(e,t,n)}}function su(e,t,n){return function(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}}function uu(e){return function(){delete this[e]}}function cu(e,t){return function(){this[e]=t}}function lu(e,t){return function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}}function fu(e){return e.trim().split(/^|\s+/)}function hu(e){return e.classList||new du(e)}function du(e){this._node=e,this._names=fu(e.getAttribute("class")||"")}function pu(e,t){for(var n=hu(e),r=-1,i=t.length;++r<i;)n.add(t[r])}function mu(e,t){for(var n=hu(e),r=-1,i=t.length;++r<i;)n.remove(t[r])}function vu(e){return function(){pu(this,e)}}function gu(e){return function(){mu(this,e)}}function yu(e,t){return function(){(t.apply(this,arguments)?pu:mu)(this,e)}}function bu(){this.textContent=""}function xu(e){return function(){this.textContent=e}}function wu(e){return function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}}function Su(){this.innerHTML=""}function _u(e){return function(){this.innerHTML=e}}function Au(e){return function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}}function ku(){this.nextSibling&&this.parentNode.appendChild(this)}function zu(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function Tu(){return null}function Mu(){var e=this.parentNode;e&&e.removeChild(this)}function Cu(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Iu(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Pu(e){return function(){var t=this.__on;if(t){for(var n,r=0,i=-1,o=t.length;r<o;++r)n=t[r],e.type&&n.type!==e.type||n.name!==e.name?t[++i]=n:this.removeEventListener(n.type,n.listener,n.options);++i?t.length=i:delete this.__on}}}function Fu(e,t,n){return function(){var r,i=this.__on,o=function(e){return function(t){e.call(this,t,this.__data__)}}(t);if(i)for(var a=0,s=i.length;a<s;++a)if((r=i[a]).type===e.type&&r.name===e.name)return this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=o,r.options=n),void(r.value=t);this.addEventListener(e.type,o,n),r={type:e.type,name:e.name,value:t,listener:o,options:n},i?i.push(r):this.__on=[r]}}function Eu(e,t,n){var r=iu(e),i=r.CustomEvent;"function"==typeof i?i=new i(t,n):(i=r.document.createEvent("Event"),n?(i.initEvent(t,n.bubbles,n.cancelable),i.detail=n.detail):i.initEvent(t,!1,!1)),e.dispatchEvent(i)}function Du(e,t){return function(){return Eu(this,e,t)}}function Nu(e,t){return function(){return Eu(this,e,t.apply(this,arguments))}}Ws.prototype={constructor:Ws,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}},du.prototype={add:function(e){this._names.indexOf(e)<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};var Ou=[null];function Lu(e,t){this._groups=e,this._parents=t}function ju(e){return"string"==typeof e?new Lu([[document.querySelector(e)]],[document.documentElement]):new Lu([[e]],Ou)}Lu.prototype={constructor:Lu,select:function(e){"function"!=typeof e&&(e=js(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,a,s=t[i],u=s.length,c=r[i]=new Array(u),l=0;l<u;++l)(o=s[l])&&(a=e.call(o,o.__data__,l,s))&&("__data__"in o&&(a.__data__=o.__data__),c[l]=a);return new Lu(r,this._parents)},selectAll:function(e){e="function"==typeof e?function(e){return function(){var t=e.apply(this,arguments);return null==t?[]:Bs(t)}}(e):function(e){return null==e?Rs:function(){return this.querySelectorAll(e)}}(e);for(var t=this._groups,n=t.length,r=[],i=[],o=0;o<n;++o)for(var a,s=t[o],u=s.length,c=0;c<u;++c)(a=s[c])&&(r.push(e.call(a,a.__data__,c,s)),i.push(a));return new Lu(r,i)},selectChild:function(e){return this.select(null==e?Gs:function(e){return function(){return qs.call(this.children,e)}}("function"==typeof e?e:Vs(e)))},selectChildren:function(e){return this.selectAll(null==e?Hs:function(e){return function(){return Us.call(this.children,e)}}("function"==typeof e?e:Vs(e)))},filter:function(e){"function"!=typeof e&&(e=function(e){return function(){return this.matches(e)}}(e));for(var t=this._groups,n=t.length,r=new Array(n),i=0;i<n;++i)for(var o,a=t[i],s=a.length,u=r[i]=[],c=0;c<s;++c)(o=a[c])&&e.call(o,o.__data__,c,a)&&u.push(o);return new Lu(r,this._parents)},data:function(e,t){if(!arguments.length)return Array.from(this,Xs);var n,r=t?Zs:$s,i=this._parents,o=this._groups;"function"!=typeof e&&(n=e,e=function(){return n});for(var a=o.length,s=new Array(a),u=new Array(a),c=new Array(a),l=0;l<a;++l){var f=i[l],h=o[l],d=h.length,p=Bs(e.call(f,f&&f.__data__,l,i)),m=p.length,v=u[l]=new Array(m),g=s[l]=new Array(m);r(f,h,v,g,c[l]=new Array(d),p,t);for(var y,b,x=0,w=0;x<m;++x)if(y=v[x]){for(x>=w&&(w=x+1);!(b=g[w])&&++w<m;);y._next=b||null}}return(s=new Lu(s,i))._enter=u,s._exit=c,s},enter:function(){return new Lu(this._enter||this._groups.map(Ys),this._parents)},exit:function(){return new Lu(this._exit||this._groups.map(Ys),this._parents)},join:function(e,t,n){var r=this.enter(),i=this,o=this.exit();return r="function"==typeof e?e(r):r.append(e+""),null!=t&&(i=t(i)),null==n?o.remove():n(o),r&&i?r.merge(i).order():i},merge:function(e){if(!(e instanceof Lu))throw new Error("invalid merge");for(var t=this._groups,n=e._groups,r=t.length,i=n.length,o=Math.min(r,i),a=new Array(r),s=0;s<o;++s)for(var u,c=t[s],l=n[s],f=c.length,h=a[s]=new Array(f),d=0;d<f;++d)(u=c[d]||l[d])&&(h[d]=u);for(;s<r;++s)a[s]=t[s];return new Lu(a,this._parents)},selection:function(){return this},order:function(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var r,i=e[t],o=i.length-1,a=i[o];--o>=0;)(r=i[o])&&(a&&4^r.compareDocumentPosition(a)&&a.parentNode.insertBefore(r,a),a=r);return this},sort:function(e){function t(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}e||(e=Qs);for(var n=this._groups,r=n.length,i=new Array(r),o=0;o<r;++o){for(var a,s=n[o],u=s.length,c=i[o]=new Array(u),l=0;l<u;++l)(a=s[l])&&(c[l]=a);c.sort(t)}return new Lu(i,this._parents).order()},call:function(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r=e[t],i=0,o=r.length;i<o;++i){var a=r[i];if(a)return a}return null},size:function(){let e=0;for(const t of this)++e;return e},empty:function(){return!this.node()},each:function(e){for(var t=this._groups,n=0,r=t.length;n<r;++n)for(var i,o=t[n],a=0,s=o.length;a<s;++a)(i=o[a])&&e.call(i,i.__data__,a,o);return this},attr:function(e,t){var n=Es(e);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((null==t?n.local?Ks:Js:"function"==typeof t?n.local?ru:nu:n.local?tu:eu)(n,t))},style:function(e,t,n){return arguments.length>1?this.each((null==t?ou:"function"==typeof t?su:au)(e,t,null==n?"":n)):function(e,t){return e.style.getPropertyValue(t)||iu(e).getComputedStyle(e,null).getPropertyValue(t)}(this.node(),e)},property:function(e,t){return arguments.length>1?this.each((null==t?uu:"function"==typeof t?lu:cu)(e,t)):this.node()[e]},classed:function(e,t){var n=fu(e+"");if(arguments.length<2){for(var r=hu(this.node()),i=-1,o=n.length;++i<o;)if(!r.contains(n[i]))return!1;return!0}return this.each(("function"==typeof t?yu:t?vu:gu)(n,t))},text:function(e){return arguments.length?this.each(null==e?bu:("function"==typeof e?wu:xu)(e)):this.node().textContent},html:function(e){return arguments.length?this.each(null==e?Su:("function"==typeof e?Au:_u)(e)):this.node().innerHTML},raise:function(){return this.each(ku)},lower:function(){return this.each(zu)},append:function(e){var t="function"==typeof e?e:Os(e);return this.select((function(){return this.appendChild(t.apply(this,arguments))}))},insert:function(e,t){var n="function"==typeof e?e:Os(e),r=null==t?Tu:"function"==typeof t?t:js(t);return this.select((function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)}))},remove:function(){return this.each(Mu)},clone:function(e){return this.select(e?Iu:Cu)},datum:function(e){return arguments.length?this.property("__data__",e):this.node().__data__},on:function(e,t,n){var r,i,o=function(e){return e.trim().split(/^|\s+/).map((function(e){var t="",n=e.indexOf(".");return n>=0&&(t=e.slice(n+1),e=e.slice(0,n)),{type:e,name:t}}))}(e+""),a=o.length;if(!(arguments.length<2)){for(s=t?Fu:Pu,r=0;r<a;++r)this.each(s(o[r],t,n));return this}var s=this.node().__on;if(s)for(var u,c=0,l=s.length;c<l;++c)for(r=0,u=s[c];r<a;++r)if((i=o[r]).type===u.type&&i.name===u.name)return u.value},dispatch:function(e,t){return this.each(("function"==typeof t?Nu:Du)(e,t))},[Symbol.iterator]:function*(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var r,i=e[t],o=0,a=i.length;o<a;++o)(r=i[o])&&(yield r)}};var Bu=0;function Ru(){this._="@"+(++Bu).toString(36)}function Vu(e){e.preventDefault(),e.stopImmediatePropagation()}Ru.prototype={constructor:Ru,get:function(e){for(var t=this._;!(t in e);)if(!(e=e.parentNode))return;return e[t]},set:function(e,t){return e[this._]=t},remove:function(e){return this._ in e&&delete e[this._]},toString:function(){return this._}};var qu=e=>()=>e;function Gu(e,{sourceEvent:t,target:n,transform:r,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:t,enumerable:!0,configurable:!0},target:{value:n,enumerable:!0,configurable:!0},transform:{value:r,enumerable:!0,configurable:!0},_:{value:i}})}function Uu(e,t,n){this.k=e,this.x=t,this.y=n}Uu.prototype={constructor:Uu,scale:function(e){return 1===e?this:new Uu(this.k*e,this.x,this.y)},translate:function(e,t){return 0===e&0===t?this:new Uu(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Hu=new Uu(1,0,0);function Yu(e){e.stopImmediatePropagation()}function Wu(e){e.preventDefault(),e.stopImmediatePropagation()}function $u(e){return!(e.ctrlKey&&"wheel"!==e.type||e.button)}function Zu(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e).hasAttribute("viewBox")?[[(e=e.viewBox.baseVal).x,e.y],[e.x+e.width,e.y+e.height]]:[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]:[[0,0],[e.clientWidth,e.clientHeight]]}function Xu(){return this.__zoom||Hu}function Qu(e){return-e.deltaY*(1===e.deltaMode?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function Ju(){return navigator.maxTouchPoints||"ontouchstart"in this}function Ku(e,t,n){var r=e.invertX(t[0][0])-n[0][0],i=e.invertX(t[1][0])-n[1][0],o=e.invertY(t[0][1])-n[0][1],a=e.invertY(t[1][1])-n[1][1];return e.translate(i>r?(r+i)/2:Math.min(0,r)||Math.max(0,i),a>o?(o+a)/2:Math.min(0,o)||Math.max(0,a))}function ec(){var e,t,n,r=$u,i=Zu,o=Ku,a=Qu,s=Ju,u=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],l=250,f=En,h=ye("start","zoom","end"),d=500,p=150,m=0,v=10;function g(e){e.property("__zoom",Xu).on("wheel.zoom",A,{passive:!1}).on("mousedown.zoom",k).on("dblclick.zoom",z).filter(s).on("touchstart.zoom",T).on("touchmove.zoom",M).on("touchend.zoom touchcancel.zoom",C).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(e,t){return(t=Math.max(u[0],Math.min(u[1],t)))===e.k?e:new Uu(t,e.x,e.y)}function b(e,t,n){var r=t[0]-n[0]*e.k,i=t[1]-n[1]*e.k;return r===e.x&&i===e.y?e:new Uu(e.k,r,i)}function x(e){return[(+e[0][0]+ +e[1][0])/2,(+e[0][1]+ +e[1][1])/2]}function w(e,t,n,r){e.on("start.zoom",(function(){S(this,arguments).event(r).start()})).on("interrupt.zoom end.zoom",(function(){S(this,arguments).event(r).end()})).tween("zoom",(function(){var e=this,o=arguments,a=S(e,o).event(r),s=i.apply(e,o),u=null==n?x(s):"function"==typeof n?n.apply(e,o):n,c=Math.max(s[1][0]-s[0][0],s[1][1]-s[0][1]),l=e.__zoom,h="function"==typeof t?t.apply(e,o):t,d=f(l.invert(u).concat(c/l.k),h.invert(u).concat(c/h.k));return function(e){if(1===e)e=h;else{var t=d(e),n=c/t[2];e=new Uu(n,u[0]-t[0]*n,u[1]-t[1]*n)}a.zoom(null,e)}}))}function S(e,t,n){return!n&&e.__zooming||new _(e,t)}function _(e,t){this.that=e,this.args=t,this.active=0,this.sourceEvent=null,this.extent=i.apply(e,t),this.taps=0}function A(e,...t){if(r.apply(this,arguments)){var n=S(this,t).event(e),i=this.__zoom,s=Math.max(u[0],Math.min(u[1],i.k*Math.pow(2,a.apply(this,arguments)))),l=ve(e);if(n.wheel)n.mouse[0][0]===l[0]&&n.mouse[0][1]===l[1]||(n.mouse[1]=i.invert(n.mouse[0]=l)),clearTimeout(n.wheel);else{if(i.k===s)return;n.mouse=[l,i.invert(l)],et(this),n.start()}Wu(e),n.wheel=setTimeout((function(){n.wheel=null,n.end()}),p),n.zoom("mouse",o(b(y(i,s),n.mouse[0],n.mouse[1]),n.extent,c))}}function k(e,...t){if(!n&&r.apply(this,arguments)){var i=e.currentTarget,a=S(this,t,!0).event(e),s=de(e.view).on("mousemove.zoom",(function(e){if(Wu(e),!a.moved){var t=e.clientX-l,n=e.clientY-f;a.moved=t*t+n*n>m}a.event(e).zoom("mouse",o(b(a.that.__zoom,a.mouse[0]=ve(e,i),a.mouse[1]),a.extent,c))}),!0).on("mouseup.zoom",(function(e){s.on("mousemove.zoom mouseup.zoom",null),function(e,t){var n=e.document.documentElement,r=ju(e).on("dragstart.drag",null);t&&(r.on("click.drag",Vu,!0),setTimeout((function(){r.on("click.drag",null)}),0)),"onselectstart"in n?r.on("selectstart.drag",null):(n.style.MozUserSelect=n.__noselect,delete n.__noselect)}(e.view,a.moved),Wu(e),a.event(e).end()}),!0),u=ve(e,i),l=e.clientX,f=e.clientY;!function(e){var t=e.document.documentElement,n=ju(e).on("dragstart.drag",Vu,!0);"onselectstart"in t?n.on("selectstart.drag",Vu,!0):(t.__noselect=t.style.MozUserSelect,t.style.MozUserSelect="none")}(e.view),Yu(e),a.mouse=[u,this.__zoom.invert(u)],et(this),a.start()}}function z(e,...t){if(r.apply(this,arguments)){var n=this.__zoom,a=ve(e.changedTouches?e.changedTouches[0]:e,this),s=n.invert(a),u=n.k*(e.shiftKey?.5:2),f=o(b(y(n,u),a,s),i.apply(this,t),c);Wu(e),l>0?de(this).transition().duration(l).call(w,f,a,e):de(this).call(g.transform,f,a,e)}}function T(n,...i){if(r.apply(this,arguments)){var o,a,s,u,c=n.touches,l=c.length,f=S(this,i,n.changedTouches.length===l).event(n);for(Yu(n),a=0;a<l;++a)u=[u=ve(s=c[a],this),this.__zoom.invert(u),s.identifier],f.touch0?f.touch1||f.touch0[2]===u[2]||(f.touch1=u,f.taps=0):(f.touch0=u,o=!0,f.taps=1+!!e);e&&(e=clearTimeout(e)),o&&(f.taps<2&&(t=u[0],e=setTimeout((function(){e=null}),d)),et(this),f.start())}}function M(e,...t){if(this.__zooming){var n,r,i,a,s=S(this,t).event(e),u=e.changedTouches,l=u.length;for(Wu(e),n=0;n<l;++n)i=ve(r=u[n],this),s.touch0&&s.touch0[2]===r.identifier?s.touch0[0]=i:s.touch1&&s.touch1[2]===r.identifier&&(s.touch1[0]=i);if(r=s.that.__zoom,s.touch1){var f=s.touch0[0],h=s.touch0[1],d=s.touch1[0],p=s.touch1[1],m=(m=d[0]-f[0])*m+(m=d[1]-f[1])*m,v=(v=p[0]-h[0])*v+(v=p[1]-h[1])*v;r=y(r,Math.sqrt(m/v)),i=[(f[0]+d[0])/2,(f[1]+d[1])/2],a=[(h[0]+p[0])/2,(h[1]+p[1])/2]}else{if(!s.touch0)return;i=s.touch0[0],a=s.touch0[1]}s.zoom("touch",o(b(r,i,a),s.extent,c))}}function C(e,...r){if(this.__zooming){var i,o,a=S(this,r).event(e),s=e.changedTouches,u=s.length;for(Yu(e),n&&clearTimeout(n),n=setTimeout((function(){n=null}),d),i=0;i<u;++i)o=s[i],a.touch0&&a.touch0[2]===o.identifier?delete a.touch0:a.touch1&&a.touch1[2]===o.identifier&&delete a.touch1;if(a.touch1&&!a.touch0&&(a.touch0=a.touch1,delete a.touch1),a.touch0)a.touch0[1]=this.__zoom.invert(a.touch0[0]);else if(a.end(),2===a.taps&&(o=ve(o,this),Math.hypot(t[0]-o[0],t[1]-o[1])<v)){var c=de(this).on("dblclick.zoom");c&&c.apply(this,arguments)}}}return g.transform=function(e,t,n,r){var i=e.selection?e.selection():e;i.property("__zoom",Xu),e!==i?w(e,t,n,r):i.interrupt().each((function(){S(this,arguments).event(r).start().zoom(null,"function"==typeof t?t.apply(this,arguments):t).end()}))},g.scaleBy=function(e,t,n,r){g.scaleTo(e,(function(){return this.__zoom.k*("function"==typeof t?t.apply(this,arguments):t)}),n,r)},g.scaleTo=function(e,t,n,r){g.transform(e,(function(){var e=i.apply(this,arguments),r=this.__zoom,a=null==n?x(e):"function"==typeof n?n.apply(this,arguments):n,s=r.invert(a),u="function"==typeof t?t.apply(this,arguments):t;return o(b(y(r,u),a,s),e,c)}),n,r)},g.translateBy=function(e,t,n,r){g.transform(e,(function(){return o(this.__zoom.translate("function"==typeof t?t.apply(this,arguments):t,"function"==typeof n?n.apply(this,arguments):n),i.apply(this,arguments),c)}),null,r)},g.translateTo=function(e,t,n,r,a){g.transform(e,(function(){var e=i.apply(this,arguments),a=this.__zoom,s=null==r?x(e):"function"==typeof r?r.apply(this,arguments):r;return o(Hu.translate(s[0],s[1]).scale(a.k).translate("function"==typeof t?-t.apply(this,arguments):-t,"function"==typeof n?-n.apply(this,arguments):-n),e,c)}),r,a)},_.prototype={event:function(e){return e&&(this.sourceEvent=e),this},start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(e,t){return this.mouse&&"mouse"!==e&&(this.mouse[1]=t.invert(this.mouse[0])),this.touch0&&"touch"!==e&&(this.touch0[1]=t.invert(this.touch0[0])),this.touch1&&"touch"!==e&&(this.touch1[1]=t.invert(this.touch1[0])),this.that.__zoom=t,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(e){var t=de(this.that).datum();h.call(e,this.that,new Gu(e,{sourceEvent:this.sourceEvent,target:g,type:e,transform:this.that.__zoom,dispatch:h}),t)}},g.wheelDelta=function(e){return arguments.length?(a="function"==typeof e?e:qu(+e),g):a},g.filter=function(e){return arguments.length?(r="function"==typeof e?e:qu(!!e),g):r},g.touchable=function(e){return arguments.length?(s="function"==typeof e?e:qu(!!e),g):s},g.extent=function(e){return arguments.length?(i="function"==typeof e?e:qu([[+e[0][0],+e[0][1]],[+e[1][0],+e[1][1]]]),g):i},g.scaleExtent=function(e){return arguments.length?(u[0]=+e[0],u[1]=+e[1],g):[u[0],u[1]]},g.translateExtent=function(e){return arguments.length?(c[0][0]=+e[0][0],c[1][0]=+e[1][0],c[0][1]=+e[0][1],c[1][1]=+e[1][1],g):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},g.constrain=function(e){return arguments.length?(o=e,g):o},g.duration=function(e){return arguments.length?(l=+e,g):l},g.interpolate=function(e){return arguments.length?(f=e,g):f},g.on=function(){var e=h.on.apply(h,arguments);return e===h?g:e},g.clickDistance=function(e){return arguments.length?(m=(e=+e)*e,g):Math.sqrt(m)},g.tapDistance=function(e){return arguments.length?(v=+e,g):v},g}Uu.prototype;class tc{constructor(e,t){this.eventTransform=Hu,this.behavior=ec().scaleExtent([.001,1/0]).on("start",(e=>{var t,n,r;this.isRunning=!0;const i=!!e.sourceEvent;null===(r=null===(n=null===(t=this.config)||void 0===t?void 0:t.events)||void 0===n?void 0:n.onZoomStart)||void 0===r||r.call(n,e,i)})).on("zoom",(e=>{var t,n,r;this.eventTransform=e.transform;const{eventTransform:{x:i,y:o,k:a},store:{transform:s,screenSize:u}}=this,c=u[0],l=u[1];var f,h,d;h=c,d=l,(f=s)[0]=2/h,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/d,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,Wa(s,s,[i,o]),$a(s,s,[a,a]),Wa(s,s,[c/2,l/2]),$a(s,s,[c/2,l/2]),$a(s,s,[1,-1]);const p=!!e.sourceEvent;null===(r=null===(n=null===(t=this.config)||void 0===t?void 0:t.events)||void 0===n?void 0:n.onZoom)||void 0===r||r.call(n,e,p)})).on("end",(e=>{var t,n,r;this.isRunning=!1;const i=!!e.sourceEvent;null===(r=null===(n=null===(t=this.config)||void 0===t?void 0:t.events)||void 0===n?void 0:n.onZoomEnd)||void 0===r||r.call(n,e,i)})),this.isRunning=!1,this.store=e,this.config=t}getTransform(e,t,n=.1){if(0===e.length)return this.eventTransform;const{store:{screenSize:r}}=this,i=r[0],o=r[1],a=Qr(e.map((e=>e[0]))),s=Qr(e.map((e=>e[1])));a[0]=this.store.scaleX(a[0]),a[1]=this.store.scaleX(a[1]),s[0]=this.store.scaleY(s[0]),s[1]=this.store.scaleY(s[1]);const u=i*(1-2*n)/(a[1]-a[0]),c=o*(1-2*n)/(s[0]-s[1]),l=function(e,t,n){return Math.min(Math.max(e,t),n)}(null!=t?t:Math.min(u,c),...this.behavior.scaleExtent()),f=i/2-(a[1]+a[0])/2*l,h=o/2-(s[1]+s[0])/2*l;return Hu.translate(f,h).scale(l)}getDistanceToPoint(e){const{x:t,y:n,k:r}=this.eventTransform,i=this.getTransform([e],r),o=t-i.x,a=n-i.y;return Math.sqrt(o*o+a*a)}getMiddlePointTransform(e){const{store:{screenSize:t},eventTransform:{x:n,y:r,k:i}}=this,o=t[0],a=t[1],s=(a/2-r)/i,u=o/2-1*(((o/2-n)/i+this.store.scaleX(e[0]))/2),c=a/2-1*((s+this.store.scaleY(e[1]))/2);return Hu.translate(u,c).scale(1)}convertScreenToSpacePosition(e){const{eventTransform:{x:t,y:n,k:r},store:{screenSize:i}}=this,o=i[0],a=i[1],s=[(e[0]-t)/r,a-(e[1]-n)/r];return s[0]-=(o-this.store.adjustedSpaceSize)/2,s[1]-=(a-this.store.adjustedSpaceSize)/2,s}convertSpaceToScreenPosition(e){return[this.eventTransform.applyX(this.store.scaleX(e[0])),this.eventTransform.applyY(this.store.scaleY(e[1]))]}convertSpaceToScreenRadius(e){const{config:{scaleNodesOnZoom:t},store:{maxPointSize:n},eventTransform:{k:r}}=this;let i=2*e;return i*=t?r:Math.min(5,Math.max(1,.01*r)),Math.min(i,n)/2}}e.Graph=class{constructor(e,t){var n,r;this.config=new Ar,this.graph=new Hr,this.requestAnimationFrameId=0,this.isRightClickMouse=!1,this.store=new Is,this.zoomInstance=new tc(this.store,this.config),this.hasParticleSystemDestroyed=!1,this._findHoveredPointExecutionCount=0,this._isMouseOnCanvas=!1,this._isFirstDataAfterInit=!0,t&&this.config.init(t);const i=e.clientWidth,o=e.clientHeight;e.width=i*this.config.pixelRatio,e.height=o*this.config.pixelRatio,""===e.style.width&&""===e.style.height&&de(e).style("width","100%").style("height","100%"),this.canvas=e,this.canvasD3Selection=de(e),this.canvasD3Selection.on("mouseenter.cosmos",(()=>{this._isMouseOnCanvas=!0})).on("mouseleave.cosmos",(()=>{this._isMouseOnCanvas=!1})),this.zoomInstance.behavior.on("start.detect",(e=>{this.currentEvent=e})).on("zoom.detect",(e=>{!!e.sourceEvent&&this.updateMousePosition(e.sourceEvent),this.currentEvent=e})).on("end.detect",(e=>{this.currentEvent=e})),this.canvasD3Selection.call(this.zoomInstance.behavior).on("click",this.onClick.bind(this)).on("mousemove",this.onMouseMove.bind(this)).on("contextmenu",this.onRightClickMouse.bind(this)),this.config.disableZoom&&this.disableZoom(),this.setZoomLevel(null!==(n=this.config.initialZoomLevel)&&void 0!==n?n:1),this.reglInstance=dr({canvas:this.canvas,attributes:{antialias:!1,preserveDrawingBuffer:!0},extensions:["OES_texture_float","ANGLE_instanced_arrays"]}),this.store.maxPointSize=(null!==(r=this.reglInstance.limits.pointSizeDims[1])&&void 0!==r?r:64)/this.config.pixelRatio,this.store.adjustSpaceSize(this.config.spaceSize,this.reglInstance.limits.maxTextureSize),this.store.updateScreenSize(i,o),this.points=new Ua(this.reglInstance,this.config,this.store,this.graph),this.lines=new qa(this.reglInstance,this.config,this.store,this.graph,this.points),this.config.disableSimulation||(this.forceGravity=new Dr(this.reglInstance,this.config,this.store,this.graph,this.points),this.forceCenter=new Fr(this.reglInstance,this.config,this.store,this.graph,this.points),this.forceManyBody=this.config.useQuadtree?new Rr(this.reglInstance,this.config,this.store,this.graph,this.points):new jr(this.reglInstance,this.config,this.store,this.graph,this.points),this.forceLinkIncoming=new Nr(this.reglInstance,this.config,this.store,this.graph,this.points),this.forceLinkOutgoing=new Nr(this.reglInstance,this.config,this.store,this.graph,this.points),this.forceMouse=new Vr(this.reglInstance,this.config,this.store,this.graph,this.points)),this.store.backgroundColor=Sr(this.config.backgroundColor),this.config.highlightedNodeRingColor?(this.store.setHoveredNodeRingColor(this.config.highlightedNodeRingColor),this.store.setFocusedNodeRingColor(this.config.highlightedNodeRingColor)):(this.config.hoveredNodeRingColor&&this.store.setHoveredNodeRingColor(this.config.hoveredNodeRingColor),this.config.focusedNodeRingColor&&this.store.setFocusedNodeRingColor(this.config.focusedNodeRingColor)),this.config.showFPSMonitor&&(this.fpsMonitor=new Ur(this.canvas)),void 0!==this.config.randomSeed&&this.store.addRandomSeed(this.config.randomSeed)}get progress(){return this.store.simulationProgress}get isSimulationRunning(){return this.store.isSimulationRunning}get maxPointSize(){return this.store.maxPointSize}setConfig(e){var t,n;const r={...this.config};this.config.init(e),r.linkColor!==this.config.linkColor&&this.lines.updateColor(),r.nodeColor!==this.config.nodeColor&&this.points.updateColor(),r.nodeSize!==this.config.nodeSize&&this.points.updateSize(),r.linkWidth!==this.config.linkWidth&&this.lines.updateWidth(),r.linkArrows!==this.config.linkArrows&&this.lines.updateArrow(),r.curvedLinkSegments===this.config.curvedLinkSegments&&r.curvedLinks===this.config.curvedLinks||this.lines.updateCurveLineGeometry(),r.backgroundColor!==this.config.backgroundColor&&(this.store.backgroundColor=Sr(this.config.backgroundColor)),r.highlightedNodeRingColor!==this.config.highlightedNodeRingColor&&(this.store.setHoveredNodeRingColor(this.config.highlightedNodeRingColor),this.store.setFocusedNodeRingColor(this.config.highlightedNodeRingColor)),r.hoveredNodeRingColor!==this.config.hoveredNodeRingColor&&this.store.setHoveredNodeRingColor(this.config.hoveredNodeRingColor),r.focusedNodeRingColor!==this.config.focusedNodeRingColor&&this.store.setFocusedNodeRingColor(this.config.focusedNodeRingColor),r.spaceSize===this.config.spaceSize&&r.simulation.repulsionQuadtreeLevels===this.config.simulation.repulsionQuadtreeLevels||(this.store.adjustSpaceSize(this.config.spaceSize,this.reglInstance.limits.maxTextureSize),this.resizeCanvas(!0),this.update(this.store.isSimulationRunning)),r.showFPSMonitor!==this.config.showFPSMonitor&&(this.config.showFPSMonitor?this.fpsMonitor=new Ur(this.canvas):(null===(t=this.fpsMonitor)||void 0===t||t.destroy(),this.fpsMonitor=void 0)),r.pixelRatio!==this.config.pixelRatio&&(this.store.maxPointSize=(null!==(n=this.reglInstance.limits.pointSizeDims[1])&&void 0!==n?n:64)/this.config.pixelRatio),r.disableZoom!==this.config.disableZoom&&(this.config.disableZoom?this.disableZoom():this.enableZoom())}setData(e,t,n=!0){const{fitViewOnInit:r,fitViewDelay:i,fitViewByNodesInRect:o,initialZoomLevel:a}=this.config;if(!e.length&&!t.length)return this.destroyParticleSystem(),void this.reglInstance.clear({color:this.store.backgroundColor,depth:1,stencil:0});this.graph.setData(e,t),this._isFirstDataAfterInit&&r&&void 0===a&&(this._fitViewOnInitTimeoutID=window.setTimeout((()=>{o?this.setZoomTransformByNodePositions(o,void 0,void 0,0):this.fitView()}),i)),this._isFirstDataAfterInit=!1,this.update(n)}zoomToNodeById(e,t=700,n=3,r=!0){const i=this.graph.getNodeById(e);i&&this.zoomToNode(i,t,n,r)}zoomToNodeByIndex(e,t=700,n=3,r=!0){const i=this.graph.getNodeByIndex(e);i&&this.zoomToNode(i,t,n,r)}zoom(e,t=0){this.setZoomLevel(e,t)}setZoomLevel(e,t=0){0===t?this.canvasD3Selection.call(this.zoomInstance.behavior.scaleTo,e):this.canvasD3Selection.transition().duration(t).call(this.zoomInstance.behavior.scaleTo,e)}getZoomLevel(){return this.zoomInstance.eventTransform.k}getNodePositions(){if(this.hasParticleSystemDestroyed)return{};const e=_r(this.reglInstance,this.points.currentPositionFbo);return this.graph.nodes.reduce(((t,n)=>{const r=this.graph.getSortedIndexById(n.id),i=e[4*r+0],o=e[4*r+1];return void 0!==i&&void 0!==o&&(t[n.id]={x:i,y:o}),t}),{})}getNodePositionsMap(){const e=new Map;if(this.hasParticleSystemDestroyed)return e;const t=_r(this.reglInstance,this.points.currentPositionFbo);return this.graph.nodes.reduce(((e,n)=>{const r=this.graph.getSortedIndexById(n.id),i=t[4*r+0],o=t[4*r+1];return void 0!==i&&void 0!==o&&e.set(n.id,[i,o]),e}),e)}getNodePositionsArray(){const e=[];if(this.hasParticleSystemDestroyed)return[];const t=_r(this.reglInstance,this.points.currentPositionFbo);e.length=this.graph.nodes.length;for(let n=0;n<this.graph.nodes.length;n+=1){const r=this.graph.getSortedIndexByInputIndex(n),i=t[4*r+0],o=t[4*r+1];void 0!==i&&void 0!==o&&(e[n]=[i,o])}return e}fitView(e=250,t=.1){this.setZoomTransformByNodePositions(this.getNodePositionsArray(),e,void 0,t)}fitViewByNodeIds(e,t=250,n=.1){const r=this.getNodePositionsMap(),i=e.map((e=>r.get(e))).filter((e=>void 0!==e));this.setZoomTransformByNodePositions(i,t,void 0,n)}selectNodesInRange(e){if(e){const t=this.store.screenSize[1];this.store.selectedArea=[[e[0][0],t-e[1][1]],[e[1][0],t-e[0][1]]],this.points.findPointsOnAreaSelection();const n=_r(this.reglInstance,this.points.selectedFbo);this.store.selectedIndices=n.map(((e,t)=>t%4==0&&0!==e?t/4:-1)).filter((e=>-1!==e))}else this.store.selectedIndices=null;this.points.updateGreyoutStatus()}selectNodeById(e,t=!1){var n;if(t){const t=null!==(n=this.graph.getAdjacentNodes(e))&&void 0!==n?n:[];this.selectNodesByIds([e,...t.map((e=>e.id))])}else this.selectNodesByIds([e])}selectNodeByIndex(e,t=!1){const n=this.graph.getNodeByIndex(e);n&&this.selectNodeById(n.id,t)}selectNodesByIds(e){this.selectNodesByIndices(null==e?void 0:e.map((e=>this.graph.getSortedIndexById(e))))}selectNodesByIndices(e){e?0===e.length?this.store.selectedIndices=new Float32Array:this.store.selectedIndices=new Float32Array(e.filter((e=>void 0!==e))):this.store.selectedIndices=null,this.points.updateGreyoutStatus()}unselectNodes(){this.store.selectedIndices=null,this.points.updateGreyoutStatus()}getSelectedNodes(){const{selectedIndices:e}=this.store;if(!e)return null;const t=new Array(e.length);for(const[n,r]of e.entries())if(void 0!==r){const e=this.graph.getInputIndexBySortedIndex(r);void 0!==e&&(t[n]=this.graph.nodes[e])}return t}getAdjacentNodes(e){return this.graph.getAdjacentNodes(e)}setFocusedNodeById(e){void 0===e?this.store.setFocusedNode():this.store.setFocusedNode(this.graph.getNodeById(e),this.graph.getSortedIndexById(e))}setFocusedNodeByIndex(e){void 0===e?this.store.setFocusedNode():this.store.setFocusedNode(this.graph.getNodeByIndex(e),e)}spaceToScreenPosition(e){return this.zoomInstance.convertSpaceToScreenPosition(e)}spaceToScreenRadius(e){return this.zoomInstance.convertSpaceToScreenRadius(e)}getNodeRadiusByIndex(e){return this.points.getNodeRadiusByIndex(e)}getNodeRadiusById(e){const t=this.graph.getInputIndexById(e);if(void 0!==t)return this.points.getNodeRadiusByIndex(t)}trackNodePositionsByIds(e){this.points.trackNodesByIds(e)}trackNodePositionsByIndices(e){this.points.trackNodesByIds(e.map((e=>this.graph.getNodeByIndex(e))).filter((e=>void 0!==e)).map((e=>e.id)))}getTrackedNodePositionsMap(){return this.points.getTrackedPositions()}getSampledNodePositionsMap(){return this.points.getSampledNodePositionsMap()}start(e=1){var t,n;this.graph.nodes.length&&(this.store.isSimulationRunning=!0,this.store.alpha=e,this.store.simulationProgress=0,null===(n=(t=this.config.simulation).onStart)||void 0===n||n.call(t),this.stopFrames(),this.frame())}pause(){var e,t;this.store.isSimulationRunning=!1,null===(t=(e=this.config.simulation).onPause)||void 0===t||t.call(e)}restart(){var e,t;this.store.isSimulationRunning=!0,null===(t=(e=this.config.simulation).onRestart)||void 0===t||t.call(e)}step(){this.store.isSimulationRunning=!1,this.stopFrames(),this.frame()}destroy(){var e,t;window.clearTimeout(this._fitViewOnInitTimeoutID),this.stopFrames(),this.destroyParticleSystem(),null===(e=this.fpsMonitor)||void 0===e||e.destroy(),null===(t=document.getElementById("gl-bench-style"))||void 0===t||t.remove()}create(){var e,t,n,r;this.points.create(),this.lines.create(),null===(e=this.forceManyBody)||void 0===e||e.create(),null===(t=this.forceLinkIncoming)||void 0===t||t.create(Er.INCOMING),null===(n=this.forceLinkOutgoing)||void 0===n||n.create(Er.OUTGOING),null===(r=this.forceCenter)||void 0===r||r.create(),this.hasParticleSystemDestroyed=!1}destroyParticleSystem(){var e,t,n,r;this.hasParticleSystemDestroyed||(this.points.destroy(),this.lines.destroy(),null===(e=this.forceCenter)||void 0===e||e.destroy(),null===(t=this.forceLinkIncoming)||void 0===t||t.destroy(),null===(n=this.forceLinkOutgoing)||void 0===n||n.destroy(),null===(r=this.forceManyBody)||void 0===r||r.destroy(),this.reglInstance.destroy(),this.hasParticleSystemDestroyed=!0)}update(e){const{graph:t}=this;this.store.pointsTextureSize=Math.ceil(Math.sqrt(t.nodes.length)),this.store.linksTextureSize=Math.ceil(Math.sqrt(2*t.linksNumber)),this.destroyParticleSystem(),this.create(),this.initPrograms(),this.setFocusedNodeById(),this.store.hoveredNode=void 0,e?this.start():this.step()}initPrograms(){var e,t,n,r,i,o;this.points.initPrograms(),this.lines.initPrograms(),null===(e=this.forceGravity)||void 0===e||e.initPrograms(),null===(t=this.forceLinkIncoming)||void 0===t||t.initPrograms(),null===(n=this.forceLinkOutgoing)||void 0===n||n.initPrograms(),null===(r=this.forceMouse)||void 0===r||r.initPrograms(),null===(i=this.forceManyBody)||void 0===i||i.initPrograms(),null===(o=this.forceCenter)||void 0===o||o.initPrograms()}frame(){const{config:{simulation:e,renderLinks:t,disableSimulation:n},store:{alpha:r,isSimulationRunning:i}}=this;r<Cs&&i&&this.end(),this.store.pointsTextureSize&&(this.requestAnimationFrameId=window.requestAnimationFrame((r=>{var o,a,s,u,c,l,f,h,d,p,m,v,g;null===(o=this.fpsMonitor)||void 0===o||o.begin(),this.resizeCanvas(),this.findHoveredPoint(),n||(this.isRightClickMouse&&(i||this.start(.1),null===(a=this.forceMouse)||void 0===a||a.run(),this.points.updatePosition()),i&&!this.zoomInstance.isRunning&&(e.gravity&&(null===(s=this.forceGravity)||void 0===s||s.run(),this.points.updatePosition()),e.center&&(null===(u=this.forceCenter)||void 0===u||u.run(),this.points.updatePosition()),null===(c=this.forceManyBody)||void 0===c||c.run(),this.points.updatePosition(),this.store.linksTextureSize&&(null===(l=this.forceLinkIncoming)||void 0===l||l.run(),this.points.updatePosition(),null===(f=this.forceLinkOutgoing)||void 0===f||f.run(),this.points.updatePosition()),this.store.alpha+=this.store.addAlpha(null!==(h=this.config.simulation.decay)&&void 0!==h?h:gr.simulation.decay),this.isRightClickMouse&&(this.store.alpha=Math.max(this.store.alpha,.1)),this.store.simulationProgress=Math.sqrt(Math.min(1,Cs/this.store.alpha)),null===(p=(d=this.config.simulation).onTick)||void 0===p||p.call(d,this.store.alpha,null===(m=this.store.hoveredNode)||void 0===m?void 0:m.node,this.store.hoveredNode?this.graph.getInputIndexBySortedIndex(this.store.hoveredNode.index):void 0,null===(v=this.store.hoveredNode)||void 0===v?void 0:v.position)),this.points.trackPoints()),this.reglInstance.clear({color:this.store.backgroundColor,depth:1,stencil:0}),t&&this.store.linksTextureSize&&this.lines.draw(),this.points.draw(),null===(g=this.fpsMonitor)||void 0===g||g.end(r),this.currentEvent=void 0,this.frame()})))}stopFrames(){this.requestAnimationFrameId&&window.cancelAnimationFrame(this.requestAnimationFrameId)}end(){var e,t;this.store.isSimulationRunning=!1,this.store.simulationProgress=1,null===(t=(e=this.config.simulation).onEnd)||void 0===t||t.call(e)}onClick(e){var t,n,r,i;null===(n=(t=this.config.events).onClick)||void 0===n||n.call(t,null===(r=this.store.hoveredNode)||void 0===r?void 0:r.node,this.store.hoveredNode?this.graph.getInputIndexBySortedIndex(this.store.hoveredNode.index):void 0,null===(i=this.store.hoveredNode)||void 0===i?void 0:i.position,e)}updateMousePosition(e){if(!e||void 0===e.offsetX||void 0===e.offsetY)return;const t=e.offsetX,n=e.offsetY;this.store.mousePosition=this.zoomInstance.convertScreenToSpacePosition([t,n]),this.store.screenMousePosition=[t,this.store.screenSize[1]-n]}onMouseMove(e){var t,n,r,i;this.currentEvent=e,this.updateMousePosition(e),this.isRightClickMouse=3===e.which,null===(n=(t=this.config.events).onMouseMove)||void 0===n||n.call(t,null===(r=this.store.hoveredNode)||void 0===r?void 0:r.node,this.store.hoveredNode?this.graph.getInputIndexBySortedIndex(this.store.hoveredNode.index):void 0,null===(i=this.store.hoveredNode)||void 0===i?void 0:i.position,this.currentEvent)}onRightClickMouse(e){e.preventDefault()}resizeCanvas(e=!1){const t=this.canvas.width,n=this.canvas.height,r=this.canvas.clientWidth,i=this.canvas.clientHeight;if(e||t!==r*this.config.pixelRatio||n!==i*this.config.pixelRatio){const[e,t]=this.store.screenSize,{k:n}=this.zoomInstance.eventTransform,o=this.zoomInstance.convertScreenToSpacePosition([e/2,t/2]);this.store.updateScreenSize(r,i),this.canvas.width=r*this.config.pixelRatio,this.canvas.height=i*this.config.pixelRatio,this.reglInstance.poll(),this.canvasD3Selection.call(this.zoomInstance.behavior.transform,this.zoomInstance.getTransform([o],n)),this.points.updateSampledNodesGrid()}}setZoomTransformByNodePositions(e,t=250,n,r){this.resizeCanvas();const i=this.zoomInstance.getTransform(e,n,r);this.canvasD3Selection.transition().ease(or).duration(t).call(this.zoomInstance.behavior.transform,i)}zoomToNode(e,t,n,r){const{graph:i,store:{screenSize:o}}=this,a=_r(this.reglInstance,this.points.currentPositionFbo),s=i.getSortedIndexById(e.id);if(void 0===s)return;const u=a[4*s+0],c=a[4*s+1];if(void 0===u||void 0===c)return;const l=this.zoomInstance.getDistanceToPoint([u,c]),f=r?n:Math.max(this.getZoomLevel(),n);if(l<Math.min(o[0],o[1]))this.setZoomTransformByNodePositions([[u,c]],t,f);else{const e=this.zoomInstance.getTransform([[u,c]],f),n=this.zoomInstance.getMiddlePointTransform([u,c]);this.canvasD3Selection.transition().ease(rr).duration(t/2).call(this.zoomInstance.behavior.transform,n).transition().ease(ir).duration(t/2).call(this.zoomInstance.behavior.transform,e)}}disableZoom(){this.canvasD3Selection.call(this.zoomInstance.behavior).on("wheel.zoom",null)}enableZoom(){this.canvasD3Selection.call(this.zoomInstance.behavior)}findHoveredPoint(){var e,t,n,r,i;if(!this._isMouseOnCanvas)return;if(this._findHoveredPointExecutionCount<2)return void(this._findHoveredPointExecutionCount+=1);this._findHoveredPointExecutionCount=0,this.points.findHoveredPoint();let o=!1,a=!1;const s=_r(this.reglInstance,this.points.hoveredFbo);if(s[1]){const t=s[0],n=this.graph.getInputIndexBySortedIndex(t),r=void 0!==n?this.graph.getNodeByIndex(n):void 0;(null===(e=this.store.hoveredNode)||void 0===e?void 0:e.node)!==r&&(o=!0);const i=s[2],a=s[3];this.store.hoveredNode=r&&{node:r,index:t,position:[i,a]}}else this.store.hoveredNode&&(a=!0),this.store.hoveredNode=void 0;o&&this.store.hoveredNode&&(null===(n=(t=this.config.events).onNodeMouseOver)||void 0===n||n.call(t,this.store.hoveredNode.node,this.graph.getInputIndexBySortedIndex(this.graph.getSortedIndexById(this.store.hoveredNode.node.id)),this.store.hoveredNode.position,this.currentEvent)),a&&(null===(i=(r=this.config.events).onNodeMouseOut)||void 0===i||i.call(r,this.currentEvent))}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.min.js.map
